<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Introduction to Data Visualization with ggplot2</title>

<script src="site_libs/header-attrs-2.5.3/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0.1/anchor-sections.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">bmRn R Training</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Lessons and exercises</a>
</li>
<li>
  <a href="slides.html">Slides</a>
</li>
<li>
  <a href="more-resources.html">More resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Introduction to Data Visualization with ggplot2</h1>

</div>


<div id="objectives" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Objectives</h1>
<p>This document outlines and introduction to data visualization with <code>ggplot2</code>.</p>
</div>
<div id="materials" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Materials</h1>
<p>The slides for this presentation are <a href="https://mjfrigaard.github.io/data-viz-intro/Index.html">here</a></p>
<p>There is also an accompanying RStudio.Cloud project:</p>
</div>
<div id="previous-lessons" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Previous lessons</h1>
<p>All of the exercises and lessons are available <a href="https://mjfrigaard.github.io/r-meetup-tutorials/">here</a>, but you can also read more about <a href="https://dplyr.tidyverse.org/index.html"><code>dplyr</code></a> and <a href="https://tidyr.tidyverse.org/"><code>tidyr</code></a> on the tidyverse website, and in the <a href="https://r4ds.had.co.nz/transform.html">Data Transformation</a> and <a href="https://r4ds.had.co.nz/tidy-data.html">Tidy Data</a> chapters of R for Data Science.</p>
</div>
<div id="load-the-packages" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Load the packages</h1>
<p>The main packages we’re going to use are <code>dplyr</code>, <code>tidyr</code>, and <code>ggplot2</code>. These are all part of the <code>tidyverse</code>, so we’ll import this package below:</p>
<pre class="r"><code>install.packages(&quot;tidyverse&quot;)
library(tidyverse)</code></pre>
</div>
<div id="largest-pharmaceutical-companies-wikipedia" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Largest Pharmaceutical Companies (Wikipedia)</h1>
<p>We’re going to import some data from the wild (wikipedia), because data are never in the ideal format when we first get them.</p>
<div id="import-the-data" class="section level2 tabset" number="5.1">
<h2 class="tabset" number="5.1"><span class="header-section-number">5.1</span> Import the data</h2>
<p>I Googled “largest pharmaceutical companies” and found <a href="https://en.wikipedia.org/wiki/List_of_largest_biotechnology_and_pharmaceutical_companies">this wikipedia page</a>.</p>
<pre class="r"><code>library(xml2)
library(rvest)</code></pre>
<div id="read-html" class="section level3" number="5.1.1">
<h3 number="5.1.1"><span class="header-section-number">5.1.1</span> Read HTML</h3>
<p>The first function I’ll use comes from the <code>xml2</code> <a href="https://blog.rstudio.com/2015/04/21/xml2/">package</a>. <code>xml2::read_html()</code> loads the html from the wikipedia page into an R object I call <code>wiki_html</code>.</p>
<pre class="r"><code>wiki_html &lt;- xml2::read_html(&quot;https://en.wikipedia.org/wiki/List_of_largest_biotechnology_and_pharmaceutical_companies&quot;)</code></pre>
<p>We should check the structure of new objects, so we know what we’re working with.</p>
<pre class="r"><code>wiki_html %&gt;% str()</code></pre>
<pre><code>## List of 2
##  $ node:&lt;externalptr&gt; 
##  $ doc :&lt;externalptr&gt; 
##  - attr(*, &quot;class&quot;)= chr [1:2] &quot;xml_document&quot; &quot;xml_node&quot;</code></pre>
<p>I can see this is a list of two objects (a <code>node</code> and a <code>doc</code>).</p>
</div>
<div id="html-nodes-css" class="section level3" number="5.1.2">
<h3 number="5.1.2"><span class="header-section-number">5.1.2</span> HTML Nodes (css)</h3>
<p>I want the html <code>node</code>, so I will use a function from the <code>rvest</code> <a href="https://github.com/hadley/rvest">package</a>. The <code>css</code> argument is set to <code>"table"</code>. Once again I check the structure of the output object.</p>
<pre class="r"><code>wiki_html_tables &lt;- wiki_html %&gt;% rvest::html_nodes(css = &quot;table&quot;)
wiki_html_tables %&gt;% str()</code></pre>
<pre><code>## List of 4
##  $ :List of 2
##   ..$ node:&lt;externalptr&gt; 
##   ..$ doc :&lt;externalptr&gt; 
##   ..- attr(*, &quot;class&quot;)= chr &quot;xml_node&quot;
##  $ :List of 2
##   ..$ node:&lt;externalptr&gt; 
##   ..$ doc :&lt;externalptr&gt; 
##   ..- attr(*, &quot;class&quot;)= chr &quot;xml_node&quot;
##  $ :List of 2
##   ..$ node:&lt;externalptr&gt; 
##   ..$ doc :&lt;externalptr&gt; 
##   ..- attr(*, &quot;class&quot;)= chr &quot;xml_node&quot;
##  $ :List of 2
##   ..$ node:&lt;externalptr&gt; 
##   ..$ doc :&lt;externalptr&gt; 
##   ..- attr(*, &quot;class&quot;)= chr &quot;xml_node&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;xml_nodeset&quot;</code></pre>
<p>This is a list of three lists, each of them <code>xml_node</code>s.</p>
<p>In order to find the relevant tables in the <code>wiki_html_tables</code> object, I need to be able to search on something. Fortunately, the <code>base::grep()</code> function can be used in combination with sub-setting to extract the <code>relevant_tables</code> from <code>wiki_html_tables</code>.</p>
<p>Get the relevant tables from the <code>xml_nodeset</code> in <code>wiki_html_tables</code>.</p>
<pre class="r"><code>relevant_tables &lt;- wiki_html_tables[base::grep(&quot;rank&quot;, wiki_html_tables)]
relevant_tables %&gt;% str()</code></pre>
<pre><code>## List of 1
##  $ :List of 2
##   ..$ node:&lt;externalptr&gt; 
##   ..$ doc :&lt;externalptr&gt; 
##   ..- attr(*, &quot;class&quot;)= chr &quot;xml_node&quot;
##  - attr(*, &quot;class&quot;)= chr &quot;xml_nodeset&quot;</code></pre>
<p>This returned yet another list of lists! (another set of <code>node</code> and <code>doc</code>).</p>
</div>
<div id="extract-html-table" class="section level3" number="5.1.3">
<h3 number="5.1.3"><span class="header-section-number">5.1.3</span> Extract HTML table</h3>
<p>Now I need to use <code>rvest::html_table()</code> function (combined with some bracket sub-setting) to explore this object and learn about it’s contents (read more about how this works <a href="https://dcl-wrangle.stanford.edu/rvest.html#scrape-data-with-rvest">here</a>).</p>
<p>I will start with position <code>[[1]]</code> and set <code>fill = TRUE</code>.</p>
<pre class="r"><code>rvest::html_table(relevant_tables[[1]], 
                  fill = TRUE) %&gt;% utils::head()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":[""],"name":["_rn_"],"type":[""],"align":["left"]},{"label":["Rank[N 1]"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Company"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Largest Market Cap (USD billions)"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Market Cap in 2019 (USD billions)"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["Market Cap in 2018 (USD billions)"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["Market Cap in 2017 (USD billions)"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["Market Cap in 2016 (USD billions)[1][2]"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["Market Cap in 2015 (USD billions)[3]"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["Market Cap in 2014 (USD billions)[4]"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["Market Cap in 2013 (USD billions)"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"Johnson & Johnson[P]NYSE: JNJ","3":"397.4 (Jan 2018)","4":"385.0","5":"346.1","6":"375.4","7":"314.1","8":"284.2","9":"277.8","10":"258.3","_rn_":"1"},{"1":"2 1","2":"Roche[P]SIX: ROG","3":"281.1 (Dec 2019)","4":"281.1","5":"209.3","6":"216.7","7":"192.1","8":"234.7","9":"258.5","10":"240.3","_rn_":"2"},{"1":"3 2","2":"Novartis[P]NYSE: NVS","3":"275.2 (Jul 2015)","4":"240.0","5":"200.0","6":"196.7","7":"170.5","8":"206.1","9":"229.8","10":"195.0","_rn_":"3"},{"1":"4","2":"Merck & Co.[P]NYSE: MRK","3":"232.9 (Dec 2019)","4":"232.9","5":"205.8","6":"153.3","7":"164.3","8":"147.6","9":"166.9","10":"146.5","_rn_":"4"},{"1":"5 3","2":"Pfizer[P]NYSE: PFE","3":"310.5 (Jul 2000)","4":"216.7","5":"259.7","6":"215.9","7":"196.3","8":"199.3","9":"205.4","10":"196.0","_rn_":"5"},{"1":"6 2","2":"Abbott Laboratories[P]NYSE: ABT","3":"153.5 (Dec 2019)","4":"153.5","5":"126.8","6":"99.3","7":"56.4","8":"67.0","9":"67.9","10":"59.3","_rn_":"6"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This looks like the table I want! Let’s it to a data frame and get wrangling!</p>
<pre class="r"><code>TopPharmCompRaw &lt;- rvest::html_table(relevant_tables[[1]], 
                  fill = TRUE)</code></pre>
</div>
</div>
<div id="data-wrangling-outline" class="section level2" number="5.2">
<h2 number="5.2"><span class="header-section-number">5.2</span> Data wrangling (outline)</h2>
<p>We have a raw dataset now, and we should make a ‘to-do’ list of what we want the data to look like:</p>
<ol style="list-style-type: decimal">
<li>Standardized column names<br />
</li>
<li>Each variable in it’s own column:
<ul>
<li>i.e. type of company in it’s own column (<code>B</code> – Biotechnology company, <code>P</code> – Pharmaceutical company)</li>
<li>stock exchange identifier in it’s own column (i.e. <code>NYSE</code>, <code>NASDAQ</code>, etc.)</li>
</ul></li>
<li>Properly formatted values (numeric, factor, etc.)<br />
</li>
<li>Missing variables formatted correctly (replace <code>-</code> with <code>NA</code>)</li>
</ol>
</div>
<div id="column-names" class="section level2 tabset" number="5.3">
<h2 class="tabset" number="5.3"><span class="header-section-number">5.3</span> Column Names</h2>
<p>Follow along on each tab for the steps to wrangle the column names:</p>
<div id="string-manipulations" class="section level3" number="5.3.1">
<h3 number="5.3.1"><span class="header-section-number">5.3.1</span> String manipulations</h3>
<p>We can use <code>janitor::clean_names()</code>, but first we should do some string manipulation to remove the extra characters from the column names.</p>
<pre class="r"><code>TopPharmCompRaw %&gt;% 
    # get a vector of &#39;dirty&#39; names
    names() %&gt;% 
    # remove citations in brackets [ ]
    stringr::str_remove_all(string = ., pattern = &quot;\\[[0-9]\\]&quot;) %&gt;%
    # replace (USD billions)
    stringr::str_replace_all(string = ., pattern = &quot;\\s*\\([^\\)]+\\)&quot;, 
                             replacement = &quot;_us_bil&quot;) %&gt;% 
    # remove bracket from Rank
    stringr::str_remove_all(string = ., pattern = &quot;\\[|\\]&quot;) %&gt;% 
    # remove alpha numeric from end of Rank
    stringr::str_remove_all(string = ., pattern = &quot;N 1$&quot;) %&gt;% 
    # make all lowercase
    stringr::str_to_lower() -&gt; cleaned_names
cleaned_names</code></pre>
<pre><code>##  [1] &quot;rank&quot;                      &quot;company&quot;                  
##  [3] &quot;largest market cap_us_bil&quot; &quot;market cap in 2019_us_bil&quot;
##  [5] &quot;market cap in 2018_us_bil&quot; &quot;market cap in 2017_us_bil&quot;
##  [7] &quot;market cap in 2016_us_bil&quot; &quot;market cap in 2015_us_bil&quot;
##  [9] &quot;market cap in 2014_us_bil&quot; &quot;market cap in 2013_us_bil&quot;</code></pre>
</div>
<div id="janitorclean_names" class="section level3" number="5.3.2">
<h3 number="5.3.2"><span class="header-section-number">5.3.2</span> <code>janitor::clean_names</code></h3>
<p>Now we can apply the new names (<code>cleaned_names</code>) to <code>TopPharmCompRaw</code> and use <code>janitor::clean_names()</code> to standardize them.</p>
<pre class="r"><code>TopPharmCompRaw %&gt;% 
    set_names(nm = cleaned_names) %&gt;% 
    janitor::clean_names()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["rank"],"name":[1],"type":["chr"],"align":["left"]},{"label":["company"],"name":[2],"type":["chr"],"align":["left"]},{"label":["largest_market_cap_us_bil"],"name":[3],"type":["chr"],"align":["left"]},{"label":["market_cap_in_2019_us_bil"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2018_us_bil"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2017_us_bil"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2016_us_bil"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2015_us_bil"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2014_us_bil"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2013_us_bil"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"Johnson & Johnson[P]NYSE: JNJ","3":"397.4 (Jan 2018)","4":"385.0","5":"346.1","6":"375.4","7":"314.1","8":"284.2","9":"277.8","10":"258.3"},{"1":"2 1","2":"Roche[P]SIX: ROG","3":"281.1 (Dec 2019)","4":"281.1","5":"209.3","6":"216.7","7":"192.1","8":"234.7","9":"258.5","10":"240.3"},{"1":"3 2","2":"Novartis[P]NYSE: NVS","3":"275.2 (Jul 2015)","4":"240.0","5":"200.0","6":"196.7","7":"170.5","8":"206.1","9":"229.8","10":"195.0"},{"1":"4","2":"Merck & Co.[P]NYSE: MRK","3":"232.9 (Dec 2019)","4":"232.9","5":"205.8","6":"153.3","7":"164.3","8":"147.6","9":"166.9","10":"146.5"},{"1":"5 3","2":"Pfizer[P]NYSE: PFE","3":"310.5 (Jul 2000)","4":"216.7","5":"259.7","6":"215.9","7":"196.3","8":"199.3","9":"205.4","10":"196.0"},{"1":"6 2","2":"Abbott Laboratories[P]NYSE: ABT","3":"153.5 (Dec 2019)","4":"153.5","5":"126.8","6":"99.3","7":"56.4","8":"67.0","9":"67.9","10":"59.3"},{"1":"7","2":"Amgen[B]NASDAQ: AMGN","3":"145.8 (Dec 2019)","4":"144.6","5":"128.8","6":"126.2","7":"108.9","8":"122.5","9":"93.1","10":"78.7"},{"1":"8 2","2":"Novo Nordisk[P]NYSE: NVO","3":"159.6 (Aug 2015)","4":"137.1","5":"111.9","6":"131.2","7":"92.6","8":"153.9","9":"125.4","10":"-"},{"1":"9 3","2":"AbbVie[P]NYSE: ABBV","3":"196.2 (Jan 2018)","4":"130.9","5":"146.3","6":"154.4","7":"100.2","8":"96.8","9":"104.1","10":"83.8"},{"1":"10 2","2":"AstraZeneca[P]NYSE: AZN","3":"130.8 (Dec 2019)","4":"130.8","5":"96.2","6":"87.9","7":"68.8","8":"85.8","9":"88.9","10":"74.6"},{"1":"11 2","2":"Eli Lilly & Co[P]NYSE: LLY","3":"131.2 (Feb 2019)","4":"126.9","5":"125.6","6":"93.0","7":"80.9","8":"93.4","9":"76.6","10":"57.0"},{"1":"12 1","2":"/  GlaxoSmithKline[P]NYSE: GSK","3":"174.9 (May 2006)","4":"117.2","5":"94.8","6":"87.9","7":"93.3","8":"97.6","9":"128.9","10":"129.6"},{"1":"13 1","2":"Bristol-Myers Squibb[P]NASDAQ: BMY","3":"128.3 (Jul 2016)","4":"105.0","5":"85.0","6":"100.3","7":"98.2","8":"114.8","9":"97.6","10":"87.2"},{"1":"14 1","2":"Gilead Sciences[B]NASDAQ: GILD","3":"179.6 (Jun 2013)","4":"82.3","5":"81.6","6":"93.6","7":"96.6","8":"145.8","9":"109.0","10":"78.4"},{"1":"15 2","2":"Bayer[P]FWB: BAYN","3":"129.0 (Mar 2015)","4":"80.1","5":"63.1","6":"101.9","7":"85.3","8":"103.2","9":"113.2","10":"117.4"},{"1":"16 2","2":"Stryker Corporation[P]NYSE: SYK","3":"78.5 (Dec 2019)","4":"78.5","5":"58.6","6":"58.0","7":"45.1","8":"34.7","9":"35.7","10":"28.4"},{"1":"17 6","2":"Sanofi[P]NYSE: SNY","3":"151.3 (Sep 2014)","4":"63.5","5":"108.4","6":"108.2","7":"101.8","8":"111.8","9":"138.1","10":"142.0"},{"1":"18 5","2":"Zoetis[P]NASDAQ: ZTS","3":"76.6 (Aug 2020)","4":"63.2","5":"41.4","6":"35.1","7":"26.4","8":"23.8","9":"21.6","10":"16.3"},{"1":"19 1","2":"/ Teva Pharmaceuticals [P]NYSE: TEVA","3":"110.5 (Jul 2015)","4":"48.3","5":"16.2","6":"24.4","7":"32.7","8":"13.2","9":"70.5","10":"29.3"},{"1":"20 1","2":"Takeda Pharmaceutical[P]NASDAQ: TAK","3":"61.5 (Dec 2019)","4":"61.5","5":"52.9","6":"40.2","7":"45.6","8":"47.8","9":"37.5","10":"34.3"},{"1":"21 1","2":"Vertex Pharmaceuticals[P]NASDAQ: VRTX","3":"78.9 (Jul 2020)","4":"56.3","5":"42.2","6":"37.9","7":"18.3","8":"31.0","9":"28.7","10":"17.4"},{"1":"22 6","2":"Biogen[B]NASDAQ: BIIB","3":"111.7 (Mar 2015)","4":"54.7","5":"63.5","6":"67.4","7":"61.6","8":"68.3","9":"79.7","10":"66.1"},{"1":"23 2","2":"Illumina[B]NASDAQ: ILMN","3":"56.0 (Jul 2019)","4":"48.2","5":"44.1","6":"40.2","7":"39.4","8":"35.4","9":"28.6","10":"25.7"},{"1":"24","2":"Regeneron Pharmaceuticals[B]NASDAQ: REGN","3":"61.4 (Aug 2015)","4":"41.2","5":"40.3","6":"40.4","7":"39.3","8":"56.5","9":"42.0","10":"27.4"},{"1":"25","2":"Astellas[P]TYO: 4503","3":"40.6 (Dec 2015)","4":"32.7","5":"23.8","6":"29.3","7":"25.7","8":"40.6","9":"35.8","10":"27.6"},{"1":"26 1","2":"Daiichi Sankyo[P]NASDAQ: DSNKY","3":"45.3 (Dec 2019)","4":"45.3","5":"22.7","6":"27.5","7":"35.3","8":"38.8","9":"33.2","10":"28.7"},{"1":"27 1","2":"Alexion Pharmaceuticals[P]NASDAQ: ALXN","3":"47.0 (Jul 2015)","4":"24.3","5":"21.7","6":"26.7","7":"27.4","8":"43.1","9":"36.7","10":"26.0"},{"1":"28 2","2":"Eisai Pharmaceutical[P]TYO: 4523","3":"37.3 (Dec 2016)","4":"21.5","5":"23.0","6":"24.5","7":"37.3","8":"28.8","9":"30.2","10":"28.7"},{"1":"29 2","2":"Incyte[P]NASDAQ: INCY","3":"31.2 (Mar 2017)","4":"18.8","5":"13.5","6":"18.3","7":"15.4","8":"10.6","9":"7.3","10":"4.6"},{"1":"30 1","2":"BioMarin[P]NASDAQ: BMRN","3":"24.0 (Jul 2015)","4":"15.2","5":"15.1","6":"18.3","7":"20.4","8":"13.8","9":"12.9","10":"10.8"},{"1":"31 1","2":"Genmab[B]NASDAQ: GMAB","3":"24.7 (Aug 2020)","4":"14.5","5":"10.6","6":"10.8","7":"10.8","8":"8.8","9":"3.8","10":"2.6"},{"1":"32 2","2":"Mylan[P]NASDAQ: MYL","3":"38.8 (Dec 2015)","4":"10.4","5":"14.1","6":"27.5","7":"30.3","8":"38.8","9":"33.2","10":"35.7"},{"1":"36","2":"Bausch Health[P]TSX: BHC","3":"31.2 (Aug 2020)","4":"41.5","5":"10.0","6":"21.0","7":"4.5","8":"8.1","9":"9.0","10":"-"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="assign-to-data-frame" class="section level3" number="5.3.3">
<h3 number="5.3.3"><span class="header-section-number">5.3.3</span> Assign to data frame</h3>
<p>If this looks acceptable, we can assign to <code>TopPharmComp</code> (because this is no longer a raw dataset!)</p>
<pre class="r"><code>TopPharmComp &lt;- TopPharmCompRaw %&gt;% 
    set_names(nm = cleaned_names) %&gt;% 
    janitor::clean_names()</code></pre>
</div>
</div>
<div id="define-variables" class="section level2 tabset" number="5.4">
<h2 class="tabset" number="5.4"><span class="header-section-number">5.4</span> Define Variables</h2>
<p>We want to split up the following variables into their own columns:</p>
<ol style="list-style-type: decimal">
<li><code>company_type</code> = <code>[P]</code> for <code>Pharmaceutical</code> or <code>[B]</code> for <code>Biotechnology</code><br />
</li>
<li><code>stock_exch</code> = <code>NSYE</code> (New York Stock Exchange), <code>NASDAQ</code> (National Association of Securities Dealers Automated Quotations), <code>FWB</code> (Frankfurt Stock Exchange), <code>TYO</code> (Australian Securities Exchange), <code>TSX</code> (Toronto Stock Exchange), and <code>SIX</code> (Swiss Exchange).</li>
<li><code>stock_id</code> = acronym for each company on <code>stock_exch</code><br />
</li>
<li><code>largest_market_cap_date</code> = date from <code>largest_market_cap_us_bil</code><br />
</li>
<li><code>company_name</code> a variable containing <em>only</em> the company name</li>
<li>a <code>ranking</code> variable with a numerically coded rank</li>
</ol>
<div id="company_type" class="section level3" number="5.4.1">
<h3 number="5.4.1"><span class="header-section-number">5.4.1</span> <code>company_type</code></h3>
<p>Here we <code>separate</code> the <code>company</code> column into two new columns, then use the <code>company_name_etc</code> to create <code>company_type</code></p>
<pre class="r"><code>TopPharmComp %&gt;% 
  # separate company into 2 columns
  separate(col = company, into = c(&quot;company_name_etc&quot;, &quot;company_etc&quot;), 
           sep = &quot;\\]&quot;, 
           remove = FALSE) %&gt;% 
  # create categories
  mutate(company_type = case_when(
    str_detect(string = company_name_etc, pattern = &quot;\\[P$&quot;) ~ &quot;Pharma&quot;, 
    str_detect(string = company_name_etc, pattern = &quot;\\[B$&quot;) ~ &quot;Biotech&quot;)) %&gt;% 
  # check our work
  dplyr::select(contains(&quot;comp&quot;))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["company"],"name":[1],"type":["chr"],"align":["left"]},{"label":["company_name_etc"],"name":[2],"type":["chr"],"align":["left"]},{"label":["company_etc"],"name":[3],"type":["chr"],"align":["left"]},{"label":["company_type"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"Johnson & Johnson[P]NYSE: JNJ","2":"Johnson & Johnson[P","3":"NYSE: JNJ","4":"Pharma"},{"1":"Roche[P]SIX: ROG","2":"Roche[P","3":"SIX: ROG","4":"Pharma"},{"1":"Novartis[P]NYSE: NVS","2":"Novartis[P","3":"NYSE: NVS","4":"Pharma"},{"1":"Merck & Co.[P]NYSE: MRK","2":"Merck & Co.[P","3":"NYSE: MRK","4":"Pharma"},{"1":"Pfizer[P]NYSE: PFE","2":"Pfizer[P","3":"NYSE: PFE","4":"Pharma"},{"1":"Abbott Laboratories[P]NYSE: ABT","2":"Abbott Laboratories[P","3":"NYSE: ABT","4":"Pharma"},{"1":"Amgen[B]NASDAQ: AMGN","2":"Amgen[B","3":"NASDAQ: AMGN","4":"Biotech"},{"1":"Novo Nordisk[P]NYSE: NVO","2":"Novo Nordisk[P","3":"NYSE: NVO","4":"Pharma"},{"1":"AbbVie[P]NYSE: ABBV","2":"AbbVie[P","3":"NYSE: ABBV","4":"Pharma"},{"1":"AstraZeneca[P]NYSE: AZN","2":"AstraZeneca[P","3":"NYSE: AZN","4":"Pharma"},{"1":"Eli Lilly & Co[P]NYSE: LLY","2":"Eli Lilly & Co[P","3":"NYSE: LLY","4":"Pharma"},{"1":"/  GlaxoSmithKline[P]NYSE: GSK","2":"/  GlaxoSmithKline[P","3":"NYSE: GSK","4":"Pharma"},{"1":"Bristol-Myers Squibb[P]NASDAQ: BMY","2":"Bristol-Myers Squibb[P","3":"NASDAQ: BMY","4":"Pharma"},{"1":"Gilead Sciences[B]NASDAQ: GILD","2":"Gilead Sciences[B","3":"NASDAQ: GILD","4":"Biotech"},{"1":"Bayer[P]FWB: BAYN","2":"Bayer[P","3":"FWB: BAYN","4":"Pharma"},{"1":"Stryker Corporation[P]NYSE: SYK","2":"Stryker Corporation[P","3":"NYSE: SYK","4":"Pharma"},{"1":"Sanofi[P]NYSE: SNY","2":"Sanofi[P","3":"NYSE: SNY","4":"Pharma"},{"1":"Zoetis[P]NASDAQ: ZTS","2":"Zoetis[P","3":"NASDAQ: ZTS","4":"Pharma"},{"1":"/ Teva Pharmaceuticals [P]NYSE: TEVA","2":"/ Teva Pharmaceuticals [P","3":"NYSE: TEVA","4":"Pharma"},{"1":"Takeda Pharmaceutical[P]NASDAQ: TAK","2":"Takeda Pharmaceutical[P","3":"NASDAQ: TAK","4":"Pharma"},{"1":"Vertex Pharmaceuticals[P]NASDAQ: VRTX","2":"Vertex Pharmaceuticals[P","3":"NASDAQ: VRTX","4":"Pharma"},{"1":"Biogen[B]NASDAQ: BIIB","2":"Biogen[B","3":"NASDAQ: BIIB","4":"Biotech"},{"1":"Illumina[B]NASDAQ: ILMN","2":"Illumina[B","3":"NASDAQ: ILMN","4":"Biotech"},{"1":"Regeneron Pharmaceuticals[B]NASDAQ: REGN","2":"Regeneron Pharmaceuticals[B","3":"NASDAQ: REGN","4":"Biotech"},{"1":"Astellas[P]TYO: 4503","2":"Astellas[P","3":"TYO: 4503","4":"Pharma"},{"1":"Daiichi Sankyo[P]NASDAQ: DSNKY","2":"Daiichi Sankyo[P","3":"NASDAQ: DSNKY","4":"Pharma"},{"1":"Alexion Pharmaceuticals[P]NASDAQ: ALXN","2":"Alexion Pharmaceuticals[P","3":"NASDAQ: ALXN","4":"Pharma"},{"1":"Eisai Pharmaceutical[P]TYO: 4523","2":"Eisai Pharmaceutical[P","3":"TYO: 4523","4":"Pharma"},{"1":"Incyte[P]NASDAQ: INCY","2":"Incyte[P","3":"NASDAQ: INCY","4":"Pharma"},{"1":"BioMarin[P]NASDAQ: BMRN","2":"BioMarin[P","3":"NASDAQ: BMRN","4":"Pharma"},{"1":"Genmab[B]NASDAQ: GMAB","2":"Genmab[B","3":"NASDAQ: GMAB","4":"Biotech"},{"1":"Mylan[P]NASDAQ: MYL","2":"Mylan[P","3":"NASDAQ: MYL","4":"Pharma"},{"1":"Bausch Health[P]TSX: BHC","2":"Bausch Health[P","3":"TSX: BHC","4":"Pharma"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>These categories look are correct, so we can assign <code>company_type</code> to <code>TopPharmComp</code>.</p>
<pre class="r"><code>TopPharmComp &lt;- TopPharmComp %&gt;% 
  # separate company into 2 columns
  separate(col = company, into = c(&quot;company_name_etc&quot;, &quot;company_etc&quot;), 
           sep = &quot;\\]&quot;, 
           remove = FALSE) %&gt;% 
  # create categories
  mutate(company_type = case_when(
    str_detect(string = company_name_etc, pattern = &quot;\\[P$&quot;) ~ &quot;Pharma&quot;, 
    str_detect(string = company_name_etc, pattern = &quot;\\[B$&quot;) ~ &quot;Biotech&quot;)) %&gt;% 
  # remove company_name_etc
  select(-company_name_etc)
TopPharmComp</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["rank"],"name":[1],"type":["chr"],"align":["left"]},{"label":["company"],"name":[2],"type":["chr"],"align":["left"]},{"label":["company_etc"],"name":[3],"type":["chr"],"align":["left"]},{"label":["largest_market_cap_us_bil"],"name":[4],"type":["chr"],"align":["left"]},{"label":["market_cap_in_2019_us_bil"],"name":[5],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2018_us_bil"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2017_us_bil"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2016_us_bil"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2015_us_bil"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2014_us_bil"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2013_us_bil"],"name":[11],"type":["chr"],"align":["left"]},{"label":["company_type"],"name":[12],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"Johnson & Johnson[P]NYSE: JNJ","3":"NYSE: JNJ","4":"397.4 (Jan 2018)","5":"385.0","6":"346.1","7":"375.4","8":"314.1","9":"284.2","10":"277.8","11":"258.3","12":"Pharma"},{"1":"2 1","2":"Roche[P]SIX: ROG","3":"SIX: ROG","4":"281.1 (Dec 2019)","5":"281.1","6":"209.3","7":"216.7","8":"192.1","9":"234.7","10":"258.5","11":"240.3","12":"Pharma"},{"1":"3 2","2":"Novartis[P]NYSE: NVS","3":"NYSE: NVS","4":"275.2 (Jul 2015)","5":"240.0","6":"200.0","7":"196.7","8":"170.5","9":"206.1","10":"229.8","11":"195.0","12":"Pharma"},{"1":"4","2":"Merck & Co.[P]NYSE: MRK","3":"NYSE: MRK","4":"232.9 (Dec 2019)","5":"232.9","6":"205.8","7":"153.3","8":"164.3","9":"147.6","10":"166.9","11":"146.5","12":"Pharma"},{"1":"5 3","2":"Pfizer[P]NYSE: PFE","3":"NYSE: PFE","4":"310.5 (Jul 2000)","5":"216.7","6":"259.7","7":"215.9","8":"196.3","9":"199.3","10":"205.4","11":"196.0","12":"Pharma"},{"1":"6 2","2":"Abbott Laboratories[P]NYSE: ABT","3":"NYSE: ABT","4":"153.5 (Dec 2019)","5":"153.5","6":"126.8","7":"99.3","8":"56.4","9":"67.0","10":"67.9","11":"59.3","12":"Pharma"},{"1":"7","2":"Amgen[B]NASDAQ: AMGN","3":"NASDAQ: AMGN","4":"145.8 (Dec 2019)","5":"144.6","6":"128.8","7":"126.2","8":"108.9","9":"122.5","10":"93.1","11":"78.7","12":"Biotech"},{"1":"8 2","2":"Novo Nordisk[P]NYSE: NVO","3":"NYSE: NVO","4":"159.6 (Aug 2015)","5":"137.1","6":"111.9","7":"131.2","8":"92.6","9":"153.9","10":"125.4","11":"-","12":"Pharma"},{"1":"9 3","2":"AbbVie[P]NYSE: ABBV","3":"NYSE: ABBV","4":"196.2 (Jan 2018)","5":"130.9","6":"146.3","7":"154.4","8":"100.2","9":"96.8","10":"104.1","11":"83.8","12":"Pharma"},{"1":"10 2","2":"AstraZeneca[P]NYSE: AZN","3":"NYSE: AZN","4":"130.8 (Dec 2019)","5":"130.8","6":"96.2","7":"87.9","8":"68.8","9":"85.8","10":"88.9","11":"74.6","12":"Pharma"},{"1":"11 2","2":"Eli Lilly & Co[P]NYSE: LLY","3":"NYSE: LLY","4":"131.2 (Feb 2019)","5":"126.9","6":"125.6","7":"93.0","8":"80.9","9":"93.4","10":"76.6","11":"57.0","12":"Pharma"},{"1":"12 1","2":"/  GlaxoSmithKline[P]NYSE: GSK","3":"NYSE: GSK","4":"174.9 (May 2006)","5":"117.2","6":"94.8","7":"87.9","8":"93.3","9":"97.6","10":"128.9","11":"129.6","12":"Pharma"},{"1":"13 1","2":"Bristol-Myers Squibb[P]NASDAQ: BMY","3":"NASDAQ: BMY","4":"128.3 (Jul 2016)","5":"105.0","6":"85.0","7":"100.3","8":"98.2","9":"114.8","10":"97.6","11":"87.2","12":"Pharma"},{"1":"14 1","2":"Gilead Sciences[B]NASDAQ: GILD","3":"NASDAQ: GILD","4":"179.6 (Jun 2013)","5":"82.3","6":"81.6","7":"93.6","8":"96.6","9":"145.8","10":"109.0","11":"78.4","12":"Biotech"},{"1":"15 2","2":"Bayer[P]FWB: BAYN","3":"FWB: BAYN","4":"129.0 (Mar 2015)","5":"80.1","6":"63.1","7":"101.9","8":"85.3","9":"103.2","10":"113.2","11":"117.4","12":"Pharma"},{"1":"16 2","2":"Stryker Corporation[P]NYSE: SYK","3":"NYSE: SYK","4":"78.5 (Dec 2019)","5":"78.5","6":"58.6","7":"58.0","8":"45.1","9":"34.7","10":"35.7","11":"28.4","12":"Pharma"},{"1":"17 6","2":"Sanofi[P]NYSE: SNY","3":"NYSE: SNY","4":"151.3 (Sep 2014)","5":"63.5","6":"108.4","7":"108.2","8":"101.8","9":"111.8","10":"138.1","11":"142.0","12":"Pharma"},{"1":"18 5","2":"Zoetis[P]NASDAQ: ZTS","3":"NASDAQ: ZTS","4":"76.6 (Aug 2020)","5":"63.2","6":"41.4","7":"35.1","8":"26.4","9":"23.8","10":"21.6","11":"16.3","12":"Pharma"},{"1":"19 1","2":"/ Teva Pharmaceuticals [P]NYSE: TEVA","3":"NYSE: TEVA","4":"110.5 (Jul 2015)","5":"48.3","6":"16.2","7":"24.4","8":"32.7","9":"13.2","10":"70.5","11":"29.3","12":"Pharma"},{"1":"20 1","2":"Takeda Pharmaceutical[P]NASDAQ: TAK","3":"NASDAQ: TAK","4":"61.5 (Dec 2019)","5":"61.5","6":"52.9","7":"40.2","8":"45.6","9":"47.8","10":"37.5","11":"34.3","12":"Pharma"},{"1":"21 1","2":"Vertex Pharmaceuticals[P]NASDAQ: VRTX","3":"NASDAQ: VRTX","4":"78.9 (Jul 2020)","5":"56.3","6":"42.2","7":"37.9","8":"18.3","9":"31.0","10":"28.7","11":"17.4","12":"Pharma"},{"1":"22 6","2":"Biogen[B]NASDAQ: BIIB","3":"NASDAQ: BIIB","4":"111.7 (Mar 2015)","5":"54.7","6":"63.5","7":"67.4","8":"61.6","9":"68.3","10":"79.7","11":"66.1","12":"Biotech"},{"1":"23 2","2":"Illumina[B]NASDAQ: ILMN","3":"NASDAQ: ILMN","4":"56.0 (Jul 2019)","5":"48.2","6":"44.1","7":"40.2","8":"39.4","9":"35.4","10":"28.6","11":"25.7","12":"Biotech"},{"1":"24","2":"Regeneron Pharmaceuticals[B]NASDAQ: REGN","3":"NASDAQ: REGN","4":"61.4 (Aug 2015)","5":"41.2","6":"40.3","7":"40.4","8":"39.3","9":"56.5","10":"42.0","11":"27.4","12":"Biotech"},{"1":"25","2":"Astellas[P]TYO: 4503","3":"TYO: 4503","4":"40.6 (Dec 2015)","5":"32.7","6":"23.8","7":"29.3","8":"25.7","9":"40.6","10":"35.8","11":"27.6","12":"Pharma"},{"1":"26 1","2":"Daiichi Sankyo[P]NASDAQ: DSNKY","3":"NASDAQ: DSNKY","4":"45.3 (Dec 2019)","5":"45.3","6":"22.7","7":"27.5","8":"35.3","9":"38.8","10":"33.2","11":"28.7","12":"Pharma"},{"1":"27 1","2":"Alexion Pharmaceuticals[P]NASDAQ: ALXN","3":"NASDAQ: ALXN","4":"47.0 (Jul 2015)","5":"24.3","6":"21.7","7":"26.7","8":"27.4","9":"43.1","10":"36.7","11":"26.0","12":"Pharma"},{"1":"28 2","2":"Eisai Pharmaceutical[P]TYO: 4523","3":"TYO: 4523","4":"37.3 (Dec 2016)","5":"21.5","6":"23.0","7":"24.5","8":"37.3","9":"28.8","10":"30.2","11":"28.7","12":"Pharma"},{"1":"29 2","2":"Incyte[P]NASDAQ: INCY","3":"NASDAQ: INCY","4":"31.2 (Mar 2017)","5":"18.8","6":"13.5","7":"18.3","8":"15.4","9":"10.6","10":"7.3","11":"4.6","12":"Pharma"},{"1":"30 1","2":"BioMarin[P]NASDAQ: BMRN","3":"NASDAQ: BMRN","4":"24.0 (Jul 2015)","5":"15.2","6":"15.1","7":"18.3","8":"20.4","9":"13.8","10":"12.9","11":"10.8","12":"Pharma"},{"1":"31 1","2":"Genmab[B]NASDAQ: GMAB","3":"NASDAQ: GMAB","4":"24.7 (Aug 2020)","5":"14.5","6":"10.6","7":"10.8","8":"10.8","9":"8.8","10":"3.8","11":"2.6","12":"Biotech"},{"1":"32 2","2":"Mylan[P]NASDAQ: MYL","3":"NASDAQ: MYL","4":"38.8 (Dec 2015)","5":"10.4","6":"14.1","7":"27.5","8":"30.3","9":"38.8","10":"33.2","11":"35.7","12":"Pharma"},{"1":"36","2":"Bausch Health[P]TSX: BHC","3":"TSX: BHC","4":"31.2 (Aug 2020)","5":"41.5","6":"10.0","7":"21.0","8":"4.5","9":"8.1","10":"9.0","11":"-","12":"Pharma"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="stock_exch-stock_id" class="section level3" number="5.4.2">
<h3 number="5.4.2"><span class="header-section-number">5.4.2</span> <code>stock_exch</code> &amp; <code>stock_id</code></h3>
<p>We will use the <code>company_etc</code> column to create <code>stock_exch</code> and <code>stock_id</code>.</p>
<pre class="r"><code>TopPharmComp %&gt;% 
  # first separate the columns
    separate(col = company_etc, 
             into = c(&quot;stock_exch&quot;, &quot;stock_id&quot;), 
             sep = &quot;:&quot;, remove = FALSE) %&gt;% 
  # check our work
  select(company,
         company_etc, 
         contains(&quot;stock&quot;))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["company"],"name":[1],"type":["chr"],"align":["left"]},{"label":["company_etc"],"name":[2],"type":["chr"],"align":["left"]},{"label":["stock_exch"],"name":[3],"type":["chr"],"align":["left"]},{"label":["stock_id"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"Johnson & Johnson[P]NYSE: JNJ","2":"NYSE: JNJ","3":"NYSE","4":"JNJ"},{"1":"Roche[P]SIX: ROG","2":"SIX: ROG","3":"SIX","4":"ROG"},{"1":"Novartis[P]NYSE: NVS","2":"NYSE: NVS","3":"NYSE","4":"NVS"},{"1":"Merck & Co.[P]NYSE: MRK","2":"NYSE: MRK","3":"NYSE","4":"MRK"},{"1":"Pfizer[P]NYSE: PFE","2":"NYSE: PFE","3":"NYSE","4":"PFE"},{"1":"Abbott Laboratories[P]NYSE: ABT","2":"NYSE: ABT","3":"NYSE","4":"ABT"},{"1":"Amgen[B]NASDAQ: AMGN","2":"NASDAQ: AMGN","3":"NASDAQ","4":"AMGN"},{"1":"Novo Nordisk[P]NYSE: NVO","2":"NYSE: NVO","3":"NYSE","4":"NVO"},{"1":"AbbVie[P]NYSE: ABBV","2":"NYSE: ABBV","3":"NYSE","4":"ABBV"},{"1":"AstraZeneca[P]NYSE: AZN","2":"NYSE: AZN","3":"NYSE","4":"AZN"},{"1":"Eli Lilly & Co[P]NYSE: LLY","2":"NYSE: LLY","3":"NYSE","4":"LLY"},{"1":"/  GlaxoSmithKline[P]NYSE: GSK","2":"NYSE: GSK","3":"NYSE","4":"GSK"},{"1":"Bristol-Myers Squibb[P]NASDAQ: BMY","2":"NASDAQ: BMY","3":"NASDAQ","4":"BMY"},{"1":"Gilead Sciences[B]NASDAQ: GILD","2":"NASDAQ: GILD","3":"NASDAQ","4":"GILD"},{"1":"Bayer[P]FWB: BAYN","2":"FWB: BAYN","3":"FWB","4":"BAYN"},{"1":"Stryker Corporation[P]NYSE: SYK","2":"NYSE: SYK","3":"NYSE","4":"SYK"},{"1":"Sanofi[P]NYSE: SNY","2":"NYSE: SNY","3":"NYSE","4":"SNY"},{"1":"Zoetis[P]NASDAQ: ZTS","2":"NASDAQ: ZTS","3":"NASDAQ","4":"ZTS"},{"1":"/ Teva Pharmaceuticals [P]NYSE: TEVA","2":"NYSE: TEVA","3":"NYSE","4":"TEVA"},{"1":"Takeda Pharmaceutical[P]NASDAQ: TAK","2":"NASDAQ: TAK","3":"NASDAQ","4":"TAK"},{"1":"Vertex Pharmaceuticals[P]NASDAQ: VRTX","2":"NASDAQ: VRTX","3":"NASDAQ","4":"VRTX"},{"1":"Biogen[B]NASDAQ: BIIB","2":"NASDAQ: BIIB","3":"NASDAQ","4":"BIIB"},{"1":"Illumina[B]NASDAQ: ILMN","2":"NASDAQ: ILMN","3":"NASDAQ","4":"ILMN"},{"1":"Regeneron Pharmaceuticals[B]NASDAQ: REGN","2":"NASDAQ: REGN","3":"NASDAQ","4":"REGN"},{"1":"Astellas[P]TYO: 4503","2":"TYO: 4503","3":"TYO","4":"4503"},{"1":"Daiichi Sankyo[P]NASDAQ: DSNKY","2":"NASDAQ: DSNKY","3":"NASDAQ","4":"DSNKY"},{"1":"Alexion Pharmaceuticals[P]NASDAQ: ALXN","2":"NASDAQ: ALXN","3":"NASDAQ","4":"ALXN"},{"1":"Eisai Pharmaceutical[P]TYO: 4523","2":"TYO: 4523","3":"TYO","4":"4523"},{"1":"Incyte[P]NASDAQ: INCY","2":"NASDAQ: INCY","3":"NASDAQ","4":"INCY"},{"1":"BioMarin[P]NASDAQ: BMRN","2":"NASDAQ: BMRN","3":"NASDAQ","4":"BMRN"},{"1":"Genmab[B]NASDAQ: GMAB","2":"NASDAQ: GMAB","3":"NASDAQ","4":"GMAB"},{"1":"Mylan[P]NASDAQ: MYL","2":"NASDAQ: MYL","3":"NASDAQ","4":"MYL"},{"1":"Bausch Health[P]TSX: BHC","2":"TSX: BHC","3":"TSX","4":"BHC"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>The <code>sep</code> argument helps us a lot here, so we can create two new variables with minimal steps! We’ll assign to <code>TopPharmComp</code>.</p>
<pre class="r"><code>TopPharmComp &lt;- TopPharmComp %&gt;% 
  # first separate the columns
    separate(col = company_etc, 
             into = c(&quot;stock_exch&quot;, &quot;stock_id&quot;), 
             sep = &quot;:&quot;, remove = FALSE) %&gt;% 
  select(rank, 
         contains(&quot;comp&quot;),
         contains(&quot;stock&quot;),
         everything(), 
         -company_etc)</code></pre>
</div>
<div id="largest_market_cap_date" class="section level3" number="5.4.3">
<h3 number="5.4.3"><span class="header-section-number">5.4.3</span> <code>largest_market_cap_date</code></h3>
<p>Here we’ll use <code>dplyr::rename()</code> to change <code>largest_market_cap_us_bil</code> to <code>_original</code> so we can check our work with <code>remove = FALSE</code>.</p>
<pre class="r"><code>TopPharmComp %&gt;% 
  # rename column to largest_market_cap_original
  dplyr::rename(largest_market_cap_original = largest_market_cap_us_bil) %&gt;% 
  # separate into two columns
  separate(col = largest_market_cap_original, 
           into = c(&#39;largest_market_cap_us_bil&#39;, &#39;largest_market_cap_date&#39;),
           sep = &quot;\\(&quot;, 
           remove = FALSE) %&gt;% 
  # remove parenthesis
  mutate(largest_market_cap_date = 
           str_remove_all(largest_market_cap_date, pattern = &quot;\\)$&quot;)) %&gt;% 
  # check our work
  select(contains(&quot;large&quot;))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["largest_market_cap_original"],"name":[1],"type":["chr"],"align":["left"]},{"label":["largest_market_cap_us_bil"],"name":[2],"type":["chr"],"align":["left"]},{"label":["largest_market_cap_date"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"397.4 (Jan 2018)","2":"397.4","3":"Jan 2018"},{"1":"281.1 (Dec 2019)","2":"281.1","3":"Dec 2019"},{"1":"275.2 (Jul 2015)","2":"275.2","3":"Jul 2015"},{"1":"232.9 (Dec 2019)","2":"232.9","3":"Dec 2019"},{"1":"310.5 (Jul 2000)","2":"310.5","3":"Jul 2000"},{"1":"153.5 (Dec 2019)","2":"153.5","3":"Dec 2019"},{"1":"145.8 (Dec 2019)","2":"145.8","3":"Dec 2019"},{"1":"159.6 (Aug 2015)","2":"159.6","3":"Aug 2015"},{"1":"196.2 (Jan 2018)","2":"196.2","3":"Jan 2018"},{"1":"130.8 (Dec 2019)","2":"130.8","3":"Dec 2019"},{"1":"131.2 (Feb 2019)","2":"131.2","3":"Feb 2019"},{"1":"174.9 (May 2006)","2":"174.9","3":"May 2006"},{"1":"128.3 (Jul 2016)","2":"128.3","3":"Jul 2016"},{"1":"179.6 (Jun 2013)","2":"179.6","3":"Jun 2013"},{"1":"129.0 (Mar 2015)","2":"129.0","3":"Mar 2015"},{"1":"78.5 (Dec 2019)","2":"78.5","3":"Dec 2019"},{"1":"151.3 (Sep 2014)","2":"151.3","3":"Sep 2014"},{"1":"76.6 (Aug 2020)","2":"76.6","3":"Aug 2020"},{"1":"110.5 (Jul 2015)","2":"110.5","3":"Jul 2015"},{"1":"61.5 (Dec 2019)","2":"61.5","3":"Dec 2019"},{"1":"78.9 (Jul 2020)","2":"78.9","3":"Jul 2020"},{"1":"111.7 (Mar 2015)","2":"111.7","3":"Mar 2015"},{"1":"56.0 (Jul 2019)","2":"56.0","3":"Jul 2019"},{"1":"61.4 (Aug 2015)","2":"61.4","3":"Aug 2015"},{"1":"40.6 (Dec 2015)","2":"40.6","3":"Dec 2015"},{"1":"45.3 (Dec 2019)","2":"45.3","3":"Dec 2019"},{"1":"47.0 (Jul 2015)","2":"47.0","3":"Jul 2015"},{"1":"37.3 (Dec 2016)","2":"37.3","3":"Dec 2016"},{"1":"31.2 (Mar 2017)","2":"31.2","3":"Mar 2017"},{"1":"24.0 (Jul 2015)","2":"24.0","3":"Jul 2015"},{"1":"24.7 (Aug 2020)","2":"24.7","3":"Aug 2020"},{"1":"38.8 (Dec 2015)","2":"38.8","3":"Dec 2015"},{"1":"31.2 (Aug 2020)","2":"31.2","3":"Aug 2020"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Now we have the month and year separated into <code>largest_market_cap_date</code>–we can assign to <code>TopPharmComp</code></p>
<pre class="r"><code>TopPharmComp &lt;- TopPharmComp %&gt;% 
  # rename column to largest_market_cap_original
  dplyr::rename(largest_market_cap_original = largest_market_cap_us_bil) %&gt;% 
  # separate into two columns
  separate(col = largest_market_cap_original, 
           into = c(&#39;largest_market_cap_us_bil&#39;, &#39;largest_market_cap_date&#39;),
           sep = &quot;\\(&quot;, 
           remove = FALSE) %&gt;% 
  # remove parenthesis
  mutate(largest_market_cap_date = 
           str_remove_all(largest_market_cap_date, pattern = &quot;\\)$&quot;)) %&gt;% 
  # reorganize
  select(rank, 
         contains(&quot;comp&quot;),
         contains(&quot;stock&quot;),
         contains(&quot;large&quot;),
         everything(), 
         -largest_market_cap_original)</code></pre>
</div>
<div id="company_name" class="section level3" number="5.4.4">
<h3 number="5.4.4"><span class="header-section-number">5.4.4</span> <code>company_name</code></h3>
<p>We will create a <code>company_name</code> variable using a different <code>sep</code> argument here, and we clean the <code>company_name</code> variable with <code>str_remove_all()</code></p>
<pre class="r"><code>TopPharmComp %&gt;% 
  # separate company into 2 columns
  separate(col = company, into = c(&quot;company_name&quot;, &quot;company_junk&quot;), 
           sep = &quot;\\[&quot;,
           remove = FALSE) %&gt;% 
  # remove preceding \
  mutate(company_name = 
           str_remove_all(string = company_name, pattern = &quot;^/&quot;)) %&gt;% 
  # check our work
  select(company, company_name, company_junk)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["company"],"name":[1],"type":["chr"],"align":["left"]},{"label":["company_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["company_junk"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"Johnson & Johnson[P]NYSE: JNJ","2":"Johnson & Johnson","3":"P]NYSE: JNJ"},{"1":"Roche[P]SIX: ROG","2":"Roche","3":"P]SIX: ROG"},{"1":"Novartis[P]NYSE: NVS","2":"Novartis","3":"P]NYSE: NVS"},{"1":"Merck & Co.[P]NYSE: MRK","2":"Merck & Co.","3":"P]NYSE: MRK"},{"1":"Pfizer[P]NYSE: PFE","2":"Pfizer","3":"P]NYSE: PFE"},{"1":"Abbott Laboratories[P]NYSE: ABT","2":"Abbott Laboratories","3":"P]NYSE: ABT"},{"1":"Amgen[B]NASDAQ: AMGN","2":"Amgen","3":"B]NASDAQ: AMGN"},{"1":"Novo Nordisk[P]NYSE: NVO","2":"Novo Nordisk","3":"P]NYSE: NVO"},{"1":"AbbVie[P]NYSE: ABBV","2":"AbbVie","3":"P]NYSE: ABBV"},{"1":"AstraZeneca[P]NYSE: AZN","2":"AstraZeneca","3":"P]NYSE: AZN"},{"1":"Eli Lilly & Co[P]NYSE: LLY","2":"Eli Lilly & Co","3":"P]NYSE: LLY"},{"1":"/  GlaxoSmithKline[P]NYSE: GSK","2":"GlaxoSmithKline","3":"P]NYSE: GSK"},{"1":"Bristol-Myers Squibb[P]NASDAQ: BMY","2":"Bristol-Myers Squibb","3":"P]NASDAQ: BMY"},{"1":"Gilead Sciences[B]NASDAQ: GILD","2":"Gilead Sciences","3":"B]NASDAQ: GILD"},{"1":"Bayer[P]FWB: BAYN","2":"Bayer","3":"P]FWB: BAYN"},{"1":"Stryker Corporation[P]NYSE: SYK","2":"Stryker Corporation","3":"P]NYSE: SYK"},{"1":"Sanofi[P]NYSE: SNY","2":"Sanofi","3":"P]NYSE: SNY"},{"1":"Zoetis[P]NASDAQ: ZTS","2":"Zoetis","3":"P]NASDAQ: ZTS"},{"1":"/ Teva Pharmaceuticals [P]NYSE: TEVA","2":"Teva Pharmaceuticals","3":"P]NYSE: TEVA"},{"1":"Takeda Pharmaceutical[P]NASDAQ: TAK","2":"Takeda Pharmaceutical","3":"P]NASDAQ: TAK"},{"1":"Vertex Pharmaceuticals[P]NASDAQ: VRTX","2":"Vertex Pharmaceuticals","3":"P]NASDAQ: VRTX"},{"1":"Biogen[B]NASDAQ: BIIB","2":"Biogen","3":"B]NASDAQ: BIIB"},{"1":"Illumina[B]NASDAQ: ILMN","2":"Illumina","3":"B]NASDAQ: ILMN"},{"1":"Regeneron Pharmaceuticals[B]NASDAQ: REGN","2":"Regeneron Pharmaceuticals","3":"B]NASDAQ: REGN"},{"1":"Astellas[P]TYO: 4503","2":"Astellas","3":"P]TYO: 4503"},{"1":"Daiichi Sankyo[P]NASDAQ: DSNKY","2":"Daiichi Sankyo","3":"P]NASDAQ: DSNKY"},{"1":"Alexion Pharmaceuticals[P]NASDAQ: ALXN","2":"Alexion Pharmaceuticals","3":"P]NASDAQ: ALXN"},{"1":"Eisai Pharmaceutical[P]TYO: 4523","2":"Eisai Pharmaceutical","3":"P]TYO: 4523"},{"1":"Incyte[P]NASDAQ: INCY","2":"Incyte","3":"P]NASDAQ: INCY"},{"1":"BioMarin[P]NASDAQ: BMRN","2":"BioMarin","3":"P]NASDAQ: BMRN"},{"1":"Genmab[B]NASDAQ: GMAB","2":"Genmab","3":"B]NASDAQ: GMAB"},{"1":"Mylan[P]NASDAQ: MYL","2":"Mylan","3":"P]NASDAQ: MYL"},{"1":"Bausch Health[P]TSX: BHC","2":"Bausch Health","3":"P]TSX: BHC"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This gives us only the name in <code>company_name</code>. We can assign and remove <code>company_junk</code>.</p>
<pre class="r"><code>TopPharmComp &lt;- TopPharmComp %&gt;% 
  # separate company into 2 columns
  separate(col = company, into = c(&quot;company_name&quot;, &quot;company_junk&quot;), 
           sep = &quot;\\[&quot;,
           remove = FALSE) %&gt;% 
  # remove preceding \
  mutate(company_name = 
           str_remove_all(string = company_name, pattern = &quot;^/&quot;)) %&gt;% 
  # reorganize
  select(rank, 
         contains(&quot;comp&quot;),
         contains(&quot;stock&quot;),
         contains(&quot;large&quot;),
         everything(),
         -c(company, company_junk))</code></pre>
</div>
<div id="ranking" class="section level3" number="5.4.5">
<h3 number="5.4.5"><span class="header-section-number">5.4.5</span> <code>ranking</code></h3>
<p>Here we can use <code>str_remove_all()</code> to remove the extra numbers in <code>rank</code> and create the <code>ranking</code> variable.</p>
<pre class="r"><code>TopPharmComp %&gt;% 
  dplyr::mutate(ranking = 
          stringr::str_remove_all(string = rank, pattern = &quot; \\d$&quot;)) %&gt;% 
  select(contains(&quot;rank&quot;))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["rank"],"name":[1],"type":["chr"],"align":["left"]},{"label":["ranking"],"name":[2],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"1"},{"1":"2 1","2":"2"},{"1":"3 2","2":"3"},{"1":"4","2":"4"},{"1":"5 3","2":"5"},{"1":"6 2","2":"6"},{"1":"7","2":"7"},{"1":"8 2","2":"8"},{"1":"9 3","2":"9"},{"1":"10 2","2":"10"},{"1":"11 2","2":"11"},{"1":"12 1","2":"12"},{"1":"13 1","2":"13"},{"1":"14 1","2":"14"},{"1":"15 2","2":"15"},{"1":"16 2","2":"16"},{"1":"17 6","2":"17"},{"1":"18 5","2":"18"},{"1":"19 1","2":"19"},{"1":"20 1","2":"20"},{"1":"21 1","2":"21"},{"1":"22 6","2":"22"},{"1":"23 2","2":"23"},{"1":"24","2":"24"},{"1":"25","2":"25"},{"1":"26 1","2":"26"},{"1":"27 1","2":"27"},{"1":"28 2","2":"28"},{"1":"29 2","2":"29"},{"1":"30 1","2":"30"},{"1":"31 1","2":"31"},{"1":"32 2","2":"32"},{"1":"36","2":"36"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>We assign this to <code>TopPharmComp</code> and move onto the missing values.</p>
<pre class="r"><code>TopPharmComp &lt;- TopPharmComp %&gt;% 
  dplyr::mutate(ranking = 
          stringr::str_remove_all(string = rank, pattern = &quot; \\d$&quot;)) %&gt;% 
  select(ranking, 
         contains(&quot;comp&quot;),
         contains(&quot;stock&quot;),
         contains(&quot;large&quot;),
         everything(),
         # remove rank
         -rank)</code></pre>
</div>
</div>
<div id="missing-values" class="section level2 tabset" number="5.5">
<h2 class="tabset" number="5.5"><span class="header-section-number">5.5</span> Missing Values</h2>
<p>We can see there is a missing value in <code>market_cap_in_2013_us_bil</code> formatted as <code>-</code>. We can change these with <code>dplyr::na_if()</code></p>
<pre class="r"><code>TopPharmComp %&gt;% 
  na_if(x = ., y = &quot;-&quot;) %&gt;% 
  select(market_cap_in_2013_us_bil)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["market_cap_in_2013_us_bil"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"258.3"},{"1":"240.3"},{"1":"195.0"},{"1":"146.5"},{"1":"196.0"},{"1":"59.3"},{"1":"78.7"},{"1":"NA"},{"1":"83.8"},{"1":"74.6"},{"1":"57.0"},{"1":"129.6"},{"1":"87.2"},{"1":"78.4"},{"1":"117.4"},{"1":"28.4"},{"1":"142.0"},{"1":"16.3"},{"1":"29.3"},{"1":"34.3"},{"1":"17.4"},{"1":"66.1"},{"1":"25.7"},{"1":"27.4"},{"1":"27.6"},{"1":"28.7"},{"1":"26.0"},{"1":"28.7"},{"1":"4.6"},{"1":"10.8"},{"1":"2.6"},{"1":"35.7"},{"1":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>We can assign this and move onto formatting the variables.</p>
<pre class="r"><code>TopPharmComp &lt;- TopPharmComp %&gt;% 
  na_if(x = ., y = &quot;-&quot;)</code></pre>
</div>
<div id="format-values" class="section level2 tabset" number="5.6">
<h2 class="tabset" number="5.6"><span class="header-section-number">5.6</span> Format Values</h2>
<p>Let’s take a look with <code>glimpse()</code> to see how these are formatted.</p>
<pre class="r"><code># set width
options(width = 60)
# view transposed data
TopPharmComp %&gt;% glimpse()</code></pre>
<pre><code>## Rows: 33
## Columns: 14
## $ ranking                   &lt;chr&gt; &quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;…
## $ company_name              &lt;chr&gt; &quot;Johnson &amp; Johnson&quot;, &quot;R…
## $ company_type              &lt;chr&gt; &quot;Pharma&quot;, &quot;Pharma&quot;, &quot;Ph…
## $ stock_exch                &lt;chr&gt; &quot;NYSE&quot;, &quot;SIX&quot;, &quot;NYSE&quot;, …
## $ stock_id                  &lt;chr&gt; &quot; JNJ&quot;, &quot; ROG&quot;, &quot; NVS&quot;,…
## $ largest_market_cap_us_bil &lt;chr&gt; &quot;397.4 &quot;, &quot;281.1 &quot;, &quot;27…
## $ largest_market_cap_date   &lt;chr&gt; &quot;Jan 2018&quot;, &quot;Dec 2019&quot;,…
## $ market_cap_in_2019_us_bil &lt;dbl&gt; 385.0, 281.1, 240.0, 23…
## $ market_cap_in_2018_us_bil &lt;dbl&gt; 346.1, 209.3, 200.0, 20…
## $ market_cap_in_2017_us_bil &lt;dbl&gt; 375.4, 216.7, 196.7, 15…
## $ market_cap_in_2016_us_bil &lt;dbl&gt; 314.1, 192.1, 170.5, 16…
## $ market_cap_in_2015_us_bil &lt;dbl&gt; 284.2, 234.7, 206.1, 14…
## $ market_cap_in_2014_us_bil &lt;dbl&gt; 277.8, 258.5, 229.8, 16…
## $ market_cap_in_2013_us_bil &lt;chr&gt; &quot;258.3&quot;, &quot;240.3&quot;, &quot;195.…</code></pre>
<p>We can see the <code>market_cap_in_2013_us_bil</code> and <code>largest_market_cap_us_bil</code> are formatted as <code>character</code>s (but they should be <code>double</code>).</p>
<div id="remove-whitespace" class="section level3" number="5.6.1">
<h3 number="5.6.1"><span class="header-section-number">5.6.1</span> Remove whitespace</h3>
<p>Remove the whitespace from <code>largest_market_cap_us_bil</code> with <code>stringr::str_trim()</code>.</p>
<pre class="r"><code>TopPharmComp %&gt;% 
  mutate(
    largest_market_cap_us_bil = str_trim(string = largest_market_cap_us_bil, 
                                         side = &quot;both&quot;),
    largest_market_cap_us_bil = as.numeric(largest_market_cap_us_bil))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["ranking"],"name":[1],"type":["chr"],"align":["left"]},{"label":["company_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["company_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["stock_exch"],"name":[4],"type":["chr"],"align":["left"]},{"label":["stock_id"],"name":[5],"type":["chr"],"align":["left"]},{"label":["largest_market_cap_us_bil"],"name":[6],"type":["dbl"],"align":["right"]},{"label":["largest_market_cap_date"],"name":[7],"type":["chr"],"align":["left"]},{"label":["market_cap_in_2019_us_bil"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2018_us_bil"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2017_us_bil"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2016_us_bil"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2015_us_bil"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2014_us_bil"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2013_us_bil"],"name":[14],"type":["chr"],"align":["left"]}],"data":[{"1":"1","2":"Johnson & Johnson","3":"Pharma","4":"NYSE","5":"JNJ","6":"397.4","7":"Jan 2018","8":"385.0","9":"346.1","10":"375.4","11":"314.1","12":"284.2","13":"277.8","14":"258.3"},{"1":"2","2":"Roche","3":"Pharma","4":"SIX","5":"ROG","6":"281.1","7":"Dec 2019","8":"281.1","9":"209.3","10":"216.7","11":"192.1","12":"234.7","13":"258.5","14":"240.3"},{"1":"3","2":"Novartis","3":"Pharma","4":"NYSE","5":"NVS","6":"275.2","7":"Jul 2015","8":"240.0","9":"200.0","10":"196.7","11":"170.5","12":"206.1","13":"229.8","14":"195.0"},{"1":"4","2":"Merck & Co.","3":"Pharma","4":"NYSE","5":"MRK","6":"232.9","7":"Dec 2019","8":"232.9","9":"205.8","10":"153.3","11":"164.3","12":"147.6","13":"166.9","14":"146.5"},{"1":"5","2":"Pfizer","3":"Pharma","4":"NYSE","5":"PFE","6":"310.5","7":"Jul 2000","8":"216.7","9":"259.7","10":"215.9","11":"196.3","12":"199.3","13":"205.4","14":"196.0"},{"1":"6","2":"Abbott Laboratories","3":"Pharma","4":"NYSE","5":"ABT","6":"153.5","7":"Dec 2019","8":"153.5","9":"126.8","10":"99.3","11":"56.4","12":"67.0","13":"67.9","14":"59.3"},{"1":"7","2":"Amgen","3":"Biotech","4":"NASDAQ","5":"AMGN","6":"145.8","7":"Dec 2019","8":"144.6","9":"128.8","10":"126.2","11":"108.9","12":"122.5","13":"93.1","14":"78.7"},{"1":"8","2":"Novo Nordisk","3":"Pharma","4":"NYSE","5":"NVO","6":"159.6","7":"Aug 2015","8":"137.1","9":"111.9","10":"131.2","11":"92.6","12":"153.9","13":"125.4","14":"NA"},{"1":"9","2":"AbbVie","3":"Pharma","4":"NYSE","5":"ABBV","6":"196.2","7":"Jan 2018","8":"130.9","9":"146.3","10":"154.4","11":"100.2","12":"96.8","13":"104.1","14":"83.8"},{"1":"10","2":"AstraZeneca","3":"Pharma","4":"NYSE","5":"AZN","6":"130.8","7":"Dec 2019","8":"130.8","9":"96.2","10":"87.9","11":"68.8","12":"85.8","13":"88.9","14":"74.6"},{"1":"11","2":"Eli Lilly & Co","3":"Pharma","4":"NYSE","5":"LLY","6":"131.2","7":"Feb 2019","8":"126.9","9":"125.6","10":"93.0","11":"80.9","12":"93.4","13":"76.6","14":"57.0"},{"1":"12","2":"GlaxoSmithKline","3":"Pharma","4":"NYSE","5":"GSK","6":"174.9","7":"May 2006","8":"117.2","9":"94.8","10":"87.9","11":"93.3","12":"97.6","13":"128.9","14":"129.6"},{"1":"13","2":"Bristol-Myers Squibb","3":"Pharma","4":"NASDAQ","5":"BMY","6":"128.3","7":"Jul 2016","8":"105.0","9":"85.0","10":"100.3","11":"98.2","12":"114.8","13":"97.6","14":"87.2"},{"1":"14","2":"Gilead Sciences","3":"Biotech","4":"NASDAQ","5":"GILD","6":"179.6","7":"Jun 2013","8":"82.3","9":"81.6","10":"93.6","11":"96.6","12":"145.8","13":"109.0","14":"78.4"},{"1":"15","2":"Bayer","3":"Pharma","4":"FWB","5":"BAYN","6":"129.0","7":"Mar 2015","8":"80.1","9":"63.1","10":"101.9","11":"85.3","12":"103.2","13":"113.2","14":"117.4"},{"1":"16","2":"Stryker Corporation","3":"Pharma","4":"NYSE","5":"SYK","6":"78.5","7":"Dec 2019","8":"78.5","9":"58.6","10":"58.0","11":"45.1","12":"34.7","13":"35.7","14":"28.4"},{"1":"17","2":"Sanofi","3":"Pharma","4":"NYSE","5":"SNY","6":"151.3","7":"Sep 2014","8":"63.5","9":"108.4","10":"108.2","11":"101.8","12":"111.8","13":"138.1","14":"142.0"},{"1":"18","2":"Zoetis","3":"Pharma","4":"NASDAQ","5":"ZTS","6":"76.6","7":"Aug 2020","8":"63.2","9":"41.4","10":"35.1","11":"26.4","12":"23.8","13":"21.6","14":"16.3"},{"1":"19","2":"Teva Pharmaceuticals","3":"Pharma","4":"NYSE","5":"TEVA","6":"110.5","7":"Jul 2015","8":"48.3","9":"16.2","10":"24.4","11":"32.7","12":"13.2","13":"70.5","14":"29.3"},{"1":"20","2":"Takeda Pharmaceutical","3":"Pharma","4":"NASDAQ","5":"TAK","6":"61.5","7":"Dec 2019","8":"61.5","9":"52.9","10":"40.2","11":"45.6","12":"47.8","13":"37.5","14":"34.3"},{"1":"21","2":"Vertex Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"VRTX","6":"78.9","7":"Jul 2020","8":"56.3","9":"42.2","10":"37.9","11":"18.3","12":"31.0","13":"28.7","14":"17.4"},{"1":"22","2":"Biogen","3":"Biotech","4":"NASDAQ","5":"BIIB","6":"111.7","7":"Mar 2015","8":"54.7","9":"63.5","10":"67.4","11":"61.6","12":"68.3","13":"79.7","14":"66.1"},{"1":"23","2":"Illumina","3":"Biotech","4":"NASDAQ","5":"ILMN","6":"56.0","7":"Jul 2019","8":"48.2","9":"44.1","10":"40.2","11":"39.4","12":"35.4","13":"28.6","14":"25.7"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"Biotech","4":"NASDAQ","5":"REGN","6":"61.4","7":"Aug 2015","8":"41.2","9":"40.3","10":"40.4","11":"39.3","12":"56.5","13":"42.0","14":"27.4"},{"1":"25","2":"Astellas","3":"Pharma","4":"TYO","5":"4503","6":"40.6","7":"Dec 2015","8":"32.7","9":"23.8","10":"29.3","11":"25.7","12":"40.6","13":"35.8","14":"27.6"},{"1":"26","2":"Daiichi Sankyo","3":"Pharma","4":"NASDAQ","5":"DSNKY","6":"45.3","7":"Dec 2019","8":"45.3","9":"22.7","10":"27.5","11":"35.3","12":"38.8","13":"33.2","14":"28.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"ALXN","6":"47.0","7":"Jul 2015","8":"24.3","9":"21.7","10":"26.7","11":"27.4","12":"43.1","13":"36.7","14":"26.0"},{"1":"28","2":"Eisai Pharmaceutical","3":"Pharma","4":"TYO","5":"4523","6":"37.3","7":"Dec 2016","8":"21.5","9":"23.0","10":"24.5","11":"37.3","12":"28.8","13":"30.2","14":"28.7"},{"1":"29","2":"Incyte","3":"Pharma","4":"NASDAQ","5":"INCY","6":"31.2","7":"Mar 2017","8":"18.8","9":"13.5","10":"18.3","11":"15.4","12":"10.6","13":"7.3","14":"4.6"},{"1":"30","2":"BioMarin","3":"Pharma","4":"NASDAQ","5":"BMRN","6":"24.0","7":"Jul 2015","8":"15.2","9":"15.1","10":"18.3","11":"20.4","12":"13.8","13":"12.9","14":"10.8"},{"1":"31","2":"Genmab","3":"Biotech","4":"NASDAQ","5":"GMAB","6":"24.7","7":"Aug 2020","8":"14.5","9":"10.6","10":"10.8","11":"10.8","12":"8.8","13":"3.8","14":"2.6"},{"1":"32","2":"Mylan","3":"Pharma","4":"NASDAQ","5":"MYL","6":"38.8","7":"Dec 2015","8":"10.4","9":"14.1","10":"27.5","11":"30.3","12":"38.8","13":"33.2","14":"35.7"},{"1":"36","2":"Bausch Health","3":"Pharma","4":"TSX","5":"BHC","6":"31.2","7":"Aug 2020","8":"41.5","9":"10.0","10":"21.0","11":"4.5","12":"8.1","13":"9.0","14":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This is working on the <code>largest_market_cap_us_bil</code>–assign this to <code>TopPharmComp</code>.</p>
<pre class="r"><code>TopPharmComp &lt;- TopPharmComp %&gt;% 
  mutate(
    largest_market_cap_us_bil = str_trim(string = largest_market_cap_us_bil, 
                                         side = &quot;both&quot;),
    largest_market_cap_us_bil = as.numeric(largest_market_cap_us_bil))</code></pre>
<p>We will also format <code>market_cap_in_2013_us_bil</code> as a numeric value.</p>
<pre class="r"><code>TopPharmComp &lt;- TopPharmComp %&gt;% 
  mutate(
    market_cap_in_2013_us_bil = as.numeric(market_cap_in_2013_us_bil))</code></pre>
</div>
<div id="dates" class="section level3" number="5.6.2">
<h3 number="5.6.2"><span class="header-section-number">5.6.2</span> Dates</h3>
<p>We will use the <code>_original</code> suffix again to check our work.</p>
<pre class="r"><code>TopPharmComp %&gt;% 
  rename(cap_date_original = largest_market_cap_date) %&gt;% 
  mutate(largest_market_cap_date = lubridate::my(cap_date_original)) %&gt;% 
  dplyr::select(contains(&quot;date&quot;))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["cap_date_original"],"name":[1],"type":["chr"],"align":["left"]},{"label":["largest_market_cap_date"],"name":[2],"type":["date"],"align":["right"]}],"data":[{"1":"Jan 2018","2":"2018-01-01"},{"1":"Dec 2019","2":"2019-12-01"},{"1":"Jul 2015","2":"2015-07-01"},{"1":"Dec 2019","2":"2019-12-01"},{"1":"Jul 2000","2":"2000-07-01"},{"1":"Dec 2019","2":"2019-12-01"},{"1":"Dec 2019","2":"2019-12-01"},{"1":"Aug 2015","2":"2015-08-01"},{"1":"Jan 2018","2":"2018-01-01"},{"1":"Dec 2019","2":"2019-12-01"},{"1":"Feb 2019","2":"2019-02-01"},{"1":"May 2006","2":"2006-05-01"},{"1":"Jul 2016","2":"2016-07-01"},{"1":"Jun 2013","2":"2013-06-01"},{"1":"Mar 2015","2":"2015-03-01"},{"1":"Dec 2019","2":"2019-12-01"},{"1":"Sep 2014","2":"2014-09-01"},{"1":"Aug 2020","2":"2020-08-01"},{"1":"Jul 2015","2":"2015-07-01"},{"1":"Dec 2019","2":"2019-12-01"},{"1":"Jul 2020","2":"2020-07-01"},{"1":"Mar 2015","2":"2015-03-01"},{"1":"Jul 2019","2":"2019-07-01"},{"1":"Aug 2015","2":"2015-08-01"},{"1":"Dec 2015","2":"2015-12-01"},{"1":"Dec 2019","2":"2019-12-01"},{"1":"Jul 2015","2":"2015-07-01"},{"1":"Dec 2016","2":"2016-12-01"},{"1":"Mar 2017","2":"2017-03-01"},{"1":"Jul 2015","2":"2015-07-01"},{"1":"Aug 2020","2":"2020-08-01"},{"1":"Dec 2015","2":"2015-12-01"},{"1":"Aug 2020","2":"2020-08-01"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This is giving us the date in <code>largest_market_cap_date</code>, but each day is rounded to the first day of the relative month (which is OK). Assign to <code>TopPharmComp</code> (but keep <code>cap_date_original</code>).</p>
<pre class="r"><code>TopPharmComp &lt;- TopPharmComp %&gt;% 
  # rename
  rename(cap_date_original = largest_market_cap_date) %&gt;% 
  # change format 
  mutate(largest_market_cap_date = lubridate::my(cap_date_original)) %&gt;% 
  # reorganize
  select(ranking, 
         contains(&quot;comp&quot;),
         contains(&quot;stock&quot;),
         contains(&quot;date&quot;),
         contains(&quot;us_bil&quot;))
TopPharmComp</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["ranking"],"name":[1],"type":["chr"],"align":["left"]},{"label":["company_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["company_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["stock_exch"],"name":[4],"type":["chr"],"align":["left"]},{"label":["stock_id"],"name":[5],"type":["chr"],"align":["left"]},{"label":["cap_date_original"],"name":[6],"type":["chr"],"align":["left"]},{"label":["largest_market_cap_date"],"name":[7],"type":["date"],"align":["right"]},{"label":["largest_market_cap_us_bil"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2019_us_bil"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2018_us_bil"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2017_us_bil"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2016_us_bil"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2015_us_bil"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2014_us_bil"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2013_us_bil"],"name":[15],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"Johnson & Johnson","3":"Pharma","4":"NYSE","5":"JNJ","6":"Jan 2018","7":"2018-01-01","8":"397.4","9":"385.0","10":"346.1","11":"375.4","12":"314.1","13":"284.2","14":"277.8","15":"258.3"},{"1":"2","2":"Roche","3":"Pharma","4":"SIX","5":"ROG","6":"Dec 2019","7":"2019-12-01","8":"281.1","9":"281.1","10":"209.3","11":"216.7","12":"192.1","13":"234.7","14":"258.5","15":"240.3"},{"1":"3","2":"Novartis","3":"Pharma","4":"NYSE","5":"NVS","6":"Jul 2015","7":"2015-07-01","8":"275.2","9":"240.0","10":"200.0","11":"196.7","12":"170.5","13":"206.1","14":"229.8","15":"195.0"},{"1":"4","2":"Merck & Co.","3":"Pharma","4":"NYSE","5":"MRK","6":"Dec 2019","7":"2019-12-01","8":"232.9","9":"232.9","10":"205.8","11":"153.3","12":"164.3","13":"147.6","14":"166.9","15":"146.5"},{"1":"5","2":"Pfizer","3":"Pharma","4":"NYSE","5":"PFE","6":"Jul 2000","7":"2000-07-01","8":"310.5","9":"216.7","10":"259.7","11":"215.9","12":"196.3","13":"199.3","14":"205.4","15":"196.0"},{"1":"6","2":"Abbott Laboratories","3":"Pharma","4":"NYSE","5":"ABT","6":"Dec 2019","7":"2019-12-01","8":"153.5","9":"153.5","10":"126.8","11":"99.3","12":"56.4","13":"67.0","14":"67.9","15":"59.3"},{"1":"7","2":"Amgen","3":"Biotech","4":"NASDAQ","5":"AMGN","6":"Dec 2019","7":"2019-12-01","8":"145.8","9":"144.6","10":"128.8","11":"126.2","12":"108.9","13":"122.5","14":"93.1","15":"78.7"},{"1":"8","2":"Novo Nordisk","3":"Pharma","4":"NYSE","5":"NVO","6":"Aug 2015","7":"2015-08-01","8":"159.6","9":"137.1","10":"111.9","11":"131.2","12":"92.6","13":"153.9","14":"125.4","15":"NA"},{"1":"9","2":"AbbVie","3":"Pharma","4":"NYSE","5":"ABBV","6":"Jan 2018","7":"2018-01-01","8":"196.2","9":"130.9","10":"146.3","11":"154.4","12":"100.2","13":"96.8","14":"104.1","15":"83.8"},{"1":"10","2":"AstraZeneca","3":"Pharma","4":"NYSE","5":"AZN","6":"Dec 2019","7":"2019-12-01","8":"130.8","9":"130.8","10":"96.2","11":"87.9","12":"68.8","13":"85.8","14":"88.9","15":"74.6"},{"1":"11","2":"Eli Lilly & Co","3":"Pharma","4":"NYSE","5":"LLY","6":"Feb 2019","7":"2019-02-01","8":"131.2","9":"126.9","10":"125.6","11":"93.0","12":"80.9","13":"93.4","14":"76.6","15":"57.0"},{"1":"12","2":"GlaxoSmithKline","3":"Pharma","4":"NYSE","5":"GSK","6":"May 2006","7":"2006-05-01","8":"174.9","9":"117.2","10":"94.8","11":"87.9","12":"93.3","13":"97.6","14":"128.9","15":"129.6"},{"1":"13","2":"Bristol-Myers Squibb","3":"Pharma","4":"NASDAQ","5":"BMY","6":"Jul 2016","7":"2016-07-01","8":"128.3","9":"105.0","10":"85.0","11":"100.3","12":"98.2","13":"114.8","14":"97.6","15":"87.2"},{"1":"14","2":"Gilead Sciences","3":"Biotech","4":"NASDAQ","5":"GILD","6":"Jun 2013","7":"2013-06-01","8":"179.6","9":"82.3","10":"81.6","11":"93.6","12":"96.6","13":"145.8","14":"109.0","15":"78.4"},{"1":"15","2":"Bayer","3":"Pharma","4":"FWB","5":"BAYN","6":"Mar 2015","7":"2015-03-01","8":"129.0","9":"80.1","10":"63.1","11":"101.9","12":"85.3","13":"103.2","14":"113.2","15":"117.4"},{"1":"16","2":"Stryker Corporation","3":"Pharma","4":"NYSE","5":"SYK","6":"Dec 2019","7":"2019-12-01","8":"78.5","9":"78.5","10":"58.6","11":"58.0","12":"45.1","13":"34.7","14":"35.7","15":"28.4"},{"1":"17","2":"Sanofi","3":"Pharma","4":"NYSE","5":"SNY","6":"Sep 2014","7":"2014-09-01","8":"151.3","9":"63.5","10":"108.4","11":"108.2","12":"101.8","13":"111.8","14":"138.1","15":"142.0"},{"1":"18","2":"Zoetis","3":"Pharma","4":"NASDAQ","5":"ZTS","6":"Aug 2020","7":"2020-08-01","8":"76.6","9":"63.2","10":"41.4","11":"35.1","12":"26.4","13":"23.8","14":"21.6","15":"16.3"},{"1":"19","2":"Teva Pharmaceuticals","3":"Pharma","4":"NYSE","5":"TEVA","6":"Jul 2015","7":"2015-07-01","8":"110.5","9":"48.3","10":"16.2","11":"24.4","12":"32.7","13":"13.2","14":"70.5","15":"29.3"},{"1":"20","2":"Takeda Pharmaceutical","3":"Pharma","4":"NASDAQ","5":"TAK","6":"Dec 2019","7":"2019-12-01","8":"61.5","9":"61.5","10":"52.9","11":"40.2","12":"45.6","13":"47.8","14":"37.5","15":"34.3"},{"1":"21","2":"Vertex Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"VRTX","6":"Jul 2020","7":"2020-07-01","8":"78.9","9":"56.3","10":"42.2","11":"37.9","12":"18.3","13":"31.0","14":"28.7","15":"17.4"},{"1":"22","2":"Biogen","3":"Biotech","4":"NASDAQ","5":"BIIB","6":"Mar 2015","7":"2015-03-01","8":"111.7","9":"54.7","10":"63.5","11":"67.4","12":"61.6","13":"68.3","14":"79.7","15":"66.1"},{"1":"23","2":"Illumina","3":"Biotech","4":"NASDAQ","5":"ILMN","6":"Jul 2019","7":"2019-07-01","8":"56.0","9":"48.2","10":"44.1","11":"40.2","12":"39.4","13":"35.4","14":"28.6","15":"25.7"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"Biotech","4":"NASDAQ","5":"REGN","6":"Aug 2015","7":"2015-08-01","8":"61.4","9":"41.2","10":"40.3","11":"40.4","12":"39.3","13":"56.5","14":"42.0","15":"27.4"},{"1":"25","2":"Astellas","3":"Pharma","4":"TYO","5":"4503","6":"Dec 2015","7":"2015-12-01","8":"40.6","9":"32.7","10":"23.8","11":"29.3","12":"25.7","13":"40.6","14":"35.8","15":"27.6"},{"1":"26","2":"Daiichi Sankyo","3":"Pharma","4":"NASDAQ","5":"DSNKY","6":"Dec 2019","7":"2019-12-01","8":"45.3","9":"45.3","10":"22.7","11":"27.5","12":"35.3","13":"38.8","14":"33.2","15":"28.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"ALXN","6":"Jul 2015","7":"2015-07-01","8":"47.0","9":"24.3","10":"21.7","11":"26.7","12":"27.4","13":"43.1","14":"36.7","15":"26.0"},{"1":"28","2":"Eisai Pharmaceutical","3":"Pharma","4":"TYO","5":"4523","6":"Dec 2016","7":"2016-12-01","8":"37.3","9":"21.5","10":"23.0","11":"24.5","12":"37.3","13":"28.8","14":"30.2","15":"28.7"},{"1":"29","2":"Incyte","3":"Pharma","4":"NASDAQ","5":"INCY","6":"Mar 2017","7":"2017-03-01","8":"31.2","9":"18.8","10":"13.5","11":"18.3","12":"15.4","13":"10.6","14":"7.3","15":"4.6"},{"1":"30","2":"BioMarin","3":"Pharma","4":"NASDAQ","5":"BMRN","6":"Jul 2015","7":"2015-07-01","8":"24.0","9":"15.2","10":"15.1","11":"18.3","12":"20.4","13":"13.8","14":"12.9","15":"10.8"},{"1":"31","2":"Genmab","3":"Biotech","4":"NASDAQ","5":"GMAB","6":"Aug 2020","7":"2020-08-01","8":"24.7","9":"14.5","10":"10.6","11":"10.8","12":"10.8","13":"8.8","14":"3.8","15":"2.6"},{"1":"32","2":"Mylan","3":"Pharma","4":"NASDAQ","5":"MYL","6":"Dec 2015","7":"2015-12-01","8":"38.8","9":"10.4","10":"14.1","11":"27.5","12":"30.3","13":"38.8","14":"33.2","15":"35.7"},{"1":"36","2":"Bausch Health","3":"Pharma","4":"TSX","5":"BHC","6":"Aug 2020","7":"2020-08-01","8":"31.2","9":"41.5","10":"10.0","11":"21.0","12":"4.5","13":"8.1","14":"9.0","15":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="factors" class="section level3" number="5.6.3">
<h3 number="5.6.3"><span class="header-section-number">5.6.3</span> Factors</h3>
<p>We want to keep the order of <code>ranking</code>, so we will format this as an ordered factor. We don’t need to supply any <code>levels</code> because they are already numeric.</p>
<pre class="r"><code>TopPharmComp &lt;- TopPharmComp %&gt;% 
  mutate(
    ranking = as.integer(ranking),
    ranking = factor(ranking, ordered = TRUE))
# check
TopPharmComp %&gt;% arrange(ranking)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["ranking"],"name":[1],"type":["ord"],"align":["right"]},{"label":["company_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["company_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["stock_exch"],"name":[4],"type":["chr"],"align":["left"]},{"label":["stock_id"],"name":[5],"type":["chr"],"align":["left"]},{"label":["cap_date_original"],"name":[6],"type":["chr"],"align":["left"]},{"label":["largest_market_cap_date"],"name":[7],"type":["date"],"align":["right"]},{"label":["largest_market_cap_us_bil"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2019_us_bil"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2018_us_bil"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2017_us_bil"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2016_us_bil"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2015_us_bil"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2014_us_bil"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2013_us_bil"],"name":[15],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"Johnson & Johnson","3":"Pharma","4":"NYSE","5":"JNJ","6":"Jan 2018","7":"2018-01-01","8":"397.4","9":"385.0","10":"346.1","11":"375.4","12":"314.1","13":"284.2","14":"277.8","15":"258.3"},{"1":"2","2":"Roche","3":"Pharma","4":"SIX","5":"ROG","6":"Dec 2019","7":"2019-12-01","8":"281.1","9":"281.1","10":"209.3","11":"216.7","12":"192.1","13":"234.7","14":"258.5","15":"240.3"},{"1":"3","2":"Novartis","3":"Pharma","4":"NYSE","5":"NVS","6":"Jul 2015","7":"2015-07-01","8":"275.2","9":"240.0","10":"200.0","11":"196.7","12":"170.5","13":"206.1","14":"229.8","15":"195.0"},{"1":"4","2":"Merck & Co.","3":"Pharma","4":"NYSE","5":"MRK","6":"Dec 2019","7":"2019-12-01","8":"232.9","9":"232.9","10":"205.8","11":"153.3","12":"164.3","13":"147.6","14":"166.9","15":"146.5"},{"1":"5","2":"Pfizer","3":"Pharma","4":"NYSE","5":"PFE","6":"Jul 2000","7":"2000-07-01","8":"310.5","9":"216.7","10":"259.7","11":"215.9","12":"196.3","13":"199.3","14":"205.4","15":"196.0"},{"1":"6","2":"Abbott Laboratories","3":"Pharma","4":"NYSE","5":"ABT","6":"Dec 2019","7":"2019-12-01","8":"153.5","9":"153.5","10":"126.8","11":"99.3","12":"56.4","13":"67.0","14":"67.9","15":"59.3"},{"1":"7","2":"Amgen","3":"Biotech","4":"NASDAQ","5":"AMGN","6":"Dec 2019","7":"2019-12-01","8":"145.8","9":"144.6","10":"128.8","11":"126.2","12":"108.9","13":"122.5","14":"93.1","15":"78.7"},{"1":"8","2":"Novo Nordisk","3":"Pharma","4":"NYSE","5":"NVO","6":"Aug 2015","7":"2015-08-01","8":"159.6","9":"137.1","10":"111.9","11":"131.2","12":"92.6","13":"153.9","14":"125.4","15":"NA"},{"1":"9","2":"AbbVie","3":"Pharma","4":"NYSE","5":"ABBV","6":"Jan 2018","7":"2018-01-01","8":"196.2","9":"130.9","10":"146.3","11":"154.4","12":"100.2","13":"96.8","14":"104.1","15":"83.8"},{"1":"10","2":"AstraZeneca","3":"Pharma","4":"NYSE","5":"AZN","6":"Dec 2019","7":"2019-12-01","8":"130.8","9":"130.8","10":"96.2","11":"87.9","12":"68.8","13":"85.8","14":"88.9","15":"74.6"},{"1":"11","2":"Eli Lilly & Co","3":"Pharma","4":"NYSE","5":"LLY","6":"Feb 2019","7":"2019-02-01","8":"131.2","9":"126.9","10":"125.6","11":"93.0","12":"80.9","13":"93.4","14":"76.6","15":"57.0"},{"1":"12","2":"GlaxoSmithKline","3":"Pharma","4":"NYSE","5":"GSK","6":"May 2006","7":"2006-05-01","8":"174.9","9":"117.2","10":"94.8","11":"87.9","12":"93.3","13":"97.6","14":"128.9","15":"129.6"},{"1":"13","2":"Bristol-Myers Squibb","3":"Pharma","4":"NASDAQ","5":"BMY","6":"Jul 2016","7":"2016-07-01","8":"128.3","9":"105.0","10":"85.0","11":"100.3","12":"98.2","13":"114.8","14":"97.6","15":"87.2"},{"1":"14","2":"Gilead Sciences","3":"Biotech","4":"NASDAQ","5":"GILD","6":"Jun 2013","7":"2013-06-01","8":"179.6","9":"82.3","10":"81.6","11":"93.6","12":"96.6","13":"145.8","14":"109.0","15":"78.4"},{"1":"15","2":"Bayer","3":"Pharma","4":"FWB","5":"BAYN","6":"Mar 2015","7":"2015-03-01","8":"129.0","9":"80.1","10":"63.1","11":"101.9","12":"85.3","13":"103.2","14":"113.2","15":"117.4"},{"1":"16","2":"Stryker Corporation","3":"Pharma","4":"NYSE","5":"SYK","6":"Dec 2019","7":"2019-12-01","8":"78.5","9":"78.5","10":"58.6","11":"58.0","12":"45.1","13":"34.7","14":"35.7","15":"28.4"},{"1":"17","2":"Sanofi","3":"Pharma","4":"NYSE","5":"SNY","6":"Sep 2014","7":"2014-09-01","8":"151.3","9":"63.5","10":"108.4","11":"108.2","12":"101.8","13":"111.8","14":"138.1","15":"142.0"},{"1":"18","2":"Zoetis","3":"Pharma","4":"NASDAQ","5":"ZTS","6":"Aug 2020","7":"2020-08-01","8":"76.6","9":"63.2","10":"41.4","11":"35.1","12":"26.4","13":"23.8","14":"21.6","15":"16.3"},{"1":"19","2":"Teva Pharmaceuticals","3":"Pharma","4":"NYSE","5":"TEVA","6":"Jul 2015","7":"2015-07-01","8":"110.5","9":"48.3","10":"16.2","11":"24.4","12":"32.7","13":"13.2","14":"70.5","15":"29.3"},{"1":"20","2":"Takeda Pharmaceutical","3":"Pharma","4":"NASDAQ","5":"TAK","6":"Dec 2019","7":"2019-12-01","8":"61.5","9":"61.5","10":"52.9","11":"40.2","12":"45.6","13":"47.8","14":"37.5","15":"34.3"},{"1":"21","2":"Vertex Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"VRTX","6":"Jul 2020","7":"2020-07-01","8":"78.9","9":"56.3","10":"42.2","11":"37.9","12":"18.3","13":"31.0","14":"28.7","15":"17.4"},{"1":"22","2":"Biogen","3":"Biotech","4":"NASDAQ","5":"BIIB","6":"Mar 2015","7":"2015-03-01","8":"111.7","9":"54.7","10":"63.5","11":"67.4","12":"61.6","13":"68.3","14":"79.7","15":"66.1"},{"1":"23","2":"Illumina","3":"Biotech","4":"NASDAQ","5":"ILMN","6":"Jul 2019","7":"2019-07-01","8":"56.0","9":"48.2","10":"44.1","11":"40.2","12":"39.4","13":"35.4","14":"28.6","15":"25.7"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"Biotech","4":"NASDAQ","5":"REGN","6":"Aug 2015","7":"2015-08-01","8":"61.4","9":"41.2","10":"40.3","11":"40.4","12":"39.3","13":"56.5","14":"42.0","15":"27.4"},{"1":"25","2":"Astellas","3":"Pharma","4":"TYO","5":"4503","6":"Dec 2015","7":"2015-12-01","8":"40.6","9":"32.7","10":"23.8","11":"29.3","12":"25.7","13":"40.6","14":"35.8","15":"27.6"},{"1":"26","2":"Daiichi Sankyo","3":"Pharma","4":"NASDAQ","5":"DSNKY","6":"Dec 2019","7":"2019-12-01","8":"45.3","9":"45.3","10":"22.7","11":"27.5","12":"35.3","13":"38.8","14":"33.2","15":"28.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"ALXN","6":"Jul 2015","7":"2015-07-01","8":"47.0","9":"24.3","10":"21.7","11":"26.7","12":"27.4","13":"43.1","14":"36.7","15":"26.0"},{"1":"28","2":"Eisai Pharmaceutical","3":"Pharma","4":"TYO","5":"4523","6":"Dec 2016","7":"2016-12-01","8":"37.3","9":"21.5","10":"23.0","11":"24.5","12":"37.3","13":"28.8","14":"30.2","15":"28.7"},{"1":"29","2":"Incyte","3":"Pharma","4":"NASDAQ","5":"INCY","6":"Mar 2017","7":"2017-03-01","8":"31.2","9":"18.8","10":"13.5","11":"18.3","12":"15.4","13":"10.6","14":"7.3","15":"4.6"},{"1":"30","2":"BioMarin","3":"Pharma","4":"NASDAQ","5":"BMRN","6":"Jul 2015","7":"2015-07-01","8":"24.0","9":"15.2","10":"15.1","11":"18.3","12":"20.4","13":"13.8","14":"12.9","15":"10.8"},{"1":"31","2":"Genmab","3":"Biotech","4":"NASDAQ","5":"GMAB","6":"Aug 2020","7":"2020-08-01","8":"24.7","9":"14.5","10":"10.6","11":"10.8","12":"10.8","13":"8.8","14":"3.8","15":"2.6"},{"1":"32","2":"Mylan","3":"Pharma","4":"NASDAQ","5":"MYL","6":"Dec 2015","7":"2015-12-01","8":"38.8","9":"10.4","10":"14.1","11":"27.5","12":"30.3","13":"38.8","14":"33.2","15":"35.7"},{"1":"36","2":"Bausch Health","3":"Pharma","4":"TSX","5":"BHC","6":"Aug 2020","7":"2020-08-01","8":"31.2","9":"41.5","10":"10.0","11":"21.0","12":"4.5","13":"8.1","14":"9.0","15":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="tidy-data" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Tidy Data</h1>
<p>These data are in a wide format, with each <code>market_cap_in_</code> spread across columns.</p>
<pre class="r"><code>TopPharmComp</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["ranking"],"name":[1],"type":["ord"],"align":["right"]},{"label":["company_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["company_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["stock_exch"],"name":[4],"type":["chr"],"align":["left"]},{"label":["stock_id"],"name":[5],"type":["chr"],"align":["left"]},{"label":["cap_date_original"],"name":[6],"type":["chr"],"align":["left"]},{"label":["largest_market_cap_date"],"name":[7],"type":["date"],"align":["right"]},{"label":["largest_market_cap_us_bil"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2019_us_bil"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2018_us_bil"],"name":[10],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2017_us_bil"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2016_us_bil"],"name":[12],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2015_us_bil"],"name":[13],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2014_us_bil"],"name":[14],"type":["dbl"],"align":["right"]},{"label":["market_cap_in_2013_us_bil"],"name":[15],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"Johnson & Johnson","3":"Pharma","4":"NYSE","5":"JNJ","6":"Jan 2018","7":"2018-01-01","8":"397.4","9":"385.0","10":"346.1","11":"375.4","12":"314.1","13":"284.2","14":"277.8","15":"258.3"},{"1":"2","2":"Roche","3":"Pharma","4":"SIX","5":"ROG","6":"Dec 2019","7":"2019-12-01","8":"281.1","9":"281.1","10":"209.3","11":"216.7","12":"192.1","13":"234.7","14":"258.5","15":"240.3"},{"1":"3","2":"Novartis","3":"Pharma","4":"NYSE","5":"NVS","6":"Jul 2015","7":"2015-07-01","8":"275.2","9":"240.0","10":"200.0","11":"196.7","12":"170.5","13":"206.1","14":"229.8","15":"195.0"},{"1":"4","2":"Merck & Co.","3":"Pharma","4":"NYSE","5":"MRK","6":"Dec 2019","7":"2019-12-01","8":"232.9","9":"232.9","10":"205.8","11":"153.3","12":"164.3","13":"147.6","14":"166.9","15":"146.5"},{"1":"5","2":"Pfizer","3":"Pharma","4":"NYSE","5":"PFE","6":"Jul 2000","7":"2000-07-01","8":"310.5","9":"216.7","10":"259.7","11":"215.9","12":"196.3","13":"199.3","14":"205.4","15":"196.0"},{"1":"6","2":"Abbott Laboratories","3":"Pharma","4":"NYSE","5":"ABT","6":"Dec 2019","7":"2019-12-01","8":"153.5","9":"153.5","10":"126.8","11":"99.3","12":"56.4","13":"67.0","14":"67.9","15":"59.3"},{"1":"7","2":"Amgen","3":"Biotech","4":"NASDAQ","5":"AMGN","6":"Dec 2019","7":"2019-12-01","8":"145.8","9":"144.6","10":"128.8","11":"126.2","12":"108.9","13":"122.5","14":"93.1","15":"78.7"},{"1":"8","2":"Novo Nordisk","3":"Pharma","4":"NYSE","5":"NVO","6":"Aug 2015","7":"2015-08-01","8":"159.6","9":"137.1","10":"111.9","11":"131.2","12":"92.6","13":"153.9","14":"125.4","15":"NA"},{"1":"9","2":"AbbVie","3":"Pharma","4":"NYSE","5":"ABBV","6":"Jan 2018","7":"2018-01-01","8":"196.2","9":"130.9","10":"146.3","11":"154.4","12":"100.2","13":"96.8","14":"104.1","15":"83.8"},{"1":"10","2":"AstraZeneca","3":"Pharma","4":"NYSE","5":"AZN","6":"Dec 2019","7":"2019-12-01","8":"130.8","9":"130.8","10":"96.2","11":"87.9","12":"68.8","13":"85.8","14":"88.9","15":"74.6"},{"1":"11","2":"Eli Lilly & Co","3":"Pharma","4":"NYSE","5":"LLY","6":"Feb 2019","7":"2019-02-01","8":"131.2","9":"126.9","10":"125.6","11":"93.0","12":"80.9","13":"93.4","14":"76.6","15":"57.0"},{"1":"12","2":"GlaxoSmithKline","3":"Pharma","4":"NYSE","5":"GSK","6":"May 2006","7":"2006-05-01","8":"174.9","9":"117.2","10":"94.8","11":"87.9","12":"93.3","13":"97.6","14":"128.9","15":"129.6"},{"1":"13","2":"Bristol-Myers Squibb","3":"Pharma","4":"NASDAQ","5":"BMY","6":"Jul 2016","7":"2016-07-01","8":"128.3","9":"105.0","10":"85.0","11":"100.3","12":"98.2","13":"114.8","14":"97.6","15":"87.2"},{"1":"14","2":"Gilead Sciences","3":"Biotech","4":"NASDAQ","5":"GILD","6":"Jun 2013","7":"2013-06-01","8":"179.6","9":"82.3","10":"81.6","11":"93.6","12":"96.6","13":"145.8","14":"109.0","15":"78.4"},{"1":"15","2":"Bayer","3":"Pharma","4":"FWB","5":"BAYN","6":"Mar 2015","7":"2015-03-01","8":"129.0","9":"80.1","10":"63.1","11":"101.9","12":"85.3","13":"103.2","14":"113.2","15":"117.4"},{"1":"16","2":"Stryker Corporation","3":"Pharma","4":"NYSE","5":"SYK","6":"Dec 2019","7":"2019-12-01","8":"78.5","9":"78.5","10":"58.6","11":"58.0","12":"45.1","13":"34.7","14":"35.7","15":"28.4"},{"1":"17","2":"Sanofi","3":"Pharma","4":"NYSE","5":"SNY","6":"Sep 2014","7":"2014-09-01","8":"151.3","9":"63.5","10":"108.4","11":"108.2","12":"101.8","13":"111.8","14":"138.1","15":"142.0"},{"1":"18","2":"Zoetis","3":"Pharma","4":"NASDAQ","5":"ZTS","6":"Aug 2020","7":"2020-08-01","8":"76.6","9":"63.2","10":"41.4","11":"35.1","12":"26.4","13":"23.8","14":"21.6","15":"16.3"},{"1":"19","2":"Teva Pharmaceuticals","3":"Pharma","4":"NYSE","5":"TEVA","6":"Jul 2015","7":"2015-07-01","8":"110.5","9":"48.3","10":"16.2","11":"24.4","12":"32.7","13":"13.2","14":"70.5","15":"29.3"},{"1":"20","2":"Takeda Pharmaceutical","3":"Pharma","4":"NASDAQ","5":"TAK","6":"Dec 2019","7":"2019-12-01","8":"61.5","9":"61.5","10":"52.9","11":"40.2","12":"45.6","13":"47.8","14":"37.5","15":"34.3"},{"1":"21","2":"Vertex Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"VRTX","6":"Jul 2020","7":"2020-07-01","8":"78.9","9":"56.3","10":"42.2","11":"37.9","12":"18.3","13":"31.0","14":"28.7","15":"17.4"},{"1":"22","2":"Biogen","3":"Biotech","4":"NASDAQ","5":"BIIB","6":"Mar 2015","7":"2015-03-01","8":"111.7","9":"54.7","10":"63.5","11":"67.4","12":"61.6","13":"68.3","14":"79.7","15":"66.1"},{"1":"23","2":"Illumina","3":"Biotech","4":"NASDAQ","5":"ILMN","6":"Jul 2019","7":"2019-07-01","8":"56.0","9":"48.2","10":"44.1","11":"40.2","12":"39.4","13":"35.4","14":"28.6","15":"25.7"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"Biotech","4":"NASDAQ","5":"REGN","6":"Aug 2015","7":"2015-08-01","8":"61.4","9":"41.2","10":"40.3","11":"40.4","12":"39.3","13":"56.5","14":"42.0","15":"27.4"},{"1":"25","2":"Astellas","3":"Pharma","4":"TYO","5":"4503","6":"Dec 2015","7":"2015-12-01","8":"40.6","9":"32.7","10":"23.8","11":"29.3","12":"25.7","13":"40.6","14":"35.8","15":"27.6"},{"1":"26","2":"Daiichi Sankyo","3":"Pharma","4":"NASDAQ","5":"DSNKY","6":"Dec 2019","7":"2019-12-01","8":"45.3","9":"45.3","10":"22.7","11":"27.5","12":"35.3","13":"38.8","14":"33.2","15":"28.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"ALXN","6":"Jul 2015","7":"2015-07-01","8":"47.0","9":"24.3","10":"21.7","11":"26.7","12":"27.4","13":"43.1","14":"36.7","15":"26.0"},{"1":"28","2":"Eisai Pharmaceutical","3":"Pharma","4":"TYO","5":"4523","6":"Dec 2016","7":"2016-12-01","8":"37.3","9":"21.5","10":"23.0","11":"24.5","12":"37.3","13":"28.8","14":"30.2","15":"28.7"},{"1":"29","2":"Incyte","3":"Pharma","4":"NASDAQ","5":"INCY","6":"Mar 2017","7":"2017-03-01","8":"31.2","9":"18.8","10":"13.5","11":"18.3","12":"15.4","13":"10.6","14":"7.3","15":"4.6"},{"1":"30","2":"BioMarin","3":"Pharma","4":"NASDAQ","5":"BMRN","6":"Jul 2015","7":"2015-07-01","8":"24.0","9":"15.2","10":"15.1","11":"18.3","12":"20.4","13":"13.8","14":"12.9","15":"10.8"},{"1":"31","2":"Genmab","3":"Biotech","4":"NASDAQ","5":"GMAB","6":"Aug 2020","7":"2020-08-01","8":"24.7","9":"14.5","10":"10.6","11":"10.8","12":"10.8","13":"8.8","14":"3.8","15":"2.6"},{"1":"32","2":"Mylan","3":"Pharma","4":"NASDAQ","5":"MYL","6":"Dec 2015","7":"2015-12-01","8":"38.8","9":"10.4","10":"14.1","11":"27.5","12":"30.3","13":"38.8","14":"33.2","15":"35.7"},{"1":"36","2":"Bausch Health","3":"Pharma","4":"TSX","5":"BHC","6":"Aug 2020","7":"2020-08-01","8":"31.2","9":"41.5","10":"10.0","11":"21.0","12":"4.5","13":"8.1","14":"9.0","15":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="pivot-data" class="section level2 tabset" number="6.1">
<h2 class="tabset" number="6.1"><span class="header-section-number">6.1</span> Pivot data</h2>
<p>Ideally, we want two variables, <code>market_cap_year</code> and <code>market_cap_us_bil</code>.</p>
<div id="pivot_longer" class="section level3" number="6.1.1">
<h3 number="6.1.1"><span class="header-section-number">6.1.1</span> <code>pivot_longer</code></h3>
<p>We can re-shape <code>TopPharmComp</code> with <code>tidyr::pivot_longer()</code>.</p>
<pre class="r"><code>TopPharmComp %&gt;% 
  tidyr::pivot_longer(cols = starts_with(&quot;market_cap&quot;), 
                      names_to = &quot;market_cap_year&quot;, 
                      values_to = &quot;market_cap_us_bil&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["ranking"],"name":[1],"type":["ord"],"align":["right"]},{"label":["company_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["company_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["stock_exch"],"name":[4],"type":["chr"],"align":["left"]},{"label":["stock_id"],"name":[5],"type":["chr"],"align":["left"]},{"label":["cap_date_original"],"name":[6],"type":["chr"],"align":["left"]},{"label":["largest_market_cap_date"],"name":[7],"type":["date"],"align":["right"]},{"label":["largest_market_cap_us_bil"],"name":[8],"type":["dbl"],"align":["right"]},{"label":["market_cap_year"],"name":[9],"type":["chr"],"align":["left"]},{"label":["market_cap_us_bil"],"name":[10],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"Johnson & Johnson","3":"Pharma","4":"NYSE","5":"JNJ","6":"Jan 2018","7":"2018-01-01","8":"397.4","9":"market_cap_in_2019_us_bil","10":"385.0"},{"1":"1","2":"Johnson & Johnson","3":"Pharma","4":"NYSE","5":"JNJ","6":"Jan 2018","7":"2018-01-01","8":"397.4","9":"market_cap_in_2018_us_bil","10":"346.1"},{"1":"1","2":"Johnson & Johnson","3":"Pharma","4":"NYSE","5":"JNJ","6":"Jan 2018","7":"2018-01-01","8":"397.4","9":"market_cap_in_2017_us_bil","10":"375.4"},{"1":"1","2":"Johnson & Johnson","3":"Pharma","4":"NYSE","5":"JNJ","6":"Jan 2018","7":"2018-01-01","8":"397.4","9":"market_cap_in_2016_us_bil","10":"314.1"},{"1":"1","2":"Johnson & Johnson","3":"Pharma","4":"NYSE","5":"JNJ","6":"Jan 2018","7":"2018-01-01","8":"397.4","9":"market_cap_in_2015_us_bil","10":"284.2"},{"1":"1","2":"Johnson & Johnson","3":"Pharma","4":"NYSE","5":"JNJ","6":"Jan 2018","7":"2018-01-01","8":"397.4","9":"market_cap_in_2014_us_bil","10":"277.8"},{"1":"1","2":"Johnson & Johnson","3":"Pharma","4":"NYSE","5":"JNJ","6":"Jan 2018","7":"2018-01-01","8":"397.4","9":"market_cap_in_2013_us_bil","10":"258.3"},{"1":"2","2":"Roche","3":"Pharma","4":"SIX","5":"ROG","6":"Dec 2019","7":"2019-12-01","8":"281.1","9":"market_cap_in_2019_us_bil","10":"281.1"},{"1":"2","2":"Roche","3":"Pharma","4":"SIX","5":"ROG","6":"Dec 2019","7":"2019-12-01","8":"281.1","9":"market_cap_in_2018_us_bil","10":"209.3"},{"1":"2","2":"Roche","3":"Pharma","4":"SIX","5":"ROG","6":"Dec 2019","7":"2019-12-01","8":"281.1","9":"market_cap_in_2017_us_bil","10":"216.7"},{"1":"2","2":"Roche","3":"Pharma","4":"SIX","5":"ROG","6":"Dec 2019","7":"2019-12-01","8":"281.1","9":"market_cap_in_2016_us_bil","10":"192.1"},{"1":"2","2":"Roche","3":"Pharma","4":"SIX","5":"ROG","6":"Dec 2019","7":"2019-12-01","8":"281.1","9":"market_cap_in_2015_us_bil","10":"234.7"},{"1":"2","2":"Roche","3":"Pharma","4":"SIX","5":"ROG","6":"Dec 2019","7":"2019-12-01","8":"281.1","9":"market_cap_in_2014_us_bil","10":"258.5"},{"1":"2","2":"Roche","3":"Pharma","4":"SIX","5":"ROG","6":"Dec 2019","7":"2019-12-01","8":"281.1","9":"market_cap_in_2013_us_bil","10":"240.3"},{"1":"3","2":"Novartis","3":"Pharma","4":"NYSE","5":"NVS","6":"Jul 2015","7":"2015-07-01","8":"275.2","9":"market_cap_in_2019_us_bil","10":"240.0"},{"1":"3","2":"Novartis","3":"Pharma","4":"NYSE","5":"NVS","6":"Jul 2015","7":"2015-07-01","8":"275.2","9":"market_cap_in_2018_us_bil","10":"200.0"},{"1":"3","2":"Novartis","3":"Pharma","4":"NYSE","5":"NVS","6":"Jul 2015","7":"2015-07-01","8":"275.2","9":"market_cap_in_2017_us_bil","10":"196.7"},{"1":"3","2":"Novartis","3":"Pharma","4":"NYSE","5":"NVS","6":"Jul 2015","7":"2015-07-01","8":"275.2","9":"market_cap_in_2016_us_bil","10":"170.5"},{"1":"3","2":"Novartis","3":"Pharma","4":"NYSE","5":"NVS","6":"Jul 2015","7":"2015-07-01","8":"275.2","9":"market_cap_in_2015_us_bil","10":"206.1"},{"1":"3","2":"Novartis","3":"Pharma","4":"NYSE","5":"NVS","6":"Jul 2015","7":"2015-07-01","8":"275.2","9":"market_cap_in_2014_us_bil","10":"229.8"},{"1":"3","2":"Novartis","3":"Pharma","4":"NYSE","5":"NVS","6":"Jul 2015","7":"2015-07-01","8":"275.2","9":"market_cap_in_2013_us_bil","10":"195.0"},{"1":"4","2":"Merck & Co.","3":"Pharma","4":"NYSE","5":"MRK","6":"Dec 2019","7":"2019-12-01","8":"232.9","9":"market_cap_in_2019_us_bil","10":"232.9"},{"1":"4","2":"Merck & Co.","3":"Pharma","4":"NYSE","5":"MRK","6":"Dec 2019","7":"2019-12-01","8":"232.9","9":"market_cap_in_2018_us_bil","10":"205.8"},{"1":"4","2":"Merck & Co.","3":"Pharma","4":"NYSE","5":"MRK","6":"Dec 2019","7":"2019-12-01","8":"232.9","9":"market_cap_in_2017_us_bil","10":"153.3"},{"1":"4","2":"Merck & Co.","3":"Pharma","4":"NYSE","5":"MRK","6":"Dec 2019","7":"2019-12-01","8":"232.9","9":"market_cap_in_2016_us_bil","10":"164.3"},{"1":"4","2":"Merck & Co.","3":"Pharma","4":"NYSE","5":"MRK","6":"Dec 2019","7":"2019-12-01","8":"232.9","9":"market_cap_in_2015_us_bil","10":"147.6"},{"1":"4","2":"Merck & Co.","3":"Pharma","4":"NYSE","5":"MRK","6":"Dec 2019","7":"2019-12-01","8":"232.9","9":"market_cap_in_2014_us_bil","10":"166.9"},{"1":"4","2":"Merck & Co.","3":"Pharma","4":"NYSE","5":"MRK","6":"Dec 2019","7":"2019-12-01","8":"232.9","9":"market_cap_in_2013_us_bil","10":"146.5"},{"1":"5","2":"Pfizer","3":"Pharma","4":"NYSE","5":"PFE","6":"Jul 2000","7":"2000-07-01","8":"310.5","9":"market_cap_in_2019_us_bil","10":"216.7"},{"1":"5","2":"Pfizer","3":"Pharma","4":"NYSE","5":"PFE","6":"Jul 2000","7":"2000-07-01","8":"310.5","9":"market_cap_in_2018_us_bil","10":"259.7"},{"1":"5","2":"Pfizer","3":"Pharma","4":"NYSE","5":"PFE","6":"Jul 2000","7":"2000-07-01","8":"310.5","9":"market_cap_in_2017_us_bil","10":"215.9"},{"1":"5","2":"Pfizer","3":"Pharma","4":"NYSE","5":"PFE","6":"Jul 2000","7":"2000-07-01","8":"310.5","9":"market_cap_in_2016_us_bil","10":"196.3"},{"1":"5","2":"Pfizer","3":"Pharma","4":"NYSE","5":"PFE","6":"Jul 2000","7":"2000-07-01","8":"310.5","9":"market_cap_in_2015_us_bil","10":"199.3"},{"1":"5","2":"Pfizer","3":"Pharma","4":"NYSE","5":"PFE","6":"Jul 2000","7":"2000-07-01","8":"310.5","9":"market_cap_in_2014_us_bil","10":"205.4"},{"1":"5","2":"Pfizer","3":"Pharma","4":"NYSE","5":"PFE","6":"Jul 2000","7":"2000-07-01","8":"310.5","9":"market_cap_in_2013_us_bil","10":"196.0"},{"1":"6","2":"Abbott Laboratories","3":"Pharma","4":"NYSE","5":"ABT","6":"Dec 2019","7":"2019-12-01","8":"153.5","9":"market_cap_in_2019_us_bil","10":"153.5"},{"1":"6","2":"Abbott Laboratories","3":"Pharma","4":"NYSE","5":"ABT","6":"Dec 2019","7":"2019-12-01","8":"153.5","9":"market_cap_in_2018_us_bil","10":"126.8"},{"1":"6","2":"Abbott Laboratories","3":"Pharma","4":"NYSE","5":"ABT","6":"Dec 2019","7":"2019-12-01","8":"153.5","9":"market_cap_in_2017_us_bil","10":"99.3"},{"1":"6","2":"Abbott Laboratories","3":"Pharma","4":"NYSE","5":"ABT","6":"Dec 2019","7":"2019-12-01","8":"153.5","9":"market_cap_in_2016_us_bil","10":"56.4"},{"1":"6","2":"Abbott Laboratories","3":"Pharma","4":"NYSE","5":"ABT","6":"Dec 2019","7":"2019-12-01","8":"153.5","9":"market_cap_in_2015_us_bil","10":"67.0"},{"1":"6","2":"Abbott Laboratories","3":"Pharma","4":"NYSE","5":"ABT","6":"Dec 2019","7":"2019-12-01","8":"153.5","9":"market_cap_in_2014_us_bil","10":"67.9"},{"1":"6","2":"Abbott Laboratories","3":"Pharma","4":"NYSE","5":"ABT","6":"Dec 2019","7":"2019-12-01","8":"153.5","9":"market_cap_in_2013_us_bil","10":"59.3"},{"1":"7","2":"Amgen","3":"Biotech","4":"NASDAQ","5":"AMGN","6":"Dec 2019","7":"2019-12-01","8":"145.8","9":"market_cap_in_2019_us_bil","10":"144.6"},{"1":"7","2":"Amgen","3":"Biotech","4":"NASDAQ","5":"AMGN","6":"Dec 2019","7":"2019-12-01","8":"145.8","9":"market_cap_in_2018_us_bil","10":"128.8"},{"1":"7","2":"Amgen","3":"Biotech","4":"NASDAQ","5":"AMGN","6":"Dec 2019","7":"2019-12-01","8":"145.8","9":"market_cap_in_2017_us_bil","10":"126.2"},{"1":"7","2":"Amgen","3":"Biotech","4":"NASDAQ","5":"AMGN","6":"Dec 2019","7":"2019-12-01","8":"145.8","9":"market_cap_in_2016_us_bil","10":"108.9"},{"1":"7","2":"Amgen","3":"Biotech","4":"NASDAQ","5":"AMGN","6":"Dec 2019","7":"2019-12-01","8":"145.8","9":"market_cap_in_2015_us_bil","10":"122.5"},{"1":"7","2":"Amgen","3":"Biotech","4":"NASDAQ","5":"AMGN","6":"Dec 2019","7":"2019-12-01","8":"145.8","9":"market_cap_in_2014_us_bil","10":"93.1"},{"1":"7","2":"Amgen","3":"Biotech","4":"NASDAQ","5":"AMGN","6":"Dec 2019","7":"2019-12-01","8":"145.8","9":"market_cap_in_2013_us_bil","10":"78.7"},{"1":"8","2":"Novo Nordisk","3":"Pharma","4":"NYSE","5":"NVO","6":"Aug 2015","7":"2015-08-01","8":"159.6","9":"market_cap_in_2019_us_bil","10":"137.1"},{"1":"8","2":"Novo Nordisk","3":"Pharma","4":"NYSE","5":"NVO","6":"Aug 2015","7":"2015-08-01","8":"159.6","9":"market_cap_in_2018_us_bil","10":"111.9"},{"1":"8","2":"Novo Nordisk","3":"Pharma","4":"NYSE","5":"NVO","6":"Aug 2015","7":"2015-08-01","8":"159.6","9":"market_cap_in_2017_us_bil","10":"131.2"},{"1":"8","2":"Novo Nordisk","3":"Pharma","4":"NYSE","5":"NVO","6":"Aug 2015","7":"2015-08-01","8":"159.6","9":"market_cap_in_2016_us_bil","10":"92.6"},{"1":"8","2":"Novo Nordisk","3":"Pharma","4":"NYSE","5":"NVO","6":"Aug 2015","7":"2015-08-01","8":"159.6","9":"market_cap_in_2015_us_bil","10":"153.9"},{"1":"8","2":"Novo Nordisk","3":"Pharma","4":"NYSE","5":"NVO","6":"Aug 2015","7":"2015-08-01","8":"159.6","9":"market_cap_in_2014_us_bil","10":"125.4"},{"1":"8","2":"Novo Nordisk","3":"Pharma","4":"NYSE","5":"NVO","6":"Aug 2015","7":"2015-08-01","8":"159.6","9":"market_cap_in_2013_us_bil","10":"NA"},{"1":"9","2":"AbbVie","3":"Pharma","4":"NYSE","5":"ABBV","6":"Jan 2018","7":"2018-01-01","8":"196.2","9":"market_cap_in_2019_us_bil","10":"130.9"},{"1":"9","2":"AbbVie","3":"Pharma","4":"NYSE","5":"ABBV","6":"Jan 2018","7":"2018-01-01","8":"196.2","9":"market_cap_in_2018_us_bil","10":"146.3"},{"1":"9","2":"AbbVie","3":"Pharma","4":"NYSE","5":"ABBV","6":"Jan 2018","7":"2018-01-01","8":"196.2","9":"market_cap_in_2017_us_bil","10":"154.4"},{"1":"9","2":"AbbVie","3":"Pharma","4":"NYSE","5":"ABBV","6":"Jan 2018","7":"2018-01-01","8":"196.2","9":"market_cap_in_2016_us_bil","10":"100.2"},{"1":"9","2":"AbbVie","3":"Pharma","4":"NYSE","5":"ABBV","6":"Jan 2018","7":"2018-01-01","8":"196.2","9":"market_cap_in_2015_us_bil","10":"96.8"},{"1":"9","2":"AbbVie","3":"Pharma","4":"NYSE","5":"ABBV","6":"Jan 2018","7":"2018-01-01","8":"196.2","9":"market_cap_in_2014_us_bil","10":"104.1"},{"1":"9","2":"AbbVie","3":"Pharma","4":"NYSE","5":"ABBV","6":"Jan 2018","7":"2018-01-01","8":"196.2","9":"market_cap_in_2013_us_bil","10":"83.8"},{"1":"10","2":"AstraZeneca","3":"Pharma","4":"NYSE","5":"AZN","6":"Dec 2019","7":"2019-12-01","8":"130.8","9":"market_cap_in_2019_us_bil","10":"130.8"},{"1":"10","2":"AstraZeneca","3":"Pharma","4":"NYSE","5":"AZN","6":"Dec 2019","7":"2019-12-01","8":"130.8","9":"market_cap_in_2018_us_bil","10":"96.2"},{"1":"10","2":"AstraZeneca","3":"Pharma","4":"NYSE","5":"AZN","6":"Dec 2019","7":"2019-12-01","8":"130.8","9":"market_cap_in_2017_us_bil","10":"87.9"},{"1":"10","2":"AstraZeneca","3":"Pharma","4":"NYSE","5":"AZN","6":"Dec 2019","7":"2019-12-01","8":"130.8","9":"market_cap_in_2016_us_bil","10":"68.8"},{"1":"10","2":"AstraZeneca","3":"Pharma","4":"NYSE","5":"AZN","6":"Dec 2019","7":"2019-12-01","8":"130.8","9":"market_cap_in_2015_us_bil","10":"85.8"},{"1":"10","2":"AstraZeneca","3":"Pharma","4":"NYSE","5":"AZN","6":"Dec 2019","7":"2019-12-01","8":"130.8","9":"market_cap_in_2014_us_bil","10":"88.9"},{"1":"10","2":"AstraZeneca","3":"Pharma","4":"NYSE","5":"AZN","6":"Dec 2019","7":"2019-12-01","8":"130.8","9":"market_cap_in_2013_us_bil","10":"74.6"},{"1":"11","2":"Eli Lilly & Co","3":"Pharma","4":"NYSE","5":"LLY","6":"Feb 2019","7":"2019-02-01","8":"131.2","9":"market_cap_in_2019_us_bil","10":"126.9"},{"1":"11","2":"Eli Lilly & Co","3":"Pharma","4":"NYSE","5":"LLY","6":"Feb 2019","7":"2019-02-01","8":"131.2","9":"market_cap_in_2018_us_bil","10":"125.6"},{"1":"11","2":"Eli Lilly & Co","3":"Pharma","4":"NYSE","5":"LLY","6":"Feb 2019","7":"2019-02-01","8":"131.2","9":"market_cap_in_2017_us_bil","10":"93.0"},{"1":"11","2":"Eli Lilly & Co","3":"Pharma","4":"NYSE","5":"LLY","6":"Feb 2019","7":"2019-02-01","8":"131.2","9":"market_cap_in_2016_us_bil","10":"80.9"},{"1":"11","2":"Eli Lilly & Co","3":"Pharma","4":"NYSE","5":"LLY","6":"Feb 2019","7":"2019-02-01","8":"131.2","9":"market_cap_in_2015_us_bil","10":"93.4"},{"1":"11","2":"Eli Lilly & Co","3":"Pharma","4":"NYSE","5":"LLY","6":"Feb 2019","7":"2019-02-01","8":"131.2","9":"market_cap_in_2014_us_bil","10":"76.6"},{"1":"11","2":"Eli Lilly & Co","3":"Pharma","4":"NYSE","5":"LLY","6":"Feb 2019","7":"2019-02-01","8":"131.2","9":"market_cap_in_2013_us_bil","10":"57.0"},{"1":"12","2":"GlaxoSmithKline","3":"Pharma","4":"NYSE","5":"GSK","6":"May 2006","7":"2006-05-01","8":"174.9","9":"market_cap_in_2019_us_bil","10":"117.2"},{"1":"12","2":"GlaxoSmithKline","3":"Pharma","4":"NYSE","5":"GSK","6":"May 2006","7":"2006-05-01","8":"174.9","9":"market_cap_in_2018_us_bil","10":"94.8"},{"1":"12","2":"GlaxoSmithKline","3":"Pharma","4":"NYSE","5":"GSK","6":"May 2006","7":"2006-05-01","8":"174.9","9":"market_cap_in_2017_us_bil","10":"87.9"},{"1":"12","2":"GlaxoSmithKline","3":"Pharma","4":"NYSE","5":"GSK","6":"May 2006","7":"2006-05-01","8":"174.9","9":"market_cap_in_2016_us_bil","10":"93.3"},{"1":"12","2":"GlaxoSmithKline","3":"Pharma","4":"NYSE","5":"GSK","6":"May 2006","7":"2006-05-01","8":"174.9","9":"market_cap_in_2015_us_bil","10":"97.6"},{"1":"12","2":"GlaxoSmithKline","3":"Pharma","4":"NYSE","5":"GSK","6":"May 2006","7":"2006-05-01","8":"174.9","9":"market_cap_in_2014_us_bil","10":"128.9"},{"1":"12","2":"GlaxoSmithKline","3":"Pharma","4":"NYSE","5":"GSK","6":"May 2006","7":"2006-05-01","8":"174.9","9":"market_cap_in_2013_us_bil","10":"129.6"},{"1":"13","2":"Bristol-Myers Squibb","3":"Pharma","4":"NASDAQ","5":"BMY","6":"Jul 2016","7":"2016-07-01","8":"128.3","9":"market_cap_in_2019_us_bil","10":"105.0"},{"1":"13","2":"Bristol-Myers Squibb","3":"Pharma","4":"NASDAQ","5":"BMY","6":"Jul 2016","7":"2016-07-01","8":"128.3","9":"market_cap_in_2018_us_bil","10":"85.0"},{"1":"13","2":"Bristol-Myers Squibb","3":"Pharma","4":"NASDAQ","5":"BMY","6":"Jul 2016","7":"2016-07-01","8":"128.3","9":"market_cap_in_2017_us_bil","10":"100.3"},{"1":"13","2":"Bristol-Myers Squibb","3":"Pharma","4":"NASDAQ","5":"BMY","6":"Jul 2016","7":"2016-07-01","8":"128.3","9":"market_cap_in_2016_us_bil","10":"98.2"},{"1":"13","2":"Bristol-Myers Squibb","3":"Pharma","4":"NASDAQ","5":"BMY","6":"Jul 2016","7":"2016-07-01","8":"128.3","9":"market_cap_in_2015_us_bil","10":"114.8"},{"1":"13","2":"Bristol-Myers Squibb","3":"Pharma","4":"NASDAQ","5":"BMY","6":"Jul 2016","7":"2016-07-01","8":"128.3","9":"market_cap_in_2014_us_bil","10":"97.6"},{"1":"13","2":"Bristol-Myers Squibb","3":"Pharma","4":"NASDAQ","5":"BMY","6":"Jul 2016","7":"2016-07-01","8":"128.3","9":"market_cap_in_2013_us_bil","10":"87.2"},{"1":"14","2":"Gilead Sciences","3":"Biotech","4":"NASDAQ","5":"GILD","6":"Jun 2013","7":"2013-06-01","8":"179.6","9":"market_cap_in_2019_us_bil","10":"82.3"},{"1":"14","2":"Gilead Sciences","3":"Biotech","4":"NASDAQ","5":"GILD","6":"Jun 2013","7":"2013-06-01","8":"179.6","9":"market_cap_in_2018_us_bil","10":"81.6"},{"1":"14","2":"Gilead Sciences","3":"Biotech","4":"NASDAQ","5":"GILD","6":"Jun 2013","7":"2013-06-01","8":"179.6","9":"market_cap_in_2017_us_bil","10":"93.6"},{"1":"14","2":"Gilead Sciences","3":"Biotech","4":"NASDAQ","5":"GILD","6":"Jun 2013","7":"2013-06-01","8":"179.6","9":"market_cap_in_2016_us_bil","10":"96.6"},{"1":"14","2":"Gilead Sciences","3":"Biotech","4":"NASDAQ","5":"GILD","6":"Jun 2013","7":"2013-06-01","8":"179.6","9":"market_cap_in_2015_us_bil","10":"145.8"},{"1":"14","2":"Gilead Sciences","3":"Biotech","4":"NASDAQ","5":"GILD","6":"Jun 2013","7":"2013-06-01","8":"179.6","9":"market_cap_in_2014_us_bil","10":"109.0"},{"1":"14","2":"Gilead Sciences","3":"Biotech","4":"NASDAQ","5":"GILD","6":"Jun 2013","7":"2013-06-01","8":"179.6","9":"market_cap_in_2013_us_bil","10":"78.4"},{"1":"15","2":"Bayer","3":"Pharma","4":"FWB","5":"BAYN","6":"Mar 2015","7":"2015-03-01","8":"129.0","9":"market_cap_in_2019_us_bil","10":"80.1"},{"1":"15","2":"Bayer","3":"Pharma","4":"FWB","5":"BAYN","6":"Mar 2015","7":"2015-03-01","8":"129.0","9":"market_cap_in_2018_us_bil","10":"63.1"},{"1":"15","2":"Bayer","3":"Pharma","4":"FWB","5":"BAYN","6":"Mar 2015","7":"2015-03-01","8":"129.0","9":"market_cap_in_2017_us_bil","10":"101.9"},{"1":"15","2":"Bayer","3":"Pharma","4":"FWB","5":"BAYN","6":"Mar 2015","7":"2015-03-01","8":"129.0","9":"market_cap_in_2016_us_bil","10":"85.3"},{"1":"15","2":"Bayer","3":"Pharma","4":"FWB","5":"BAYN","6":"Mar 2015","7":"2015-03-01","8":"129.0","9":"market_cap_in_2015_us_bil","10":"103.2"},{"1":"15","2":"Bayer","3":"Pharma","4":"FWB","5":"BAYN","6":"Mar 2015","7":"2015-03-01","8":"129.0","9":"market_cap_in_2014_us_bil","10":"113.2"},{"1":"15","2":"Bayer","3":"Pharma","4":"FWB","5":"BAYN","6":"Mar 2015","7":"2015-03-01","8":"129.0","9":"market_cap_in_2013_us_bil","10":"117.4"},{"1":"16","2":"Stryker Corporation","3":"Pharma","4":"NYSE","5":"SYK","6":"Dec 2019","7":"2019-12-01","8":"78.5","9":"market_cap_in_2019_us_bil","10":"78.5"},{"1":"16","2":"Stryker Corporation","3":"Pharma","4":"NYSE","5":"SYK","6":"Dec 2019","7":"2019-12-01","8":"78.5","9":"market_cap_in_2018_us_bil","10":"58.6"},{"1":"16","2":"Stryker Corporation","3":"Pharma","4":"NYSE","5":"SYK","6":"Dec 2019","7":"2019-12-01","8":"78.5","9":"market_cap_in_2017_us_bil","10":"58.0"},{"1":"16","2":"Stryker Corporation","3":"Pharma","4":"NYSE","5":"SYK","6":"Dec 2019","7":"2019-12-01","8":"78.5","9":"market_cap_in_2016_us_bil","10":"45.1"},{"1":"16","2":"Stryker Corporation","3":"Pharma","4":"NYSE","5":"SYK","6":"Dec 2019","7":"2019-12-01","8":"78.5","9":"market_cap_in_2015_us_bil","10":"34.7"},{"1":"16","2":"Stryker Corporation","3":"Pharma","4":"NYSE","5":"SYK","6":"Dec 2019","7":"2019-12-01","8":"78.5","9":"market_cap_in_2014_us_bil","10":"35.7"},{"1":"16","2":"Stryker Corporation","3":"Pharma","4":"NYSE","5":"SYK","6":"Dec 2019","7":"2019-12-01","8":"78.5","9":"market_cap_in_2013_us_bil","10":"28.4"},{"1":"17","2":"Sanofi","3":"Pharma","4":"NYSE","5":"SNY","6":"Sep 2014","7":"2014-09-01","8":"151.3","9":"market_cap_in_2019_us_bil","10":"63.5"},{"1":"17","2":"Sanofi","3":"Pharma","4":"NYSE","5":"SNY","6":"Sep 2014","7":"2014-09-01","8":"151.3","9":"market_cap_in_2018_us_bil","10":"108.4"},{"1":"17","2":"Sanofi","3":"Pharma","4":"NYSE","5":"SNY","6":"Sep 2014","7":"2014-09-01","8":"151.3","9":"market_cap_in_2017_us_bil","10":"108.2"},{"1":"17","2":"Sanofi","3":"Pharma","4":"NYSE","5":"SNY","6":"Sep 2014","7":"2014-09-01","8":"151.3","9":"market_cap_in_2016_us_bil","10":"101.8"},{"1":"17","2":"Sanofi","3":"Pharma","4":"NYSE","5":"SNY","6":"Sep 2014","7":"2014-09-01","8":"151.3","9":"market_cap_in_2015_us_bil","10":"111.8"},{"1":"17","2":"Sanofi","3":"Pharma","4":"NYSE","5":"SNY","6":"Sep 2014","7":"2014-09-01","8":"151.3","9":"market_cap_in_2014_us_bil","10":"138.1"},{"1":"17","2":"Sanofi","3":"Pharma","4":"NYSE","5":"SNY","6":"Sep 2014","7":"2014-09-01","8":"151.3","9":"market_cap_in_2013_us_bil","10":"142.0"},{"1":"18","2":"Zoetis","3":"Pharma","4":"NASDAQ","5":"ZTS","6":"Aug 2020","7":"2020-08-01","8":"76.6","9":"market_cap_in_2019_us_bil","10":"63.2"},{"1":"18","2":"Zoetis","3":"Pharma","4":"NASDAQ","5":"ZTS","6":"Aug 2020","7":"2020-08-01","8":"76.6","9":"market_cap_in_2018_us_bil","10":"41.4"},{"1":"18","2":"Zoetis","3":"Pharma","4":"NASDAQ","5":"ZTS","6":"Aug 2020","7":"2020-08-01","8":"76.6","9":"market_cap_in_2017_us_bil","10":"35.1"},{"1":"18","2":"Zoetis","3":"Pharma","4":"NASDAQ","5":"ZTS","6":"Aug 2020","7":"2020-08-01","8":"76.6","9":"market_cap_in_2016_us_bil","10":"26.4"},{"1":"18","2":"Zoetis","3":"Pharma","4":"NASDAQ","5":"ZTS","6":"Aug 2020","7":"2020-08-01","8":"76.6","9":"market_cap_in_2015_us_bil","10":"23.8"},{"1":"18","2":"Zoetis","3":"Pharma","4":"NASDAQ","5":"ZTS","6":"Aug 2020","7":"2020-08-01","8":"76.6","9":"market_cap_in_2014_us_bil","10":"21.6"},{"1":"18","2":"Zoetis","3":"Pharma","4":"NASDAQ","5":"ZTS","6":"Aug 2020","7":"2020-08-01","8":"76.6","9":"market_cap_in_2013_us_bil","10":"16.3"},{"1":"19","2":"Teva Pharmaceuticals","3":"Pharma","4":"NYSE","5":"TEVA","6":"Jul 2015","7":"2015-07-01","8":"110.5","9":"market_cap_in_2019_us_bil","10":"48.3"},{"1":"19","2":"Teva Pharmaceuticals","3":"Pharma","4":"NYSE","5":"TEVA","6":"Jul 2015","7":"2015-07-01","8":"110.5","9":"market_cap_in_2018_us_bil","10":"16.2"},{"1":"19","2":"Teva Pharmaceuticals","3":"Pharma","4":"NYSE","5":"TEVA","6":"Jul 2015","7":"2015-07-01","8":"110.5","9":"market_cap_in_2017_us_bil","10":"24.4"},{"1":"19","2":"Teva Pharmaceuticals","3":"Pharma","4":"NYSE","5":"TEVA","6":"Jul 2015","7":"2015-07-01","8":"110.5","9":"market_cap_in_2016_us_bil","10":"32.7"},{"1":"19","2":"Teva Pharmaceuticals","3":"Pharma","4":"NYSE","5":"TEVA","6":"Jul 2015","7":"2015-07-01","8":"110.5","9":"market_cap_in_2015_us_bil","10":"13.2"},{"1":"19","2":"Teva Pharmaceuticals","3":"Pharma","4":"NYSE","5":"TEVA","6":"Jul 2015","7":"2015-07-01","8":"110.5","9":"market_cap_in_2014_us_bil","10":"70.5"},{"1":"19","2":"Teva Pharmaceuticals","3":"Pharma","4":"NYSE","5":"TEVA","6":"Jul 2015","7":"2015-07-01","8":"110.5","9":"market_cap_in_2013_us_bil","10":"29.3"},{"1":"20","2":"Takeda Pharmaceutical","3":"Pharma","4":"NASDAQ","5":"TAK","6":"Dec 2019","7":"2019-12-01","8":"61.5","9":"market_cap_in_2019_us_bil","10":"61.5"},{"1":"20","2":"Takeda Pharmaceutical","3":"Pharma","4":"NASDAQ","5":"TAK","6":"Dec 2019","7":"2019-12-01","8":"61.5","9":"market_cap_in_2018_us_bil","10":"52.9"},{"1":"20","2":"Takeda Pharmaceutical","3":"Pharma","4":"NASDAQ","5":"TAK","6":"Dec 2019","7":"2019-12-01","8":"61.5","9":"market_cap_in_2017_us_bil","10":"40.2"},{"1":"20","2":"Takeda Pharmaceutical","3":"Pharma","4":"NASDAQ","5":"TAK","6":"Dec 2019","7":"2019-12-01","8":"61.5","9":"market_cap_in_2016_us_bil","10":"45.6"},{"1":"20","2":"Takeda Pharmaceutical","3":"Pharma","4":"NASDAQ","5":"TAK","6":"Dec 2019","7":"2019-12-01","8":"61.5","9":"market_cap_in_2015_us_bil","10":"47.8"},{"1":"20","2":"Takeda Pharmaceutical","3":"Pharma","4":"NASDAQ","5":"TAK","6":"Dec 2019","7":"2019-12-01","8":"61.5","9":"market_cap_in_2014_us_bil","10":"37.5"},{"1":"20","2":"Takeda Pharmaceutical","3":"Pharma","4":"NASDAQ","5":"TAK","6":"Dec 2019","7":"2019-12-01","8":"61.5","9":"market_cap_in_2013_us_bil","10":"34.3"},{"1":"21","2":"Vertex Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"VRTX","6":"Jul 2020","7":"2020-07-01","8":"78.9","9":"market_cap_in_2019_us_bil","10":"56.3"},{"1":"21","2":"Vertex Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"VRTX","6":"Jul 2020","7":"2020-07-01","8":"78.9","9":"market_cap_in_2018_us_bil","10":"42.2"},{"1":"21","2":"Vertex Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"VRTX","6":"Jul 2020","7":"2020-07-01","8":"78.9","9":"market_cap_in_2017_us_bil","10":"37.9"},{"1":"21","2":"Vertex Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"VRTX","6":"Jul 2020","7":"2020-07-01","8":"78.9","9":"market_cap_in_2016_us_bil","10":"18.3"},{"1":"21","2":"Vertex Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"VRTX","6":"Jul 2020","7":"2020-07-01","8":"78.9","9":"market_cap_in_2015_us_bil","10":"31.0"},{"1":"21","2":"Vertex Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"VRTX","6":"Jul 2020","7":"2020-07-01","8":"78.9","9":"market_cap_in_2014_us_bil","10":"28.7"},{"1":"21","2":"Vertex Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"VRTX","6":"Jul 2020","7":"2020-07-01","8":"78.9","9":"market_cap_in_2013_us_bil","10":"17.4"},{"1":"22","2":"Biogen","3":"Biotech","4":"NASDAQ","5":"BIIB","6":"Mar 2015","7":"2015-03-01","8":"111.7","9":"market_cap_in_2019_us_bil","10":"54.7"},{"1":"22","2":"Biogen","3":"Biotech","4":"NASDAQ","5":"BIIB","6":"Mar 2015","7":"2015-03-01","8":"111.7","9":"market_cap_in_2018_us_bil","10":"63.5"},{"1":"22","2":"Biogen","3":"Biotech","4":"NASDAQ","5":"BIIB","6":"Mar 2015","7":"2015-03-01","8":"111.7","9":"market_cap_in_2017_us_bil","10":"67.4"},{"1":"22","2":"Biogen","3":"Biotech","4":"NASDAQ","5":"BIIB","6":"Mar 2015","7":"2015-03-01","8":"111.7","9":"market_cap_in_2016_us_bil","10":"61.6"},{"1":"22","2":"Biogen","3":"Biotech","4":"NASDAQ","5":"BIIB","6":"Mar 2015","7":"2015-03-01","8":"111.7","9":"market_cap_in_2015_us_bil","10":"68.3"},{"1":"22","2":"Biogen","3":"Biotech","4":"NASDAQ","5":"BIIB","6":"Mar 2015","7":"2015-03-01","8":"111.7","9":"market_cap_in_2014_us_bil","10":"79.7"},{"1":"22","2":"Biogen","3":"Biotech","4":"NASDAQ","5":"BIIB","6":"Mar 2015","7":"2015-03-01","8":"111.7","9":"market_cap_in_2013_us_bil","10":"66.1"},{"1":"23","2":"Illumina","3":"Biotech","4":"NASDAQ","5":"ILMN","6":"Jul 2019","7":"2019-07-01","8":"56.0","9":"market_cap_in_2019_us_bil","10":"48.2"},{"1":"23","2":"Illumina","3":"Biotech","4":"NASDAQ","5":"ILMN","6":"Jul 2019","7":"2019-07-01","8":"56.0","9":"market_cap_in_2018_us_bil","10":"44.1"},{"1":"23","2":"Illumina","3":"Biotech","4":"NASDAQ","5":"ILMN","6":"Jul 2019","7":"2019-07-01","8":"56.0","9":"market_cap_in_2017_us_bil","10":"40.2"},{"1":"23","2":"Illumina","3":"Biotech","4":"NASDAQ","5":"ILMN","6":"Jul 2019","7":"2019-07-01","8":"56.0","9":"market_cap_in_2016_us_bil","10":"39.4"},{"1":"23","2":"Illumina","3":"Biotech","4":"NASDAQ","5":"ILMN","6":"Jul 2019","7":"2019-07-01","8":"56.0","9":"market_cap_in_2015_us_bil","10":"35.4"},{"1":"23","2":"Illumina","3":"Biotech","4":"NASDAQ","5":"ILMN","6":"Jul 2019","7":"2019-07-01","8":"56.0","9":"market_cap_in_2014_us_bil","10":"28.6"},{"1":"23","2":"Illumina","3":"Biotech","4":"NASDAQ","5":"ILMN","6":"Jul 2019","7":"2019-07-01","8":"56.0","9":"market_cap_in_2013_us_bil","10":"25.7"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"Biotech","4":"NASDAQ","5":"REGN","6":"Aug 2015","7":"2015-08-01","8":"61.4","9":"market_cap_in_2019_us_bil","10":"41.2"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"Biotech","4":"NASDAQ","5":"REGN","6":"Aug 2015","7":"2015-08-01","8":"61.4","9":"market_cap_in_2018_us_bil","10":"40.3"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"Biotech","4":"NASDAQ","5":"REGN","6":"Aug 2015","7":"2015-08-01","8":"61.4","9":"market_cap_in_2017_us_bil","10":"40.4"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"Biotech","4":"NASDAQ","5":"REGN","6":"Aug 2015","7":"2015-08-01","8":"61.4","9":"market_cap_in_2016_us_bil","10":"39.3"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"Biotech","4":"NASDAQ","5":"REGN","6":"Aug 2015","7":"2015-08-01","8":"61.4","9":"market_cap_in_2015_us_bil","10":"56.5"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"Biotech","4":"NASDAQ","5":"REGN","6":"Aug 2015","7":"2015-08-01","8":"61.4","9":"market_cap_in_2014_us_bil","10":"42.0"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"Biotech","4":"NASDAQ","5":"REGN","6":"Aug 2015","7":"2015-08-01","8":"61.4","9":"market_cap_in_2013_us_bil","10":"27.4"},{"1":"25","2":"Astellas","3":"Pharma","4":"TYO","5":"4503","6":"Dec 2015","7":"2015-12-01","8":"40.6","9":"market_cap_in_2019_us_bil","10":"32.7"},{"1":"25","2":"Astellas","3":"Pharma","4":"TYO","5":"4503","6":"Dec 2015","7":"2015-12-01","8":"40.6","9":"market_cap_in_2018_us_bil","10":"23.8"},{"1":"25","2":"Astellas","3":"Pharma","4":"TYO","5":"4503","6":"Dec 2015","7":"2015-12-01","8":"40.6","9":"market_cap_in_2017_us_bil","10":"29.3"},{"1":"25","2":"Astellas","3":"Pharma","4":"TYO","5":"4503","6":"Dec 2015","7":"2015-12-01","8":"40.6","9":"market_cap_in_2016_us_bil","10":"25.7"},{"1":"25","2":"Astellas","3":"Pharma","4":"TYO","5":"4503","6":"Dec 2015","7":"2015-12-01","8":"40.6","9":"market_cap_in_2015_us_bil","10":"40.6"},{"1":"25","2":"Astellas","3":"Pharma","4":"TYO","5":"4503","6":"Dec 2015","7":"2015-12-01","8":"40.6","9":"market_cap_in_2014_us_bil","10":"35.8"},{"1":"25","2":"Astellas","3":"Pharma","4":"TYO","5":"4503","6":"Dec 2015","7":"2015-12-01","8":"40.6","9":"market_cap_in_2013_us_bil","10":"27.6"},{"1":"26","2":"Daiichi Sankyo","3":"Pharma","4":"NASDAQ","5":"DSNKY","6":"Dec 2019","7":"2019-12-01","8":"45.3","9":"market_cap_in_2019_us_bil","10":"45.3"},{"1":"26","2":"Daiichi Sankyo","3":"Pharma","4":"NASDAQ","5":"DSNKY","6":"Dec 2019","7":"2019-12-01","8":"45.3","9":"market_cap_in_2018_us_bil","10":"22.7"},{"1":"26","2":"Daiichi Sankyo","3":"Pharma","4":"NASDAQ","5":"DSNKY","6":"Dec 2019","7":"2019-12-01","8":"45.3","9":"market_cap_in_2017_us_bil","10":"27.5"},{"1":"26","2":"Daiichi Sankyo","3":"Pharma","4":"NASDAQ","5":"DSNKY","6":"Dec 2019","7":"2019-12-01","8":"45.3","9":"market_cap_in_2016_us_bil","10":"35.3"},{"1":"26","2":"Daiichi Sankyo","3":"Pharma","4":"NASDAQ","5":"DSNKY","6":"Dec 2019","7":"2019-12-01","8":"45.3","9":"market_cap_in_2015_us_bil","10":"38.8"},{"1":"26","2":"Daiichi Sankyo","3":"Pharma","4":"NASDAQ","5":"DSNKY","6":"Dec 2019","7":"2019-12-01","8":"45.3","9":"market_cap_in_2014_us_bil","10":"33.2"},{"1":"26","2":"Daiichi Sankyo","3":"Pharma","4":"NASDAQ","5":"DSNKY","6":"Dec 2019","7":"2019-12-01","8":"45.3","9":"market_cap_in_2013_us_bil","10":"28.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"ALXN","6":"Jul 2015","7":"2015-07-01","8":"47.0","9":"market_cap_in_2019_us_bil","10":"24.3"},{"1":"27","2":"Alexion Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"ALXN","6":"Jul 2015","7":"2015-07-01","8":"47.0","9":"market_cap_in_2018_us_bil","10":"21.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"ALXN","6":"Jul 2015","7":"2015-07-01","8":"47.0","9":"market_cap_in_2017_us_bil","10":"26.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"ALXN","6":"Jul 2015","7":"2015-07-01","8":"47.0","9":"market_cap_in_2016_us_bil","10":"27.4"},{"1":"27","2":"Alexion Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"ALXN","6":"Jul 2015","7":"2015-07-01","8":"47.0","9":"market_cap_in_2015_us_bil","10":"43.1"},{"1":"27","2":"Alexion Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"ALXN","6":"Jul 2015","7":"2015-07-01","8":"47.0","9":"market_cap_in_2014_us_bil","10":"36.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"Pharma","4":"NASDAQ","5":"ALXN","6":"Jul 2015","7":"2015-07-01","8":"47.0","9":"market_cap_in_2013_us_bil","10":"26.0"},{"1":"28","2":"Eisai Pharmaceutical","3":"Pharma","4":"TYO","5":"4523","6":"Dec 2016","7":"2016-12-01","8":"37.3","9":"market_cap_in_2019_us_bil","10":"21.5"},{"1":"28","2":"Eisai Pharmaceutical","3":"Pharma","4":"TYO","5":"4523","6":"Dec 2016","7":"2016-12-01","8":"37.3","9":"market_cap_in_2018_us_bil","10":"23.0"},{"1":"28","2":"Eisai Pharmaceutical","3":"Pharma","4":"TYO","5":"4523","6":"Dec 2016","7":"2016-12-01","8":"37.3","9":"market_cap_in_2017_us_bil","10":"24.5"},{"1":"28","2":"Eisai Pharmaceutical","3":"Pharma","4":"TYO","5":"4523","6":"Dec 2016","7":"2016-12-01","8":"37.3","9":"market_cap_in_2016_us_bil","10":"37.3"},{"1":"28","2":"Eisai Pharmaceutical","3":"Pharma","4":"TYO","5":"4523","6":"Dec 2016","7":"2016-12-01","8":"37.3","9":"market_cap_in_2015_us_bil","10":"28.8"},{"1":"28","2":"Eisai Pharmaceutical","3":"Pharma","4":"TYO","5":"4523","6":"Dec 2016","7":"2016-12-01","8":"37.3","9":"market_cap_in_2014_us_bil","10":"30.2"},{"1":"28","2":"Eisai Pharmaceutical","3":"Pharma","4":"TYO","5":"4523","6":"Dec 2016","7":"2016-12-01","8":"37.3","9":"market_cap_in_2013_us_bil","10":"28.7"},{"1":"29","2":"Incyte","3":"Pharma","4":"NASDAQ","5":"INCY","6":"Mar 2017","7":"2017-03-01","8":"31.2","9":"market_cap_in_2019_us_bil","10":"18.8"},{"1":"29","2":"Incyte","3":"Pharma","4":"NASDAQ","5":"INCY","6":"Mar 2017","7":"2017-03-01","8":"31.2","9":"market_cap_in_2018_us_bil","10":"13.5"},{"1":"29","2":"Incyte","3":"Pharma","4":"NASDAQ","5":"INCY","6":"Mar 2017","7":"2017-03-01","8":"31.2","9":"market_cap_in_2017_us_bil","10":"18.3"},{"1":"29","2":"Incyte","3":"Pharma","4":"NASDAQ","5":"INCY","6":"Mar 2017","7":"2017-03-01","8":"31.2","9":"market_cap_in_2016_us_bil","10":"15.4"},{"1":"29","2":"Incyte","3":"Pharma","4":"NASDAQ","5":"INCY","6":"Mar 2017","7":"2017-03-01","8":"31.2","9":"market_cap_in_2015_us_bil","10":"10.6"},{"1":"29","2":"Incyte","3":"Pharma","4":"NASDAQ","5":"INCY","6":"Mar 2017","7":"2017-03-01","8":"31.2","9":"market_cap_in_2014_us_bil","10":"7.3"},{"1":"29","2":"Incyte","3":"Pharma","4":"NASDAQ","5":"INCY","6":"Mar 2017","7":"2017-03-01","8":"31.2","9":"market_cap_in_2013_us_bil","10":"4.6"},{"1":"30","2":"BioMarin","3":"Pharma","4":"NASDAQ","5":"BMRN","6":"Jul 2015","7":"2015-07-01","8":"24.0","9":"market_cap_in_2019_us_bil","10":"15.2"},{"1":"30","2":"BioMarin","3":"Pharma","4":"NASDAQ","5":"BMRN","6":"Jul 2015","7":"2015-07-01","8":"24.0","9":"market_cap_in_2018_us_bil","10":"15.1"},{"1":"30","2":"BioMarin","3":"Pharma","4":"NASDAQ","5":"BMRN","6":"Jul 2015","7":"2015-07-01","8":"24.0","9":"market_cap_in_2017_us_bil","10":"18.3"},{"1":"30","2":"BioMarin","3":"Pharma","4":"NASDAQ","5":"BMRN","6":"Jul 2015","7":"2015-07-01","8":"24.0","9":"market_cap_in_2016_us_bil","10":"20.4"},{"1":"30","2":"BioMarin","3":"Pharma","4":"NASDAQ","5":"BMRN","6":"Jul 2015","7":"2015-07-01","8":"24.0","9":"market_cap_in_2015_us_bil","10":"13.8"},{"1":"30","2":"BioMarin","3":"Pharma","4":"NASDAQ","5":"BMRN","6":"Jul 2015","7":"2015-07-01","8":"24.0","9":"market_cap_in_2014_us_bil","10":"12.9"},{"1":"30","2":"BioMarin","3":"Pharma","4":"NASDAQ","5":"BMRN","6":"Jul 2015","7":"2015-07-01","8":"24.0","9":"market_cap_in_2013_us_bil","10":"10.8"},{"1":"31","2":"Genmab","3":"Biotech","4":"NASDAQ","5":"GMAB","6":"Aug 2020","7":"2020-08-01","8":"24.7","9":"market_cap_in_2019_us_bil","10":"14.5"},{"1":"31","2":"Genmab","3":"Biotech","4":"NASDAQ","5":"GMAB","6":"Aug 2020","7":"2020-08-01","8":"24.7","9":"market_cap_in_2018_us_bil","10":"10.6"},{"1":"31","2":"Genmab","3":"Biotech","4":"NASDAQ","5":"GMAB","6":"Aug 2020","7":"2020-08-01","8":"24.7","9":"market_cap_in_2017_us_bil","10":"10.8"},{"1":"31","2":"Genmab","3":"Biotech","4":"NASDAQ","5":"GMAB","6":"Aug 2020","7":"2020-08-01","8":"24.7","9":"market_cap_in_2016_us_bil","10":"10.8"},{"1":"31","2":"Genmab","3":"Biotech","4":"NASDAQ","5":"GMAB","6":"Aug 2020","7":"2020-08-01","8":"24.7","9":"market_cap_in_2015_us_bil","10":"8.8"},{"1":"31","2":"Genmab","3":"Biotech","4":"NASDAQ","5":"GMAB","6":"Aug 2020","7":"2020-08-01","8":"24.7","9":"market_cap_in_2014_us_bil","10":"3.8"},{"1":"31","2":"Genmab","3":"Biotech","4":"NASDAQ","5":"GMAB","6":"Aug 2020","7":"2020-08-01","8":"24.7","9":"market_cap_in_2013_us_bil","10":"2.6"},{"1":"32","2":"Mylan","3":"Pharma","4":"NASDAQ","5":"MYL","6":"Dec 2015","7":"2015-12-01","8":"38.8","9":"market_cap_in_2019_us_bil","10":"10.4"},{"1":"32","2":"Mylan","3":"Pharma","4":"NASDAQ","5":"MYL","6":"Dec 2015","7":"2015-12-01","8":"38.8","9":"market_cap_in_2018_us_bil","10":"14.1"},{"1":"32","2":"Mylan","3":"Pharma","4":"NASDAQ","5":"MYL","6":"Dec 2015","7":"2015-12-01","8":"38.8","9":"market_cap_in_2017_us_bil","10":"27.5"},{"1":"32","2":"Mylan","3":"Pharma","4":"NASDAQ","5":"MYL","6":"Dec 2015","7":"2015-12-01","8":"38.8","9":"market_cap_in_2016_us_bil","10":"30.3"},{"1":"32","2":"Mylan","3":"Pharma","4":"NASDAQ","5":"MYL","6":"Dec 2015","7":"2015-12-01","8":"38.8","9":"market_cap_in_2015_us_bil","10":"38.8"},{"1":"32","2":"Mylan","3":"Pharma","4":"NASDAQ","5":"MYL","6":"Dec 2015","7":"2015-12-01","8":"38.8","9":"market_cap_in_2014_us_bil","10":"33.2"},{"1":"32","2":"Mylan","3":"Pharma","4":"NASDAQ","5":"MYL","6":"Dec 2015","7":"2015-12-01","8":"38.8","9":"market_cap_in_2013_us_bil","10":"35.7"},{"1":"36","2":"Bausch Health","3":"Pharma","4":"TSX","5":"BHC","6":"Aug 2020","7":"2020-08-01","8":"31.2","9":"market_cap_in_2019_us_bil","10":"41.5"},{"1":"36","2":"Bausch Health","3":"Pharma","4":"TSX","5":"BHC","6":"Aug 2020","7":"2020-08-01","8":"31.2","9":"market_cap_in_2018_us_bil","10":"10.0"},{"1":"36","2":"Bausch Health","3":"Pharma","4":"TSX","5":"BHC","6":"Aug 2020","7":"2020-08-01","8":"31.2","9":"market_cap_in_2017_us_bil","10":"21.0"},{"1":"36","2":"Bausch Health","3":"Pharma","4":"TSX","5":"BHC","6":"Aug 2020","7":"2020-08-01","8":"31.2","9":"market_cap_in_2016_us_bil","10":"4.5"},{"1":"36","2":"Bausch Health","3":"Pharma","4":"TSX","5":"BHC","6":"Aug 2020","7":"2020-08-01","8":"31.2","9":"market_cap_in_2015_us_bil","10":"8.1"},{"1":"36","2":"Bausch Health","3":"Pharma","4":"TSX","5":"BHC","6":"Aug 2020","7":"2020-08-01","8":"31.2","9":"market_cap_in_2014_us_bil","10":"9.0"},{"1":"36","2":"Bausch Health","3":"Pharma","4":"TSX","5":"BHC","6":"Aug 2020","7":"2020-08-01","8":"31.2","9":"market_cap_in_2013_us_bil","10":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This looks correct–let’s assign it to <code>TidyTopPharmComp</code> (because it’s a new data structure).</p>
<pre class="r"><code>TidyTopPharmComp &lt;- TopPharmComp %&gt;% 
  tidyr::pivot_longer(cols = starts_with(&quot;market_cap&quot;), 
                      names_to = &quot;market_cap_year&quot;, 
                      values_to = &quot;market_cap_us_bil&quot;)</code></pre>
</div>
<div id="market_cap_year" class="section level3" number="6.1.2">
<h3 number="6.1.2"><span class="header-section-number">6.1.2</span> <code>market_cap_year</code></h3>
<p>We can also wrangle the <code>market_cap_year</code> variable so it only contains the four-number year.</p>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  # remove characters
  dplyr::mutate(market_cap_year = str_remove_all(string = market_cap_year, 
                                                 pattern = &quot;\\D&quot;),
                # make numeric
                market_cap_year = as.integer(market_cap_year)) %&gt;% 
  # check work
  select(ranking, 
         company_name, 
         market_cap_year, 
         market_cap_us_bil)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["ranking"],"name":[1],"type":["ord"],"align":["right"]},{"label":["company_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["market_cap_year"],"name":[3],"type":["int"],"align":["right"]},{"label":["market_cap_us_bil"],"name":[4],"type":["dbl"],"align":["right"]}],"data":[{"1":"1","2":"Johnson & Johnson","3":"2019","4":"385.0"},{"1":"1","2":"Johnson & Johnson","3":"2018","4":"346.1"},{"1":"1","2":"Johnson & Johnson","3":"2017","4":"375.4"},{"1":"1","2":"Johnson & Johnson","3":"2016","4":"314.1"},{"1":"1","2":"Johnson & Johnson","3":"2015","4":"284.2"},{"1":"1","2":"Johnson & Johnson","3":"2014","4":"277.8"},{"1":"1","2":"Johnson & Johnson","3":"2013","4":"258.3"},{"1":"2","2":"Roche","3":"2019","4":"281.1"},{"1":"2","2":"Roche","3":"2018","4":"209.3"},{"1":"2","2":"Roche","3":"2017","4":"216.7"},{"1":"2","2":"Roche","3":"2016","4":"192.1"},{"1":"2","2":"Roche","3":"2015","4":"234.7"},{"1":"2","2":"Roche","3":"2014","4":"258.5"},{"1":"2","2":"Roche","3":"2013","4":"240.3"},{"1":"3","2":"Novartis","3":"2019","4":"240.0"},{"1":"3","2":"Novartis","3":"2018","4":"200.0"},{"1":"3","2":"Novartis","3":"2017","4":"196.7"},{"1":"3","2":"Novartis","3":"2016","4":"170.5"},{"1":"3","2":"Novartis","3":"2015","4":"206.1"},{"1":"3","2":"Novartis","3":"2014","4":"229.8"},{"1":"3","2":"Novartis","3":"2013","4":"195.0"},{"1":"4","2":"Merck & Co.","3":"2019","4":"232.9"},{"1":"4","2":"Merck & Co.","3":"2018","4":"205.8"},{"1":"4","2":"Merck & Co.","3":"2017","4":"153.3"},{"1":"4","2":"Merck & Co.","3":"2016","4":"164.3"},{"1":"4","2":"Merck & Co.","3":"2015","4":"147.6"},{"1":"4","2":"Merck & Co.","3":"2014","4":"166.9"},{"1":"4","2":"Merck & Co.","3":"2013","4":"146.5"},{"1":"5","2":"Pfizer","3":"2019","4":"216.7"},{"1":"5","2":"Pfizer","3":"2018","4":"259.7"},{"1":"5","2":"Pfizer","3":"2017","4":"215.9"},{"1":"5","2":"Pfizer","3":"2016","4":"196.3"},{"1":"5","2":"Pfizer","3":"2015","4":"199.3"},{"1":"5","2":"Pfizer","3":"2014","4":"205.4"},{"1":"5","2":"Pfizer","3":"2013","4":"196.0"},{"1":"6","2":"Abbott Laboratories","3":"2019","4":"153.5"},{"1":"6","2":"Abbott Laboratories","3":"2018","4":"126.8"},{"1":"6","2":"Abbott Laboratories","3":"2017","4":"99.3"},{"1":"6","2":"Abbott Laboratories","3":"2016","4":"56.4"},{"1":"6","2":"Abbott Laboratories","3":"2015","4":"67.0"},{"1":"6","2":"Abbott Laboratories","3":"2014","4":"67.9"},{"1":"6","2":"Abbott Laboratories","3":"2013","4":"59.3"},{"1":"7","2":"Amgen","3":"2019","4":"144.6"},{"1":"7","2":"Amgen","3":"2018","4":"128.8"},{"1":"7","2":"Amgen","3":"2017","4":"126.2"},{"1":"7","2":"Amgen","3":"2016","4":"108.9"},{"1":"7","2":"Amgen","3":"2015","4":"122.5"},{"1":"7","2":"Amgen","3":"2014","4":"93.1"},{"1":"7","2":"Amgen","3":"2013","4":"78.7"},{"1":"8","2":"Novo Nordisk","3":"2019","4":"137.1"},{"1":"8","2":"Novo Nordisk","3":"2018","4":"111.9"},{"1":"8","2":"Novo Nordisk","3":"2017","4":"131.2"},{"1":"8","2":"Novo Nordisk","3":"2016","4":"92.6"},{"1":"8","2":"Novo Nordisk","3":"2015","4":"153.9"},{"1":"8","2":"Novo Nordisk","3":"2014","4":"125.4"},{"1":"8","2":"Novo Nordisk","3":"2013","4":"NA"},{"1":"9","2":"AbbVie","3":"2019","4":"130.9"},{"1":"9","2":"AbbVie","3":"2018","4":"146.3"},{"1":"9","2":"AbbVie","3":"2017","4":"154.4"},{"1":"9","2":"AbbVie","3":"2016","4":"100.2"},{"1":"9","2":"AbbVie","3":"2015","4":"96.8"},{"1":"9","2":"AbbVie","3":"2014","4":"104.1"},{"1":"9","2":"AbbVie","3":"2013","4":"83.8"},{"1":"10","2":"AstraZeneca","3":"2019","4":"130.8"},{"1":"10","2":"AstraZeneca","3":"2018","4":"96.2"},{"1":"10","2":"AstraZeneca","3":"2017","4":"87.9"},{"1":"10","2":"AstraZeneca","3":"2016","4":"68.8"},{"1":"10","2":"AstraZeneca","3":"2015","4":"85.8"},{"1":"10","2":"AstraZeneca","3":"2014","4":"88.9"},{"1":"10","2":"AstraZeneca","3":"2013","4":"74.6"},{"1":"11","2":"Eli Lilly & Co","3":"2019","4":"126.9"},{"1":"11","2":"Eli Lilly & Co","3":"2018","4":"125.6"},{"1":"11","2":"Eli Lilly & Co","3":"2017","4":"93.0"},{"1":"11","2":"Eli Lilly & Co","3":"2016","4":"80.9"},{"1":"11","2":"Eli Lilly & Co","3":"2015","4":"93.4"},{"1":"11","2":"Eli Lilly & Co","3":"2014","4":"76.6"},{"1":"11","2":"Eli Lilly & Co","3":"2013","4":"57.0"},{"1":"12","2":"GlaxoSmithKline","3":"2019","4":"117.2"},{"1":"12","2":"GlaxoSmithKline","3":"2018","4":"94.8"},{"1":"12","2":"GlaxoSmithKline","3":"2017","4":"87.9"},{"1":"12","2":"GlaxoSmithKline","3":"2016","4":"93.3"},{"1":"12","2":"GlaxoSmithKline","3":"2015","4":"97.6"},{"1":"12","2":"GlaxoSmithKline","3":"2014","4":"128.9"},{"1":"12","2":"GlaxoSmithKline","3":"2013","4":"129.6"},{"1":"13","2":"Bristol-Myers Squibb","3":"2019","4":"105.0"},{"1":"13","2":"Bristol-Myers Squibb","3":"2018","4":"85.0"},{"1":"13","2":"Bristol-Myers Squibb","3":"2017","4":"100.3"},{"1":"13","2":"Bristol-Myers Squibb","3":"2016","4":"98.2"},{"1":"13","2":"Bristol-Myers Squibb","3":"2015","4":"114.8"},{"1":"13","2":"Bristol-Myers Squibb","3":"2014","4":"97.6"},{"1":"13","2":"Bristol-Myers Squibb","3":"2013","4":"87.2"},{"1":"14","2":"Gilead Sciences","3":"2019","4":"82.3"},{"1":"14","2":"Gilead Sciences","3":"2018","4":"81.6"},{"1":"14","2":"Gilead Sciences","3":"2017","4":"93.6"},{"1":"14","2":"Gilead Sciences","3":"2016","4":"96.6"},{"1":"14","2":"Gilead Sciences","3":"2015","4":"145.8"},{"1":"14","2":"Gilead Sciences","3":"2014","4":"109.0"},{"1":"14","2":"Gilead Sciences","3":"2013","4":"78.4"},{"1":"15","2":"Bayer","3":"2019","4":"80.1"},{"1":"15","2":"Bayer","3":"2018","4":"63.1"},{"1":"15","2":"Bayer","3":"2017","4":"101.9"},{"1":"15","2":"Bayer","3":"2016","4":"85.3"},{"1":"15","2":"Bayer","3":"2015","4":"103.2"},{"1":"15","2":"Bayer","3":"2014","4":"113.2"},{"1":"15","2":"Bayer","3":"2013","4":"117.4"},{"1":"16","2":"Stryker Corporation","3":"2019","4":"78.5"},{"1":"16","2":"Stryker Corporation","3":"2018","4":"58.6"},{"1":"16","2":"Stryker Corporation","3":"2017","4":"58.0"},{"1":"16","2":"Stryker Corporation","3":"2016","4":"45.1"},{"1":"16","2":"Stryker Corporation","3":"2015","4":"34.7"},{"1":"16","2":"Stryker Corporation","3":"2014","4":"35.7"},{"1":"16","2":"Stryker Corporation","3":"2013","4":"28.4"},{"1":"17","2":"Sanofi","3":"2019","4":"63.5"},{"1":"17","2":"Sanofi","3":"2018","4":"108.4"},{"1":"17","2":"Sanofi","3":"2017","4":"108.2"},{"1":"17","2":"Sanofi","3":"2016","4":"101.8"},{"1":"17","2":"Sanofi","3":"2015","4":"111.8"},{"1":"17","2":"Sanofi","3":"2014","4":"138.1"},{"1":"17","2":"Sanofi","3":"2013","4":"142.0"},{"1":"18","2":"Zoetis","3":"2019","4":"63.2"},{"1":"18","2":"Zoetis","3":"2018","4":"41.4"},{"1":"18","2":"Zoetis","3":"2017","4":"35.1"},{"1":"18","2":"Zoetis","3":"2016","4":"26.4"},{"1":"18","2":"Zoetis","3":"2015","4":"23.8"},{"1":"18","2":"Zoetis","3":"2014","4":"21.6"},{"1":"18","2":"Zoetis","3":"2013","4":"16.3"},{"1":"19","2":"Teva Pharmaceuticals","3":"2019","4":"48.3"},{"1":"19","2":"Teva Pharmaceuticals","3":"2018","4":"16.2"},{"1":"19","2":"Teva Pharmaceuticals","3":"2017","4":"24.4"},{"1":"19","2":"Teva Pharmaceuticals","3":"2016","4":"32.7"},{"1":"19","2":"Teva Pharmaceuticals","3":"2015","4":"13.2"},{"1":"19","2":"Teva Pharmaceuticals","3":"2014","4":"70.5"},{"1":"19","2":"Teva Pharmaceuticals","3":"2013","4":"29.3"},{"1":"20","2":"Takeda Pharmaceutical","3":"2019","4":"61.5"},{"1":"20","2":"Takeda Pharmaceutical","3":"2018","4":"52.9"},{"1":"20","2":"Takeda Pharmaceutical","3":"2017","4":"40.2"},{"1":"20","2":"Takeda Pharmaceutical","3":"2016","4":"45.6"},{"1":"20","2":"Takeda Pharmaceutical","3":"2015","4":"47.8"},{"1":"20","2":"Takeda Pharmaceutical","3":"2014","4":"37.5"},{"1":"20","2":"Takeda Pharmaceutical","3":"2013","4":"34.3"},{"1":"21","2":"Vertex Pharmaceuticals","3":"2019","4":"56.3"},{"1":"21","2":"Vertex Pharmaceuticals","3":"2018","4":"42.2"},{"1":"21","2":"Vertex Pharmaceuticals","3":"2017","4":"37.9"},{"1":"21","2":"Vertex Pharmaceuticals","3":"2016","4":"18.3"},{"1":"21","2":"Vertex Pharmaceuticals","3":"2015","4":"31.0"},{"1":"21","2":"Vertex Pharmaceuticals","3":"2014","4":"28.7"},{"1":"21","2":"Vertex Pharmaceuticals","3":"2013","4":"17.4"},{"1":"22","2":"Biogen","3":"2019","4":"54.7"},{"1":"22","2":"Biogen","3":"2018","4":"63.5"},{"1":"22","2":"Biogen","3":"2017","4":"67.4"},{"1":"22","2":"Biogen","3":"2016","4":"61.6"},{"1":"22","2":"Biogen","3":"2015","4":"68.3"},{"1":"22","2":"Biogen","3":"2014","4":"79.7"},{"1":"22","2":"Biogen","3":"2013","4":"66.1"},{"1":"23","2":"Illumina","3":"2019","4":"48.2"},{"1":"23","2":"Illumina","3":"2018","4":"44.1"},{"1":"23","2":"Illumina","3":"2017","4":"40.2"},{"1":"23","2":"Illumina","3":"2016","4":"39.4"},{"1":"23","2":"Illumina","3":"2015","4":"35.4"},{"1":"23","2":"Illumina","3":"2014","4":"28.6"},{"1":"23","2":"Illumina","3":"2013","4":"25.7"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"2019","4":"41.2"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"2018","4":"40.3"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"2017","4":"40.4"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"2016","4":"39.3"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"2015","4":"56.5"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"2014","4":"42.0"},{"1":"24","2":"Regeneron Pharmaceuticals","3":"2013","4":"27.4"},{"1":"25","2":"Astellas","3":"2019","4":"32.7"},{"1":"25","2":"Astellas","3":"2018","4":"23.8"},{"1":"25","2":"Astellas","3":"2017","4":"29.3"},{"1":"25","2":"Astellas","3":"2016","4":"25.7"},{"1":"25","2":"Astellas","3":"2015","4":"40.6"},{"1":"25","2":"Astellas","3":"2014","4":"35.8"},{"1":"25","2":"Astellas","3":"2013","4":"27.6"},{"1":"26","2":"Daiichi Sankyo","3":"2019","4":"45.3"},{"1":"26","2":"Daiichi Sankyo","3":"2018","4":"22.7"},{"1":"26","2":"Daiichi Sankyo","3":"2017","4":"27.5"},{"1":"26","2":"Daiichi Sankyo","3":"2016","4":"35.3"},{"1":"26","2":"Daiichi Sankyo","3":"2015","4":"38.8"},{"1":"26","2":"Daiichi Sankyo","3":"2014","4":"33.2"},{"1":"26","2":"Daiichi Sankyo","3":"2013","4":"28.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"2019","4":"24.3"},{"1":"27","2":"Alexion Pharmaceuticals","3":"2018","4":"21.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"2017","4":"26.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"2016","4":"27.4"},{"1":"27","2":"Alexion Pharmaceuticals","3":"2015","4":"43.1"},{"1":"27","2":"Alexion Pharmaceuticals","3":"2014","4":"36.7"},{"1":"27","2":"Alexion Pharmaceuticals","3":"2013","4":"26.0"},{"1":"28","2":"Eisai Pharmaceutical","3":"2019","4":"21.5"},{"1":"28","2":"Eisai Pharmaceutical","3":"2018","4":"23.0"},{"1":"28","2":"Eisai Pharmaceutical","3":"2017","4":"24.5"},{"1":"28","2":"Eisai Pharmaceutical","3":"2016","4":"37.3"},{"1":"28","2":"Eisai Pharmaceutical","3":"2015","4":"28.8"},{"1":"28","2":"Eisai Pharmaceutical","3":"2014","4":"30.2"},{"1":"28","2":"Eisai Pharmaceutical","3":"2013","4":"28.7"},{"1":"29","2":"Incyte","3":"2019","4":"18.8"},{"1":"29","2":"Incyte","3":"2018","4":"13.5"},{"1":"29","2":"Incyte","3":"2017","4":"18.3"},{"1":"29","2":"Incyte","3":"2016","4":"15.4"},{"1":"29","2":"Incyte","3":"2015","4":"10.6"},{"1":"29","2":"Incyte","3":"2014","4":"7.3"},{"1":"29","2":"Incyte","3":"2013","4":"4.6"},{"1":"30","2":"BioMarin","3":"2019","4":"15.2"},{"1":"30","2":"BioMarin","3":"2018","4":"15.1"},{"1":"30","2":"BioMarin","3":"2017","4":"18.3"},{"1":"30","2":"BioMarin","3":"2016","4":"20.4"},{"1":"30","2":"BioMarin","3":"2015","4":"13.8"},{"1":"30","2":"BioMarin","3":"2014","4":"12.9"},{"1":"30","2":"BioMarin","3":"2013","4":"10.8"},{"1":"31","2":"Genmab","3":"2019","4":"14.5"},{"1":"31","2":"Genmab","3":"2018","4":"10.6"},{"1":"31","2":"Genmab","3":"2017","4":"10.8"},{"1":"31","2":"Genmab","3":"2016","4":"10.8"},{"1":"31","2":"Genmab","3":"2015","4":"8.8"},{"1":"31","2":"Genmab","3":"2014","4":"3.8"},{"1":"31","2":"Genmab","3":"2013","4":"2.6"},{"1":"32","2":"Mylan","3":"2019","4":"10.4"},{"1":"32","2":"Mylan","3":"2018","4":"14.1"},{"1":"32","2":"Mylan","3":"2017","4":"27.5"},{"1":"32","2":"Mylan","3":"2016","4":"30.3"},{"1":"32","2":"Mylan","3":"2015","4":"38.8"},{"1":"32","2":"Mylan","3":"2014","4":"33.2"},{"1":"32","2":"Mylan","3":"2013","4":"35.7"},{"1":"36","2":"Bausch Health","3":"2019","4":"41.5"},{"1":"36","2":"Bausch Health","3":"2018","4":"10.0"},{"1":"36","2":"Bausch Health","3":"2017","4":"21.0"},{"1":"36","2":"Bausch Health","3":"2016","4":"4.5"},{"1":"36","2":"Bausch Health","3":"2015","4":"8.1"},{"1":"36","2":"Bausch Health","3":"2014","4":"9.0"},{"1":"36","2":"Bausch Health","3":"2013","4":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Let’s assign <code>market_cap_year</code> to <code>TidyTopPharmComp</code> and start visualizing!</p>
<pre class="r"><code>TidyTopPharmComp &lt;- TidyTopPharmComp %&gt;% 
  # remove characters
  dplyr::mutate(market_cap_year = str_remove_all(string = market_cap_year, 
                                                 pattern = &quot;\\D&quot;),
                # make numeric
                market_cap_year = as.integer(market_cap_year))</code></pre>
</div>
</div>
</div>
<div id="visualize" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Visualize</h1>
<p>We will start by looking at the trends of <code>market_cap_us_bil</code> over time (using <code>market_cap_year</code>).</p>
<div id="labels" class="section level2" number="7.1">
<h2 number="7.1"><span class="header-section-number">7.1</span> Labels</h2>
<p>I suggest building labels <strong>first</strong> when making a figure or graph, because it forces us to think about what we should expect to see. For example, if we want to see <code>market_cap_us_bil</code> on the <code>y</code> and <code>market_cap_year</code> on the <code>x</code>, we can create these with a title using the <code>ggplot2::labs()</code> function below.</p>
<pre class="r"><code>lbl_graph_01 &lt;- ggplot2::labs(title = &quot;Market Cap Trends Over Time&quot;, 
                              subtitle = &quot;Largest Pharmaceutical Companies&quot;,
                              x = &quot;Year&quot;, y = &quot;Market cap (USD in billions)&quot;)</code></pre>
</div>
<div id="map-variables-to-positions" class="section level2 tabset" number="7.2">
<h2 class="tabset" number="7.2"><span class="header-section-number">7.2</span> Map Variables to Positions</h2>
<p>The exercises below are a refresher on mapping variables to aesthetics and picking geoms.</p>
<div id="exercise" class="section level3" number="7.2.1">
<h3 number="7.2.1"><span class="header-section-number">7.2.1</span> exercise</h3>
<p>Map the <code>market_cap_year</code> to the <code>x</code> and <code>market_cap_us_bil</code> to the <code>y</code> and add a <code>geom_point()</code></p>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  ggplot(aes(x = __________, y = __________)) + 
  geom______() + 
  lbl_graph_01</code></pre>
</div>
<div id="solution" class="section level3" number="7.2.2">
<h3 number="7.2.2"><span class="header-section-number">7.2.2</span> solution</h3>
<p>Check the solution below–what is wrong with this plot?</p>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  ggplot(aes(x = market_cap_year, y = market_cap_us_bil)) + 
  geom_point() + 
  lbl_graph_01</code></pre>
<p><img src="img/aes-sol-01-1.png" width="672" /></p>
</div>
<div id="exercise-1" class="section level3" number="7.2.3">
<h3 number="7.2.3"><span class="header-section-number">7.2.3</span> exercise</h3>
<p>Change the geom to a <code>geom_line()</code>. Does it help?</p>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  ggplot(aes(x = __________, y = __________)) + 
  geom_____() + 
  lbl_graph_01</code></pre>
</div>
<div id="solution-1" class="section level3" number="7.2.4">
<h3 number="7.2.4"><span class="header-section-number">7.2.4</span> solution</h3>
<p>Check the updated graph below. It’s closer to what we want, but not quite. What do you think the issue is?</p>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  ggplot(aes(x = market_cap_year, y = market_cap_us_bil)) + 
  geom_line() + 
  lbl_graph_01</code></pre>
<p><img src="img/aes-sol-02-1.png" width="672" /></p>
</div>
<div id="exercise-2" class="section level3" number="7.2.5">
<h3 number="7.2.5"><span class="header-section-number">7.2.5</span> exercise</h3>
<p>This time add another <code>aes()</code> <em>inside</em> the <code>geom_line()</code> function, and apply <code>group</code> to <code>company_name</code>.</p>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  ggplot(aes(x = market_cap_year, y = market_cap_us_bil)) + 
  geom_line(aes(_____ = __________)) + 
  lbl_graph_01</code></pre>
</div>
<div id="solution-2" class="section level3" number="7.2.6">
<h3 number="7.2.6"><span class="header-section-number">7.2.6</span> solution</h3>
<p>Now the graph is looking how we want! We can see the trend lines are separated according to each company name, but we can’t tell which line is which.</p>
<p>Let’s add some color to see more.</p>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  ggplot(aes(x = market_cap_year, y = market_cap_us_bil)) + 
  geom_line(aes(group = company_name)) + 
  lbl_graph_01</code></pre>
<p><img src="img/aes-sol-03-1.png" width="672" /></p>
</div>
</div>
<div id="map-variables-to-aesthetics" class="section level2 tabset" number="7.3">
<h2 class="tabset" number="7.3"><span class="header-section-number">7.3</span> Map Variables to Aesthetics</h2>
<p>In the previous graph, we were able to get a different line per company. However, we want to identify more about these companies with color.</p>
<p>We know there are 33 different <code>company_names</code>, and this is too many to map with color (check this with <code>distinct()</code>)</p>
<pre class="r"><code>TidyTopPharmComp %&gt;% distinct(company_name)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["company_name"],"name":[1],"type":["chr"],"align":["left"]}],"data":[{"1":"Johnson & Johnson"},{"1":"Roche"},{"1":"Novartis"},{"1":"Merck & Co."},{"1":"Pfizer"},{"1":"Abbott Laboratories"},{"1":"Amgen"},{"1":"Novo Nordisk"},{"1":"AbbVie"},{"1":"AstraZeneca"},{"1":"Eli Lilly & Co"},{"1":"GlaxoSmithKline"},{"1":"Bristol-Myers Squibb"},{"1":"Gilead Sciences"},{"1":"Bayer"},{"1":"Stryker Corporation"},{"1":"Sanofi"},{"1":"Zoetis"},{"1":"Teva Pharmaceuticals"},{"1":"Takeda Pharmaceutical"},{"1":"Vertex Pharmaceuticals"},{"1":"Biogen"},{"1":"Illumina"},{"1":"Regeneron Pharmaceuticals"},{"1":"Astellas"},{"1":"Daiichi Sankyo"},{"1":"Alexion Pharmaceuticals"},{"1":"Eisai Pharmaceutical"},{"1":"Incyte"},{"1":"BioMarin"},{"1":"Genmab"},{"1":"Mylan"},{"1":"Bausch Health"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="exercise-3" class="section level3" number="7.3.1">
<h3 number="7.3.1"><span class="header-section-number">7.3.1</span> exercise</h3>
<p>Use the <code>stock_exch</code> to color the lines, assign this graph to <code>gg_trend_line</code></p>
<pre class="r"><code>gg_trend_line &lt;- TidyTopPharmComp %&gt;% 
  ggplot(aes(x = market_cap_year, y = market_cap_us_bil)) + 
  geom_line(aes(group = company_name, color = __________)) + 
  lbl_graph_01
gg_trend_line</code></pre>
</div>
<div id="solution-3" class="section level3" number="7.3.2">
<h3 number="7.3.2"><span class="header-section-number">7.3.2</span> solution</h3>
<p>This graph is showing us more information that the previous plot. For example, we can see the companies with the best performance are on the <code>NYSE</code>, and those with relatively low performance are on the <code>TSX</code>.</p>
<pre class="r"><code>gg_trend_line &lt;- TidyTopPharmComp %&gt;% 
  ggplot(aes(x = market_cap_year, y = market_cap_us_bil)) + 
  geom_line(aes(group = company_name, color = stock_exch)) + 
  lbl_graph_01
gg_trend_line</code></pre>
<p><img src="img/aes-sol-04-gg_trend_line-1.png" width="672" /></p>
<p>This graph is better then the previous versions, but it still has too much information to be very helpful. In the next section, we’ll summarize the data a bit more to create different visualizations.</p>
</div>
</div>
<div id="graphing-data-summaries" class="section level2 tabset" number="7.4">
<h2 class="tabset" number="7.4"><span class="header-section-number">7.4</span> Graphing Data Summaries</h2>
<p>We’re going to summarize the data in <code>TidyTopPharmComp</code>. Summarizations are helpful when we’re interested in comparing variables across groups.</p>
<div id="average-market-cap" class="section level3" number="7.4.1">
<h3 number="7.4.1"><span class="header-section-number">7.4.1</span> Average Market Cap</h3>
<p>We want the <code>TidyTopPharmComp</code> dataset to have one variable per <code>company_name</code> name and <code>stock_exch</code>. A good measure of central tendency for this is the <code>mean()</code> (or average). First we define the new labels.</p>
<pre class="r"><code>lbl_graph_02 &lt;- ggplot2::labs(title = &quot;Average Market Cap (2013-2019)&quot;, 
                              subtitle = &quot;Largest Pharmaceutical Companies&quot;,
                              x = &quot;Average Market cap (USD in billions)&quot;,
                              y = &quot;Company&quot;)</code></pre>
<p>The code below groups the <code>TidyTopPharmComp</code> data by <code>company_name</code> and <code>stock_exch</code> and summarizes the mean <code>market_cap_us_bil</code>.</p>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  group_by(company_name, stock_exch) %&gt;% 
  summarize(
    avg_market_cap = mean(market_cap_us_bil, na.rm = TRUE)) %&gt;% 
  ungroup()</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["company_name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["stock_exch"],"name":[2],"type":["chr"],"align":["left"]},{"label":["avg_market_cap"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"GlaxoSmithKline","2":"NYSE","3":"107.042857"},{"1":"Teva Pharmaceuticals","2":"NYSE","3":"33.514286"},{"1":"Abbott Laboratories","2":"NYSE","3":"90.028571"},{"1":"AbbVie","2":"NYSE","3":"116.642857"},{"1":"Alexion Pharmaceuticals","2":"NASDAQ","3":"29.414286"},{"1":"Amgen","2":"NASDAQ","3":"114.685714"},{"1":"Astellas","2":"TYO","3":"30.785714"},{"1":"AstraZeneca","2":"NYSE","3":"90.428571"},{"1":"Bausch Health","2":"TSX","3":"15.683333"},{"1":"Bayer","2":"FWB","3":"94.885714"},{"1":"Biogen","2":"NASDAQ","3":"65.900000"},{"1":"BioMarin","2":"NASDAQ","3":"15.214286"},{"1":"Bristol-Myers Squibb","2":"NASDAQ","3":"98.300000"},{"1":"Daiichi Sankyo","2":"NASDAQ","3":"33.071429"},{"1":"Eisai Pharmaceutical","2":"TYO","3":"27.714286"},{"1":"Eli Lilly & Co","2":"NYSE","3":"93.342857"},{"1":"Genmab","2":"NASDAQ","3":"8.842857"},{"1":"Gilead Sciences","2":"NASDAQ","3":"98.185714"},{"1":"Illumina","2":"NASDAQ","3":"37.371429"},{"1":"Incyte","2":"NASDAQ","3":"12.642857"},{"1":"Johnson & Johnson","2":"NYSE","3":"320.128571"},{"1":"Merck & Co.","2":"NYSE","3":"173.900000"},{"1":"Mylan","2":"NASDAQ","3":"27.142857"},{"1":"Novartis","2":"NYSE","3":"205.442857"},{"1":"Novo Nordisk","2":"NYSE","3":"125.350000"},{"1":"Pfizer","2":"NYSE","3":"212.757143"},{"1":"Regeneron Pharmaceuticals","2":"NASDAQ","3":"41.014286"},{"1":"Roche","2":"SIX","3":"233.242857"},{"1":"Sanofi","2":"NYSE","3":"110.542857"},{"1":"Stryker Corporation","2":"NYSE","3":"48.428571"},{"1":"Takeda Pharmaceutical","2":"NASDAQ","3":"45.685714"},{"1":"Vertex Pharmaceuticals","2":"NASDAQ","3":"33.114286"},{"1":"Zoetis","2":"NASDAQ","3":"32.542857"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>This dataset will allow us to show more information per company.</p>
</div>
<div id="exercise-4" class="section level3" number="7.4.2">
<h3 number="7.4.2"><span class="header-section-number">7.4.2</span> exercise</h3>
<p>Complete the code below with the following:</p>
<ol style="list-style-type: decimal">
<li>map <code>avg_market_cap</code> to the <code>x</code> axis<br />
</li>
<li>map <code>company_name</code> to the <code>y</code> axis</li>
<li>map <code>stock_exch</code> to <code>fill</code></li>
</ol>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  group_by(company_name, stock_exch) %&gt;% 
  summarize(
    avg_market_cap = mean(market_cap_us_bil, na.rm = TRUE)) %&gt;% 
  ungroup() %&gt;% 
  ggplot() + 
  geom_col(aes(x = _________, 
             
             y = __________,
             
             fill = _________)) + 
  lbl_graph_02</code></pre>
</div>
<div id="solution-4" class="section level3" number="7.4.3">
<h3 number="7.4.3"><span class="header-section-number">7.4.3</span> solution</h3>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  group_by(company_name, stock_exch) %&gt;% 
  summarize(
    avg_market_cap = mean(market_cap_us_bil, na.rm = TRUE)) %&gt;% 
  ungroup() %&gt;% 
  ggplot() + 
  geom_col(aes(x = avg_market_cap, 
               
               y = company_name,
             
               fill = stock_exch)) + 
  lbl_graph_02</code></pre>
<p><img src="img/aes-sol-05-gg_col_graph-1.png" width="672" /></p>
<p>This graph is better because we can see the average performance of the market cap per company. The lines are very unorganized, though. We can use a combination of <code>factor()</code> and <code>forcats::fct_reorder()</code> to fix this.</p>
</div>
<div id="exercise-5" class="section level3" number="7.4.4">
<h3 number="7.4.4"><span class="header-section-number">7.4.4</span> exercise</h3>
<p>Use <code>fct_reorder</code> and <code>factor</code> to reorder <code>avg_market_cap</code> according to <code>company_name</code></p>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  group_by(company_name, stock_exch) %&gt;% 
  summarize(
    avg_market_cap = mean(market_cap_us_bil, na.rm = TRUE)) %&gt;% 
  ungroup() %&gt;% 
  ggplot() + 
  geom_col(aes(x = avg_market_cap, 
             y = fct_reorder(factor(_________), __________),
             fill = stock_exch)) + 
  lbl_graph_02</code></pre>
</div>
<div id="solution-5" class="section level3" number="7.4.5">
<h3 number="7.4.5"><span class="header-section-number">7.4.5</span> solution</h3>
<pre class="r"><code>TidyTopPharmComp %&gt;% 
  group_by(company_name, stock_exch) %&gt;% 
  summarize(
    avg_market_cap = mean(market_cap_us_bil, na.rm = TRUE)) %&gt;% 
  ungroup() %&gt;% 
  ggplot() + 
  geom_col(aes(x = avg_market_cap, 
             y = fct_reorder(factor(company_name), avg_market_cap),
             fill = stock_exch)) + 
  lbl_graph_02</code></pre>
<p><img src="img/aes-sol-6-1.png" width="672" /></p>
</div>
<div id="exercise-6" class="section level3" number="7.4.6">
<h3 number="7.4.6"><span class="header-section-number">7.4.6</span> exercise</h3>
<p>Change the labels below so that the legend is named, <code>"Stock Exchange"</code>. Re-build the plot with the new labels and assign this to <code>gg_col_graph</code>.</p>
<pre class="r"><code>lbl_graph_02 &lt;- ggplot2::labs(x = &quot;Company&quot;, 
                              y = &quot;Average Market cap (USD in billions)&quot;, 
                              title = &quot;Average Market Cap (2013-2019)&quot;, 
                              subtitle = &quot;Largest Pharmaceutical Companies&quot;, 
                              fill = ___________)

gg_col_graph &lt;- TidyTopPharmComp %&gt;% 
  group_by(company_name, stock_exch) %&gt;% 
  summarize(
    avg_market_cap = mean(market_cap_us_bil, na.rm = TRUE)) %&gt;% 
  ungroup() %&gt;% 
  ggplot() + 
  geom_col(aes(x = avg_market_cap, 
             y = fct_reorder(factor(company_name), avg_market_cap),
             fill = stock_exch)) + 
  lbl_graph_02

gg_col_graph</code></pre>
</div>
<div id="solution-6" class="section level3" number="7.4.7">
<h3 number="7.4.7"><span class="header-section-number">7.4.7</span> solution</h3>
<pre class="r"><code>lbl_graph_02 &lt;- ggplot2::labs(x = &quot;Company&quot;, 
                              y = &quot;Average Market cap (USD in billions)&quot;, 
                              title = &quot;Average Market Cap (2013-2019)&quot;, 
                              subtitle = &quot;Largest Pharmaceutical Companies&quot;, 
                              fill = &quot;Stock Exchange&quot;)
gg_col_graph &lt;- TidyTopPharmComp %&gt;% 
  group_by(company_name, stock_exch) %&gt;% 
  summarize(
    avg_market_cap = mean(market_cap_us_bil, na.rm = TRUE)) %&gt;% 
  ungroup() %&gt;% 
  ggplot() + 
  geom_col(aes(x = avg_market_cap, 
             y = fct_reorder(factor(company_name), avg_market_cap),
             fill = stock_exch)) + 
  lbl_graph_02

gg_col_graph</code></pre>
<p><img src="img/label-sol-07-1.png" width="672" /></p>
</div>
</div>
<div id="labelling-values" class="section level2 tabset" number="7.5">
<h2 class="tabset" number="7.5"><span class="header-section-number">7.5</span> Labelling Values</h2>
<p>We’re going to focus on the Largest Market Cap (<code>largest_market_cap_us_bil</code>) and Largest Market Cap Date (<code>largest_market_cap_date</code>) variables. We will define a new set of labels below.</p>
<pre class="r"><code>lbl_graph_03 &lt;- ggplot2::labs(title = &quot;Largest Market Cap (USD in billions)&quot;, 
                              subtitle = &quot;Largest Pharmaceutical Companies&quot;,
                              x = &quot;Largest Market Cap Date&quot;, 
                              y = &quot;Largest Market Cap (USD in billions)&quot;, 
                              color = &quot;Company Type&quot;)</code></pre>
<div id="exercise-7" class="section level3" number="7.5.1">
<h3 number="7.5.1"><span class="header-section-number">7.5.1</span> exercise</h3>
<p><code>select()</code> the <code>stock_exch</code>, <code>stock_id</code>, <code>company_type</code>, <code>largest_market_cap_date</code>, and <code>largest_market_cap_us_bil</code> variables and get the <code>distinct()</code> values. Assign this to <code>TidyTopPharmComCaps</code>.</p>
<pre class="r"><code>TidyTopPharmComCaps &lt;- TidyTopPharmComp %&gt;% 
  select(_________, _________, _________,
         _________, _________) %&gt;% 
  dplyr::distinct()</code></pre>
</div>
<div id="solution-7" class="section level3" number="7.5.2">
<h3 number="7.5.2"><span class="header-section-number">7.5.2</span> solution</h3>
<pre class="r"><code>TidyTopPharmComCaps &lt;- TidyTopPharmComp %&gt;% 
  select(stock_exch, stock_id, company_type,
         largest_market_cap_date, largest_market_cap_us_bil) %&gt;%  
  dplyr::distinct()
TidyTopPharmComCaps</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["stock_exch"],"name":[1],"type":["chr"],"align":["left"]},{"label":["stock_id"],"name":[2],"type":["chr"],"align":["left"]},{"label":["company_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["largest_market_cap_date"],"name":[4],"type":["date"],"align":["right"]},{"label":["largest_market_cap_us_bil"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"NYSE","2":"JNJ","3":"Pharma","4":"2018-01-01","5":"397.4"},{"1":"SIX","2":"ROG","3":"Pharma","4":"2019-12-01","5":"281.1"},{"1":"NYSE","2":"NVS","3":"Pharma","4":"2015-07-01","5":"275.2"},{"1":"NYSE","2":"MRK","3":"Pharma","4":"2019-12-01","5":"232.9"},{"1":"NYSE","2":"PFE","3":"Pharma","4":"2000-07-01","5":"310.5"},{"1":"NYSE","2":"ABT","3":"Pharma","4":"2019-12-01","5":"153.5"},{"1":"NASDAQ","2":"AMGN","3":"Biotech","4":"2019-12-01","5":"145.8"},{"1":"NYSE","2":"NVO","3":"Pharma","4":"2015-08-01","5":"159.6"},{"1":"NYSE","2":"ABBV","3":"Pharma","4":"2018-01-01","5":"196.2"},{"1":"NYSE","2":"AZN","3":"Pharma","4":"2019-12-01","5":"130.8"},{"1":"NYSE","2":"LLY","3":"Pharma","4":"2019-02-01","5":"131.2"},{"1":"NYSE","2":"GSK","3":"Pharma","4":"2006-05-01","5":"174.9"},{"1":"NASDAQ","2":"BMY","3":"Pharma","4":"2016-07-01","5":"128.3"},{"1":"NASDAQ","2":"GILD","3":"Biotech","4":"2013-06-01","5":"179.6"},{"1":"FWB","2":"BAYN","3":"Pharma","4":"2015-03-01","5":"129.0"},{"1":"NYSE","2":"SYK","3":"Pharma","4":"2019-12-01","5":"78.5"},{"1":"NYSE","2":"SNY","3":"Pharma","4":"2014-09-01","5":"151.3"},{"1":"NASDAQ","2":"ZTS","3":"Pharma","4":"2020-08-01","5":"76.6"},{"1":"NYSE","2":"TEVA","3":"Pharma","4":"2015-07-01","5":"110.5"},{"1":"NASDAQ","2":"TAK","3":"Pharma","4":"2019-12-01","5":"61.5"},{"1":"NASDAQ","2":"VRTX","3":"Pharma","4":"2020-07-01","5":"78.9"},{"1":"NASDAQ","2":"BIIB","3":"Biotech","4":"2015-03-01","5":"111.7"},{"1":"NASDAQ","2":"ILMN","3":"Biotech","4":"2019-07-01","5":"56.0"},{"1":"NASDAQ","2":"REGN","3":"Biotech","4":"2015-08-01","5":"61.4"},{"1":"TYO","2":"4503","3":"Pharma","4":"2015-12-01","5":"40.6"},{"1":"NASDAQ","2":"DSNKY","3":"Pharma","4":"2019-12-01","5":"45.3"},{"1":"NASDAQ","2":"ALXN","3":"Pharma","4":"2015-07-01","5":"47.0"},{"1":"TYO","2":"4523","3":"Pharma","4":"2016-12-01","5":"37.3"},{"1":"NASDAQ","2":"INCY","3":"Pharma","4":"2017-03-01","5":"31.2"},{"1":"NASDAQ","2":"BMRN","3":"Pharma","4":"2015-07-01","5":"24.0"},{"1":"NASDAQ","2":"GMAB","3":"Biotech","4":"2020-08-01","5":"24.7"},{"1":"NASDAQ","2":"MYL","3":"Pharma","4":"2015-12-01","5":"38.8"},{"1":"TSX","2":"BHC","3":"Pharma","4":"2020-08-01","5":"31.2"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="exercise-8" class="section level3" number="7.5.3">
<h3 number="7.5.3"><span class="header-section-number">7.5.3</span> exercise</h3>
<p>Use <code>TidyTopPharmComCaps</code> to create a scatter plot with <code>largest_market_cap_date</code> to the <code>x</code> axis, and <code>largest_market_cap_us_bil</code> to the <code>y</code>. Color the points by <code>company_type</code>.</p>
<pre class="r"><code>TidyTopPharmComCaps %&gt;% 
  ggplot() + 
  geom_point(aes(x = _____________, 
             y = _____________, 
             color = _____________)) + 
  lbl_graph_03</code></pre>
</div>
<div id="solution-8" class="section level3" number="7.5.4">
<h3 number="7.5.4"><span class="header-section-number">7.5.4</span> solution</h3>
<p>We can see this plot is showing us the date they reached their Largest Market Cap, and the date they reached it. But we still can’t see which company is which.</p>
<pre class="r"><code>TidyTopPharmComCaps %&gt;% 
  ggplot() + 
  geom_point(aes(x = largest_market_cap_date, 
                 y = largest_market_cap_us_bil, 
                 color = company_type)) + 
  lbl_graph_03</code></pre>
<p><img src="img/aes-sol-09-1.png" width="672" /></p>
</div>
<div id="exercise-9" class="section level3" number="7.5.5">
<h3 number="7.5.5"><span class="header-section-number">7.5.5</span> exercise</h3>
<p>Add another layer to the plot above using <code>geom_text()</code></p>
<ul>
<li>map <code>largest_market_cap_date</code> to the <code>x</code><br />
</li>
<li>map <code>largest_market_cap_us_bil</code> to the <code>y</code><br />
</li>
<li>map <code>stock_id</code> to <code>label</code></li>
<li>set <code>size</code> to <code>3</code> (outside <code>aes()</code>)</li>
</ul>
<pre class="r"><code>TidyTopPharmComCaps %&gt;% 
  ggplot() + 
  
  geom_point(aes(x = largest_market_cap_date, 
                 y = largest_market_cap_us_bil, 
                 color = company_type)) + 
  
  geom_text(aes(x = _____________, 
                y = _____________, 
                label = _____________), size = _) + 
  lbl_graph_03</code></pre>
</div>
<div id="solution-9" class="section level3" number="7.5.6">
<h3 number="7.5.6"><span class="header-section-number">7.5.6</span> solution</h3>
<p>We can see this plot has labelled each company so we can clearly see the date they reached their Largest Market Cap in comparison to other companies. The labels are hard to see, though…</p>
<pre class="r"><code>TidyTopPharmComCaps %&gt;% 
  ggplot() + 
  
  geom_point(aes(x = largest_market_cap_date, 
                 y = largest_market_cap_us_bil, 
                 color = company_type)) + 
  
  geom_text(aes(x = largest_market_cap_date, 
                y = largest_market_cap_us_bil, 
                label = stock_id), size = 3) + 
  lbl_graph_03</code></pre>
<p><img src="img/ael-sol-10-1.png" width="672" /></p>
</div>
<div id="exercise-10" class="section level3" number="7.5.7">
<h3 number="7.5.7"><span class="header-section-number">7.5.7</span> exercise</h3>
<p>Use the <a href="https://cran.r-project.org/web/packages/ggrepel/vignettes/ggrepel.html"><code>ggrepel</code> package</a> to adjust the labels.</p>
<ul>
<li>Map <code>stock_id</code> to <code>geom_text_repel()</code></li>
</ul>
<pre class="r"><code>library(ggrepel)
TidyTopPharmComCaps %&gt;% 
  ggplot(aes(x = largest_market_cap_date, 
             y = largest_market_cap_us_bil)) + 
  geom_point(aes(color = company_type)) + 
  geom_text_repel(aes(label = __________), size = 3) + 
  lbl_graph_03 </code></pre>
</div>
<div id="solution-10" class="section level3" number="7.5.8">
<h3 number="7.5.8"><span class="header-section-number">7.5.8</span> solution</h3>
<p>Now the labels for each company are easier to see. But this is still a very busy graph…</p>
<pre class="r"><code>library(ggrepel)
TidyTopPharmComCaps %&gt;% 
  ggplot(aes(x = largest_market_cap_date, 
             y = largest_market_cap_us_bil)) + 
  geom_point(aes(color = company_type)) + 
  geom_text_repel(aes(label = stock_id), size = 3) + 
  lbl_graph_03 </code></pre>
<p><img src="img/aes-sol-11-1.png" width="672" /></p>
</div>
</div>
<div id="using-facets" class="section level2 tabset" number="7.6">
<h2 class="tabset" number="7.6"><span class="header-section-number">7.6</span> Using Facets</h2>
<p>In the next few exercises we’re going to see how to use facets to explore values across different levels and scales.</p>
<p>Facets show subplots for different levels of a grouping variable.</p>
<div id="exercise-11" class="section level3" number="7.6.1">
<h3 number="7.6.1"><span class="header-section-number">7.6.1</span> exercise</h3>
<p>Use <code>facet_wrap()</code> to split the graphs by <code>company_type</code></p>
<ul>
<li>set the <code>scales</code> argument to <code>"free"</code> and <code>nrow</code> to <code>2</code>.</li>
</ul>
<pre class="r"><code>TidyTopPharmComCaps %&gt;% 
  ggplot(aes(x = largest_market_cap_date, 
             y = largest_market_cap_us_bil)) + 
  geom_point(aes(color = company_type), show.legend = FALSE) + 
  geom_text_repel(aes(label = stock_id), size = 3) + 
  
  facet_wrap(. ~ company_type, scales = ______, nrow = _) + 
  
  lbl_graph_03 </code></pre>
</div>
<div id="solution-11" class="section level3" number="7.6.2">
<h3 number="7.6.2"><span class="header-section-number">7.6.2</span> solution</h3>
<p>This creates two graphs–one for each level of <code>company_type</code>. Why would setting the <code>scales</code> to <code>"free"</code> be an issue?</p>
<pre class="r"><code>TidyTopPharmComCaps %&gt;% 
  ggplot(aes(x = largest_market_cap_date, 
             y = largest_market_cap_us_bil)) + 
  geom_point(aes(color = company_type), show.legend = FALSE) + 
  geom_text_repel(aes(label = stock_id), size = 3) + 
  
  facet_wrap(. ~ company_type, scales = &quot;free&quot;, nrow = 2) + 
  
  lbl_graph_03 </code></pre>
<p><img src="img/aes-sol-12-1.png" width="672" /></p>
</div>
<div id="exercise-12" class="section level3" number="7.6.3">
<h3 number="7.6.3"><span class="header-section-number">7.6.3</span> exercise</h3>
<p>Change the <code>scales</code> argument to <code>"free_x"</code> and rebuild the graph above.</p>
<pre class="r"><code>TidyTopPharmComCaps %&gt;% 
  filter(stock_exch %in% c(&quot;NASDAQ&quot;, &quot;NYSE&quot;), 
         company_type == &quot;Pharma&quot;) %&gt;% 
  ggplot(aes(x = largest_market_cap_date, 
             y = largest_market_cap_us_bil)) + 
  geom_point(aes(color = stock_exch), show.legend = FALSE) + 
  geom_text_repel(aes(label = stock_id), size = 3) + 
  facet_wrap(. ~ stock_exch, scales = ______, nrow = 2) + 
  lbl_graph_03 </code></pre>
</div>
<div id="solution-12" class="section level3" number="7.6.4">
<h3 number="7.6.4"><span class="header-section-number">7.6.4</span> solution</h3>
<p>This fixes the <code>y</code> axis, but allows the <code>x</code> to adjust according to the data. How can this be helpful?</p>
<pre class="r"><code>TidyTopPharmComCaps %&gt;% 
  filter(stock_exch %in% c(&quot;NASDAQ&quot;, &quot;NYSE&quot;), 
         company_type == &quot;Pharma&quot;) %&gt;% 
  ggplot(aes(x = largest_market_cap_date, 
             y = largest_market_cap_us_bil)) + 
  geom_point(aes(color = stock_exch), show.legend = FALSE) + 
  geom_text_repel(aes(label = stock_id), size = 3) + 
  
  facet_wrap(. ~ stock_exch, scales = &quot;free_x&quot;, nrow = 2) + 
  
  lbl_graph_03 </code></pre>
<p><img src="img/aes-sol-13-1.png" width="672" /></p>
</div>
<div id="exercise-13" class="section level3" number="7.6.5">
<h3 number="7.6.5"><span class="header-section-number">7.6.5</span> exercise</h3>
<p>Change the <code>scales</code> argument to <code>"free_y"</code> and rebuild the graph.</p>
<pre class="r"><code>TidyTopPharmComCaps %&gt;% 
  filter(stock_exch %in% c(&quot;NASDAQ&quot;, &quot;NYSE&quot;), 
         company_type == &quot;Pharma&quot;) %&gt;% 
  ggplot(aes(x = largest_market_cap_date, 
             y = largest_market_cap_us_bil)) + 
  geom_point(aes(color = stock_exch), show.legend = FALSE) + 
  geom_text_repel(aes(label = stock_id), size = 3) + 
  
  facet_wrap(. ~ stock_exch, scales = ________, nrow = 2) + 
  
  lbl_graph_03</code></pre>
</div>
<div id="solution-13" class="section level3" number="7.6.6">
<h3 number="7.6.6"><span class="header-section-number">7.6.6</span> solution</h3>
<p>Now we have a fixed <code>x</code> axis, and the <code>y</code> axis can adjust according to the data. How might this be helpful?</p>
<pre class="r"><code>TidyTopPharmComCaps %&gt;% 
  filter(stock_exch %in% c(&quot;NASDAQ&quot;, &quot;NYSE&quot;), 
         company_type == &quot;Pharma&quot;) %&gt;% 
  ggplot(aes(x = largest_market_cap_date, 
             y = largest_market_cap_us_bil)) + 
  geom_point(aes(color = stock_exch), show.legend = FALSE) + 
  geom_text_repel(aes(label = stock_id), size = 3) + 
  facet_wrap(. ~ stock_exch, scales = &quot;free_y&quot;, nrow = 2) + 
  lbl_graph_03 </code></pre>
<p><img src="img/aes-sol-14-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="recap" class="section level1" number="8">
<h1 number="8"><span class="header-section-number">8</span> Recap</h1>
<p>These exercises have covered:</p>
<ol style="list-style-type: decimal">
<li>Wrangling data with <code>dplyr</code>, <code>stringr</code> and <code>janitor</code><br />
</li>
<li>Tidying data with <code>tidyr</code><br />
</li>
<li>Graphing data using positions, aesthetics, and geoms<br />
</li>
<li>Using <code>facet</code>s to explore graphs across different scales for the <code>x</code> and <code>y</code> axes</li>
</ol>
</div>

<i class="fab fa-creative-commons fa-2x"></i><i class="fab fa-creative-commons-by fa-2x"></i><i class="fab fa-creative-commons-sa fa-2x"></i>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
