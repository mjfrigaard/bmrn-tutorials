<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data Visualization as Communication</title>

<script src="site_libs/header-attrs-2.5.3/header-attrs.js"></script>
<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="site_libs/anchor-sections-1.0.1/anchor-sections.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">bmRn R Training</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Lessons and exercises</a>
</li>
<li>
  <a href="slides.html">Slides</a>
</li>
<li>
  <a href="more-resources.html">More resources</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">About</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Data Visualization as Communication</h1>

</div>


<div id="objectives" class="section level1" number="1">
<h1 number="1"><span class="header-section-number">1</span> Objectives</h1>
<p>Recognize the needs of your audience</p>
<p><em>level of data literacy, subject matter expertise, etc.</em></p>
<p>Check and communicate data quality with stakeholders</p>
<p><em>let them know the good and the bad news</em></p>
<p>Identify the correct data visualization (based on the data)</p>
<p><em>single variable, bivariate, and multivariate graphs</em></p>
</div>
<div id="materials" class="section level1" number="2">
<h1 number="2"><span class="header-section-number">2</span> Materials</h1>
<ul>
<li><p>Slides:</p></li>
<li><p>RStudio Project:</p></li>
</ul>
</div>
<div id="previous-lessons" class="section level1" number="3">
<h1 number="3"><span class="header-section-number">3</span> Previous lessons</h1>
<p>All of the exercises and lessons are available <a href="https://mjfrigaard.github.io/r-meetup-tutorials/">here</a>, but you can also read more about <a href="https://ggplot2.tidyverse.org/index.html"><code>ggplot2</code></a> on the tidyverse website, and in the <a href="https://r4ds.had.co.nz/data-visualisation.html">Data Visualisation</a> chapter of R for Data Science.</p>
</div>
<div id="load-the-packages" class="section level1" number="4">
<h1 number="4"><span class="header-section-number">4</span> Load the packages</h1>
<p>The main packages we’re going to use are <code>dplyr</code>, <code>tidyr</code>, and <code>ggplot2</code>. These are all part of the <code>tidyverse</code>, so we’ll import this package below:</p>
<pre class="r"><code>install.packages(&quot;tidyverse&quot;)
library(tidyverse)</code></pre>
</div>
<div id="example-covid-and-mobility" class="section level1" number="5">
<h1 number="5"><span class="header-section-number">5</span> Example: COVID and Mobility</h1>
<ul>
<li><p>How has COVID changed our modes of transportation?</p>
<ul>
<li><em>are people using fewer or different forms of transportation?</em></li>
</ul></li>
<li><p>What kind of measurements would this be?</p>
<ul>
<li><em>how people travel (walk, drive, etc.)</em></li>
</ul></li>
<li><p>What would these data look like?</p>
<ul>
<li><em>what would the columns and rows look like?</em></li>
</ul></li>
</ul>
<div id="data-import" class="section level2 tabset" number="5.1">
<h2 class="tabset" number="5.1"><span class="header-section-number">5.1</span> Data Import</h2>
<p>Apple mobility data:</p>
<p><a href="https://covid19.apple.com/mobility" class="uri">https://covid19.apple.com/mobility</a></p>
<p>Import these data below:</p>
<pre class="r"><code>AppleMobRaw &lt;- readr::read_csv(&quot;https://bit.ly/apple-mob-raw&quot;)</code></pre>
<div id="tidy-applemobraw" class="section level3" number="5.1.1">
<h3 number="5.1.1"><span class="header-section-number">5.1.1</span> Tidy <code>AppleMobRaw</code></h3>
<p>These data need to be restructured into a tidy format.</p>
<pre class="r"><code>AppleMobRaw %&gt;% 
  tidyr::pivot_longer(cols = -c(geo_type:country), 
                      names_to = &quot;date&quot;, values_to = &quot;dir_request&quot;)</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["geo_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["region"],"name":[2],"type":["chr"],"align":["left"]},{"label":["transportation_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["sub-region"],"name":[4],"type":["chr"],"align":["left"]},{"label":["country"],"name":[5],"type":["chr"],"align":["left"]},{"label":["date"],"name":[6],"type":["chr"],"align":["left"]},{"label":["dir_request"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-13","7":"100.00"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-14","7":"95.30"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-15","7":"101.43"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-16","7":"97.20"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-17","7":"103.55"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-18","7":"112.67"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-19","7":"104.83"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-20","7":"94.39"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-21","7":"94.07"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-22","7":"93.51"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-23","7":"92.94"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-24","7":"102.13"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-25","7":"102.38"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-26","7":"101.41"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-27","7":"94.62"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-28","7":"89.12"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-29","7":"90.17"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-30","7":"90.21"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-01-31","7":"97.71"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-01","7":"102.50"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-02","7":"108.92"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-03","7":"92.82"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-04","7":"91.48"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-05","7":"93.99"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-06","7":"96.72"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-07","7":"102.46"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-08","7":"103.29"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-09","7":"107.83"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-10","7":"87.99"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-11","7":"94.18"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-12","7":"94.62"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-13","7":"99.70"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-14","7":"139.30"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-15","7":"123.90"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-16","7":"129.41"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-17","7":"102.24"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-18","7":"88.09"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-19","7":"88.17"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-20","7":"94.48"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-21","7":"100.62"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-22","7":"111.02"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-23","7":"113.50"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-24","7":"86.95"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-25","7":"83.01"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-26","7":"85.44"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-27","7":"82.73"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-28","7":"89.70"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-02-29","7":"95.48"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-01","7":"100.43"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-02","7":"89.25"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-03","7":"91.02"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-04","7":"89.72"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-05","7":"94.87"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-06","7":"102.82"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-07","7":"109.92"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-08","7":"110.07"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-09","7":"79.68"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-10","7":"68.24"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-11","7":"51.77"},{"1":"country/region","2":"Albania","3":"driving","4":"NA","5":"NA","6":"2020-03-12","7":"43.79"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="wrangle-applemobraw" class="section level3" number="5.1.2">
<h3 number="5.1.2"><span class="header-section-number">5.1.2</span> Wrangle <code>AppleMobRaw</code></h3>
<p>We will remove the missing values from <code>country</code> and <code>sub-region</code></p>
<pre class="r"><code>AppleMobRaw %&gt;% 
  tidyr::pivot_longer(cols = -c(geo_type:country), 
                      names_to = &quot;date&quot;, values_to = &quot;dir_request&quot;) %&gt;% 
    # remove missing country and missing sub-region data
  dplyr::filter(!is.na(country) &amp; !is.na(`sub-region`))</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["geo_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["region"],"name":[2],"type":["chr"],"align":["left"]},{"label":["transportation_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["sub-region"],"name":[4],"type":["chr"],"align":["left"]},{"label":["country"],"name":[5],"type":["chr"],"align":["left"]},{"label":["date"],"name":[6],"type":["chr"],"align":["left"]},{"label":["dir_request"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-13","7":"100.00"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-14","7":"100.73"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-15","7":"102.86"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-16","7":"102.65"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-17","7":"109.39"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-18","7":"109.62"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-19","7":"98.21"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-20","7":"102.74"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-21","7":"103.85"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-22","7":"102.01"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-23","7":"101.40"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-24","7":"107.57"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-25","7":"109.13"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-26","7":"97.51"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-27","7":"101.64"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-28","7":"100.59"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-29","7":"103.33"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-30","7":"104.31"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-01-31","7":"113.82"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-01","7":"113.59"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-02","7":"98.83"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-03","7":"103.15"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-04","7":"103.89"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-05","7":"101.56"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-06","7":"102.56"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-07","7":"111.98"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-08","7":"112.91"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-09","7":"88.21"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-10","7":"105.14"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-11","7":"107.55"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-12","7":"107.62"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-13","7":"110.29"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-14","7":"121.38"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-15","7":"115.58"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-16","7":"98.64"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-17","7":"108.30"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-18","7":"111.55"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-19","7":"106.26"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-20","7":"98.08"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-21","7":"106.48"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-22","7":"96.88"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-23","7":"82.05"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-24","7":"87.53"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-25","7":"97.50"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-26","7":"97.03"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-27","7":"105.28"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-28","7":"102.80"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-02-29","7":"103.48"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-01","7":"92.08"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-02","7":"95.39"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-03","7":"100.71"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-04","7":"101.12"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-05","7":"102.29"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-06","7":"108.11"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-07","7":"107.92"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-08","7":"96.28"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-09","7":"94.72"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-10","7":"96.77"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-11","7":"111.70"},{"1":"city","2":"Aachen","3":"driving","4":"North Rhine-Westphalia","5":"Germany","6":"2020-03-12","7":"90.88"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<p>Use <code>mutate()</code> to create a properly formatted <code>date</code> variable, and <code>rename()</code> the <code>transportation_type</code> variable to <code>trans_type</code>. Apply <code>janitor::clean_names()</code> to the entire dataset and assign the final output to <code>TidyApple</code>.</p>
<pre class="r"><code>AppleMobRaw %&gt;% 
  tidyr::pivot_longer(cols = -c(geo_type:country), 
                      names_to = &quot;date&quot;, values_to = &quot;dir_request&quot;) %&gt;% 
    # remove missing country and missing sub-region data
  dplyr::filter(!is.na(country) &amp; !is.na(`sub-region`)) %&gt;% 
  # format date
  mutate(date = lubridate::ymd(date)) %&gt;% 
  # change name of transportation types
  rename(trans_type = transportation_type) %&gt;% 
  # clean names 
  janitor::clean_names() -&gt; TidyApple</code></pre>
</div>
<div id="bonus-counting" class="section level3" number="5.1.3">
<h3 number="5.1.3"><span class="header-section-number">5.1.3</span> Bonus (counting!)</h3>
<p>One of the most important jobs of analytic work is counting things :) below is an example of using the <code>map()</code> function from the <code>purrr</code> package to pass the <code>count()</code> function from <code>dplyr</code> to the character variables in <code>TidyApple</code>. We can example the counts of each value by using the <code>$</code> to subset the <code>tidy_apple_counts</code> list.</p>
<pre class="r"><code>TidyApple %&gt;% 
  select_if(is.character) %&gt;% 
  map(~count(data.frame(x = .x), x, sort = TRUE)) -&gt; tidy_apple_counts

tidy_apple_counts$country</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["x"],"name":[1],"type":["chr"],"align":["left"]},{"label":["n"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"United States","2":"935784"},{"1":"Japan","2":"25360"},{"1":"United Kingdom","2":"15216"},{"1":"Germany","2":"13631"},{"1":"France","2":"10778"},{"1":"Canada","2":"6657"},{"1":"Italy","2":"6657"},{"1":"Brazil","2":"5072"},{"1":"Australia","2":"4755"},{"1":"Switzerland","2":"4755"},{"1":"Mexico","2":"3804"},{"1":"Spain","2":"3804"},{"1":"Netherlands","2":"3487"},{"1":"Sweden","2":"2853"},{"1":"Poland","2":"2536"},{"1":"Belgium","2":"1902"},{"1":"Russia","2":"1268"},{"1":"South Africa","2":"1268"},{"1":"Denmark","2":"951"},{"1":"Finland","2":"951"},{"1":"New Zealand","2":"951"},{"1":"Austria","2":"634"},{"1":"Chile","2":"634"},{"1":"Greece","2":"634"},{"1":"Israel","2":"634"},{"1":"Malaysia","2":"317"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</div>
<div id="visualizing-distributions" class="section level1" number="6">
<h1 number="6"><span class="header-section-number">6</span> Visualizing Distributions</h1>
<p>Before we start looking at relationships <em>between</em> variables, we might want to examine the underlying distribution of a single variable. We’re going to cover two graphs that display variable distributions: histograms and density plots.</p>
<div id="histograms" class="section level2 tabset" number="6.1">
<h2 class="tabset" number="6.1"><span class="header-section-number">6.1</span> Histograms</h2>
<p>The <code>x</code> axis for the histogram will have the direction requests, and the <code>y</code> variable will display a count of the values.</p>
<pre class="r"><code>lab_hist &lt;- labs(x = &quot;Apple directions requests&quot;,
                 y = &quot;Count&quot;,
     title = &quot;Distribution of Direction Requests&quot;,
     subtitle = &quot;source: https://covid19.apple.com/mobility&quot;)</code></pre>
<p>A histogram is a special kind of bar graph–it only takes a single continuous variable (in this case, <code>dir_request</code>), and it displays a relative breakdown of the values.</p>
<div id="exercise" class="section level3" number="6.1.1">
<h3 number="6.1.1"><span class="header-section-number">6.1.1</span> exercise</h3>
<p>Create a histogram of direction requests using <code>dir_request</code></p>
<pre class="r"><code>TidyApple %&gt;% ggplot() + 
  geom_histogram(aes(x = ____________)) + 
  lab_hist</code></pre>
</div>
<div id="solution" class="section level3" number="6.1.2">
<h3 number="6.1.2"><span class="header-section-number">6.1.2</span> solution</h3>
<p>See blow:</p>
<pre class="r"><code>TidyApple %&gt;% ggplot() + 
  geom_histogram(aes(x = dir_request)) + 
  lab_hist</code></pre>
<p><img src="img/geom_histogram-sol-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="adjusting-y-axes" class="section level2 tabset" number="6.2">
<h2 class="tabset" number="6.2"><span class="header-section-number">6.2</span> Adjusting Y Axes</h2>
<p>We can see the <code>y</code> axis is in scientific notation. This might be hard for some audiences to interpret, so we will change this to use the whole number with commas with the <a href="https://scales.r-lib.org/"><code>scales</code> package</a>.</p>
<div id="exercise-1" class="section level3" number="6.2.1">
<h3 number="6.2.1"><span class="header-section-number">6.2.1</span> exercise</h3>
<p>Add the <code>scales::comma</code> value to the <code>scale_y_continuous()</code> function.</p>
<pre class="r"><code>library(scales)
TidyApple %&gt;% ggplot() + 
  geom_histogram(aes(x = dir_request)) + 
  scale_y_continuous(labels = __________) +
  lab_hist</code></pre>
</div>
<div id="solution-1" class="section level3" number="6.2.2">
<h3 number="6.2.2"><span class="header-section-number">6.2.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>library(scales)
TidyApple %&gt;% ggplot() + 
  geom_histogram(aes(x = dir_request)) + 
  scale_y_continuous(labels = scales::comma) +
  lab_hist</code></pre>
<p><img src="img/scales-sol-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="histogram-shape" class="section level2 tabset" number="6.3">
<h2 class="tabset" number="6.3"><span class="header-section-number">6.3</span> Histogram Shape</h2>
<p>We can control the shape of the with the <code>bins</code> argument. The default is <code>30</code>.</p>
<div id="exercie" class="section level3" number="6.3.1">
<h3 number="6.3.1"><span class="header-section-number">6.3.1</span> exercie</h3>
<p>Set <code>bins</code> to <code>15</code>.</p>
<pre class="r"><code>TidyApple %&gt;% ggplot() + 
  geom_histogram(aes(x = dir_request), bins = __) + 
  scale_y_continuous(labels = scales::comma) +
  lab_hist</code></pre>
</div>
<div id="solution-2" class="section level3" number="6.3.2">
<h3 number="6.3.2"><span class="header-section-number">6.3.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TidyApple %&gt;% ggplot() + 
  geom_histogram(aes(x = dir_request), bins = 15) + 
  scale_y_continuous(labels = scales::comma) +
  lab_hist</code></pre>
<p><img src="img/bins-15-sol-1.png" width="100%" height="100%" /></p>
</div>
<div id="exercise-2" class="section level3" number="6.3.3">
<h3 number="6.3.3"><span class="header-section-number">6.3.3</span> exercise</h3>
<p>Set <code>bins</code> to <code>45</code> and assign it to <code>gg_hist45</code>.</p>
<pre class="r"><code>TidyApple %&gt;% ggplot() + 
  geom_histogram(aes(x = dir_request), bins = __) + 
  scale_y_continuous(labels = scales::comma) +
  lab_hist -&gt; _____________</code></pre>
</div>
<div id="solution-3" class="section level3" number="6.3.4">
<h3 number="6.3.4"><span class="header-section-number">6.3.4</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TidyApple %&gt;% ggplot() + 
  geom_histogram(aes(x = dir_request), bins = 45) + 
  scale_y_continuous(labels = scales::comma) +
  lab_hist -&gt; gg_hist45</code></pre>
<p><img src="img/gg_hist45-show-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="density-plots" class="section level2 tabset" number="6.4">
<h2 class="tabset" number="6.4"><span class="header-section-number">6.4</span> Density Plots</h2>
<p>What if we want to see how a continuous variable is distributed across a categorical variable? Density plots come in handy here (so do <code>geom_boxplot()</code>s!), even though the <code>y</code> axis can be hard to interpret. Read more about the density geom <a href="https://ggplot2.tidyverse.org/reference/geom_density.html">here</a>.</p>
<p>We are going to create some labels so we know what to expect when we create our graph. We want to see the distribution of the directions request, filled by the levels of transportation type.</p>
<pre class="r"><code>lab_density &lt;- labs(x = &quot;Apple directions requests&quot;,
                    fill = &quot;Transit Type&quot;,
     title = &quot;Distribution of Direction Requests vs. Transportation Type&quot;,
     subtitle = &quot;source: https://covid19.apple.com/mobility&quot;)</code></pre>
<p>Now we build the density plot, passing the variables so they match our labels above.</p>
<div id="exercise-3" class="section level3" number="6.4.1">
<h3 number="6.4.1"><span class="header-section-number">6.4.1</span> exercise</h3>
<p>Create a density plot of direction requests colored by the type of transportation.</p>
<pre class="r"><code>TidyApple %&gt;% 
  ggplot() +
  geom_density(aes(x = __________, fill = __________)) + 
  lab_density</code></pre>
</div>
<div id="solution-4" class="section level3" number="6.4.2">
<h3 number="6.4.2"><span class="header-section-number">6.4.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TidyApple %&gt;% 
  ggplot() +
  geom_density(aes(x = dir_request, fill = trans_type)) + 
  lab_density</code></pre>
<p><img src="img/density-sol-1.png" width="100%" height="100%" /></p>
</div>
<div id="exercise-4" class="section level3" number="6.4.3">
<h3 number="6.4.3"><span class="header-section-number">6.4.3</span> exercise</h3>
<p>Adjust the overlapping densities by setting <code>alpha</code> to <code>1/3</code>. Assign this plot to <code>gg_density</code>.</p>
<pre class="r"><code>TidyApple %&gt;% 
  ggplot() +
  geom_density(aes(x = dir_request, fill = trans_type), 
               alpha = __________) + 
  
  lab_density -&gt; __________</code></pre>
</div>
<div id="solution-5" class="section level3" number="6.4.4">
<h3 number="6.4.4"><span class="header-section-number">6.4.4</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TidyApple %&gt;% 
  ggplot() +
  geom_density(aes(x = dir_request, fill = trans_type), 
               alpha = 1/3) + 
  lab_density -&gt; gg_density

gg_density</code></pre>
<p><img src="img/density-alpha-1.png" width="100%" height="100%" /></p>
</div>
</div>
</div>
<div id="visualizing-trends" class="section level1" number="7">
<h1 number="7"><span class="header-section-number">7</span> Visualizing Trends</h1>
<p>Now we’ve seen the distribution of <code>dir_request</code>, and how it varies across <code>trans_type</code>. Next we’ll look at how the relaitionship between these two variabels varies over <code>date</code>.</p>
<div id="focus-on-us-cities" class="section level2 tabset" number="7.1">
<h2 class="tabset" number="7.1"><span class="header-section-number">7.1</span> Focus on US Cities</h2>
<p>Let’s narrow the data down a bit. We’ll start by filtering to only US cities.</p>
<div id="exercise-5" class="section level3" number="7.1.1">
<h3 number="7.1.1"><span class="header-section-number">7.1.1</span> exercise</h3>
<p>Filter the <code>geo_type</code> to <code>"city"</code> and the <code>country</code> to <code>"United States"</code>, and pass the <code>date</code> variable to <code>skimr::skim()</code></p>
<pre class="r"><code>TidyApple %&gt;% 
  filter(geo_type == ___________ &amp;
              country == ___________) %&gt;% 
                # use skimr to check date
                skimr::skim(___________)</code></pre>
</div>
<div id="solution-6" class="section level3" number="7.1.2">
<h3 number="7.1.2"><span class="header-section-number">7.1.2</span> solution</h3>
<p>Here we reduce the dataset to only cities in the US, and we check the <code>date</code> range with <code>skimr::skim()</code></p>
<pre class="r"><code>TidyApple %&gt;% 
  filter(geo_type == &quot;city&quot; &amp;
              country == &quot;United States&quot;) %&gt;% 
                # use skimr to check date
                skimr::skim(date)</code></pre>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">99538</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">7</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Date</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: Date</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">date</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2020-01-13</td>
<td align="left">2020-11-24</td>
<td align="left">2020-06-19</td>
<td align="right">317</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="updating-labels" class="section level2" number="7.2">
<h2 number="7.2"><span class="header-section-number">7.2</span> Updating Labels</h2>
<p>We can see this date range is from 2020-01-13 to 2020-11-24.</p>
<p>We want to specify this in our labels object (<code>lab_line01</code>), so we will use the <code>paste0()</code> function to have the labels update every time the data changes.</p>
<pre class="r"><code>lab_line01 &lt;- labs(x = &quot;Date&quot;,
                 y = &quot;Direction Requests&quot;,
                 title = &quot;Direction Requests Over Time (US Cities Only)&quot;,
                 subtitle = paste0(min(TidyApple$date), &quot; through &quot;, max(TidyApple$date)),
                 caption = &quot;source: https://covid19.apple.com/mobility&quot;, 
                 color = &quot;Transit Type&quot;)</code></pre>
</div>
<div id="line-graphs" class="section level2 tabset" number="7.3">
<h2 class="tabset" number="7.3"><span class="header-section-number">7.3</span> Line Graphs</h2>
<p>We’re going to create a line graph of direction requests over time, colored by color.</p>
<div id="exercise-6" class="section level3" number="7.3.1">
<h3 number="7.3.1"><span class="header-section-number">7.3.1</span> exercise</h3>
<p>Pass the filtered data to the <code>geom_line()</code>, mapping the following variables to their relative aesthetics:</p>
<ul>
<li><code>date</code> to <code>x</code><br />
</li>
<li><code>dir_request</code> to <code>y</code><br />
</li>
<li><code>trans_type</code> to both <code>group</code> and <code>color</code></li>
</ul>
<p>Include <code>lab_line01</code> to see how the new labels look.</p>
<pre class="r"><code>TidyApple %&gt;% 
  filter(geo_type == &quot;city&quot; &amp;
              country == &quot;United States&quot;) %&gt;% 
  ggplot() +
  geom_line(aes(x = __________, y = __________, 
             group = __________, color = __________)) + 
  __________</code></pre>
</div>
<div id="solution-7" class="section level3" number="7.3.2">
<h3 number="7.3.2"><span class="header-section-number">7.3.2</span> solution</h3>
<p>Let’s see what happens when we use <code>lab_line01</code>.</p>
<pre class="r"><code>TidyApple %&gt;% 
  filter(geo_type == &quot;city&quot; &amp;
              country == &quot;United States&quot;) %&gt;% 
  ggplot() +
  geom_line(aes(x = date, y = dir_request, 
             group = trans_type, color = trans_type)) + 
  lab_line01</code></pre>
<p><img src="img/geom-line-us-cities-sol-1.png" width="100%" height="100%" /></p>
<p>The lines in this graph are overlapping each other, so we will adjust the <code>size</code> to <code>0.20</code>.</p>
</div>
<div id="exercise-7" class="section level3" number="7.3.3">
<h3 number="7.3.3"><span class="header-section-number">7.3.3</span> exercise</h3>
<p>Change the size of the <code>geom_line()</code> (outside of <code>aes()</code>).</p>
<pre class="r"><code>TidyApple %&gt;% 
  filter(geo_type == &quot;city&quot; &amp;
              country == &quot;United States&quot;) %&gt;% 
  ggplot() +
  geom_line(aes(x = date, y = dir_request, 
             group = trans_type, color = trans_type), 
            size = ____________) + 
  lab_line01</code></pre>
</div>
<div id="solution-8" class="section level3" number="7.3.4">
<h3 number="7.3.4"><span class="header-section-number">7.3.4</span> solution</h3>
<p>Now the trends are easier to see.</p>
<pre class="r"><code>TidyApple %&gt;% 
  filter(geo_type == &quot;city&quot; &amp;
              country == &quot;United States&quot;) %&gt;% 
  ggplot() +
  geom_line(aes(x = date, y = dir_request, 
             group = trans_type, color = trans_type), 
            size = 0.20) + 
  lab_line01</code></pre>
<p><img src="img/us-cities-line-alpha-sol-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="narrow-date-range" class="section level2 tabset" number="7.4">
<h2 class="tabset" number="7.4"><span class="header-section-number">7.4</span> Narrow Date Range</h2>
<p>We are going to only look at the trends between February and August of 2020. We will create two new objects (<code>start_date</code> and <code>end_date</code>), which we can use to embed the dates into the <code>filter()</code> function (and anywhere else we need to use this date range). This method is probably better than passing the dates as a character (i.e. in quotes), because we would only have to change it in one place. However, the option above makes better use of R functional programming syntax.</p>
<div id="exercise-8" class="section level3" number="7.4.1">
<h3 number="7.4.1"><span class="header-section-number">7.4.1</span> exercise</h3>
<p>Pass the <code>start_date</code> and <code>end_date</code> to the <code>as_date()</code> functions, and take a look at the <code>date</code> variable with <code>skimr::skim()</code></p>
<pre class="r"><code># create date objects
start_date &lt;- &quot;2020-02-01&quot;
end_date &lt;- &quot;2020-08-01&quot;
# check with skimr
TidyApple %&gt;% 
  filter(geo_type == &quot;city&quot; &amp;
              country == &quot;United States&quot;, 
                date &gt;= as_date(_____________) &amp; 
                  date &lt;= as_date(_____________)) %&gt;% 
                  skimr::skim(_____________)</code></pre>
</div>
<div id="solution-9" class="section level3" number="7.4.2">
<h3 number="7.4.2"><span class="header-section-number">7.4.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code># create date objects
start_date &lt;- &quot;2020-02-01&quot;
end_date &lt;- &quot;2020-08-01&quot;
# check with skimr
TidyApple %&gt;% 
  filter(geo_type == &quot;city&quot; &amp;
              country == &quot;United States&quot;, 
                date &gt;= as_date(start_date) &amp; 
                  date &lt;= as_date(end_date)) %&gt;% 
                  skimr::skim(date)</code></pre>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">57462</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">7</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Date</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: Date</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">date</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2020-02-01</td>
<td align="left">2020-08-01</td>
<td align="left">2020-05-02</td>
<td align="right">183</td>
</tr>
</tbody>
</table>
</div>
<div id="exercise-9" class="section level3" number="7.4.3">
<h3 number="7.4.3"><span class="header-section-number">7.4.3</span> exercise</h3>
<p>Create the new labels (<code>lab_line_02</code>) with the <code>paste0()</code> function by passing both <code>start_date</code> and <code>end_date</code>. Assign the plot to <code>gg_us_cities</code></p>
<pre class="r"><code>lab_line_02 &lt;- labs(x = &quot;Date&quot;,
                 y = &quot;Direction Requests&quot;,
                 title = &quot;Direction Requests Over Time (US Cities Only)&quot;,
                 subtitle = paste0(___________, &quot; through &quot;, ___________),
                 caption = &quot;source: https://covid19.apple.com/mobility&quot;, 
                 color = &quot;Transit Type&quot;)

TidyApple %&gt;% 
  filter(geo_type == &quot;city&quot; &amp;
              country == &quot;United States&quot;, 
                date &gt;= as_date(start_date) &amp; 
                  date &lt;= as_date(end_date)) %&gt;%
  ggplot() +
  # make these slightly larger...
  geom_line(aes(x = date, y = dir_request, 
             group = trans_type, color = trans_type), size = 0.30) + 
  lab_line_02 -&gt; ___________</code></pre>
</div>
<div id="solution-10" class="section level3" number="7.4.4">
<h3 number="7.4.4"><span class="header-section-number">7.4.4</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>lab_line_02 &lt;- labs(x = &quot;Date&quot;,
                 y = &quot;Direction Requests&quot;,
                 title = &quot;Direction Requests Over Time (US Cities Only)&quot;,
                 subtitle = paste0(start_date, &quot; through &quot;, end_date),
                 caption = &quot;source: https://covid19.apple.com/mobility&quot;, 
                 color = &quot;Transit Type&quot;)

TidyApple %&gt;% 
  filter(geo_type == &quot;city&quot; &amp;
              country == &quot;United States&quot;, 
                date &gt;= as_date(start_date) &amp; 
                  date &lt;= as_date(end_date)) %&gt;%
  ggplot() +
  
  geom_line(aes(x = date, y = dir_request, 
             group = trans_type, color = trans_type), 
            # make these slightly larger...
            size = 0.30) + 
  lab_line_02 -&gt; gg_us_cities</code></pre>
<p><img src="img/show-gg_us_cities-1.png" width="672" /></p>
</div>
</div>
</div>
<div id="labelling-data" class="section level1" number="8">
<h1 number="8"><span class="header-section-number">8</span> Labelling Data</h1>
<p>In the previous lesson, we introduced the <code>ggrepel</code> package to show the points on this graph of top performing pharmaceutical companies.</p>
<p><img src="img/aes-sol-11-1.png" width="70%" height="70%" style="display: block; margin: auto;" /></p>
<p>We’re going to use labels to highlight a few cities in the <code>TidyApple</code> dataset.</p>
<div id="max-driving-requests" class="section level2 tabset" number="8.1">
<h2 class="tabset" number="8.1"><span class="header-section-number">8.1</span> Max Driving Requests</h2>
<p>The code below creates a subset of the data (<code>TopUSCities</code>). Use this to add the labels.</p>
<pre class="r"><code>TopUSCities &lt;- TidyApple %&gt;% 
  filter(country == &quot;United States&quot; &amp; 
           region %in% c(&quot;New York City&quot;, &quot;Los Angeles&quot;, 
                         &quot;Chicago&quot;, &quot;Houston&quot;, &quot;Phoenix&quot;)) 
TopUSCities</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["geo_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["region"],"name":[2],"type":["chr"],"align":["left"]},{"label":["trans_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["sub_region"],"name":[4],"type":["chr"],"align":["left"]},{"label":["country"],"name":[5],"type":["chr"],"align":["left"]},{"label":["date"],"name":[6],"type":["date"],"align":["right"]},{"label":["dir_request"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-13","7":"100.00"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-14","7":"103.68"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-15","7":"104.45"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-16","7":"108.72"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-17","7":"132.80"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-18","7":"113.44"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-19","7":"87.48"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-20","7":"100.24"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-21","7":"101.30"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-22","7":"100.51"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-23","7":"104.47"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-24","7":"121.92"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-25","7":"118.55"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-26","7":"85.17"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-27","7":"93.81"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-28","7":"97.36"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-29","7":"98.96"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-30","7":"103.79"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-01-31","7":"124.37"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-01","7":"122.53"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-02","7":"85.96"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-03","7":"94.62"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-04","7":"97.39"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-05","7":"102.86"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-06","7":"103.66"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-07","7":"117.63"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-08","7":"124.27"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-09","7":"88.41"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-10","7":"98.78"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-11","7":"105.64"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-12","7":"108.54"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-13","7":"115.99"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-14","7":"147.32"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-15","7":"141.24"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-16","7":"111.31"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-17","7":"111.07"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-18","7":"104.69"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-19","7":"105.82"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-20","7":"110.84"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-21","7":"132.55"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-22","7":"138.50"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-23","7":"100.83"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-24","7":"99.41"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-25","7":"100.35"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-26","7":"103.39"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-27","7":"114.33"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-28","7":"139.02"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-02-29","7":"142.31"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-01","7":"105.39"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-02","7":"105.25"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-03","7":"108.28"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-04","7":"110.71"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-05","7":"116.43"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-06","7":"137.62"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-07","7":"144.91"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-08","7":"107.11"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-09","7":"105.68"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-10","7":"109.76"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-11","7":"107.34"},{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-03-12","7":"105.61"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
<div id="exercise-10" class="section level3" number="8.1.1">
<h3 number="8.1.1"><span class="header-section-number">8.1.1</span> exercise</h3>
<p>Create <code>MaxUSCitiesDriving</code> by filtering <code>trans_type</code>, grouping on the <code>region</code> variable, and using <code>dplyr::slice_max()</code> to get the top value in <code>dir_request</code>.</p>
<pre class="r"><code>TopUSCities %&gt;% 
  filter(trans_type == __________) %&gt;% 
  group_by(__________) %&gt;% 
  slice_max(__________) -&gt; MaxUSCitiesDriving
MaxUSCitiesDriving</code></pre>
</div>
<div id="solution-11" class="section level3" number="8.1.2">
<h3 number="8.1.2"><span class="header-section-number">8.1.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TopUSCities %&gt;% 
  filter(trans_type == &quot;driving&quot;) %&gt;% 
  group_by(region) %&gt;% 
  slice_max(dir_request) -&gt; MaxUSCitiesDriving
MaxUSCitiesDriving</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["geo_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["region"],"name":[2],"type":["chr"],"align":["left"]},{"label":["trans_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["sub_region"],"name":[4],"type":["chr"],"align":["left"]},{"label":["country"],"name":[5],"type":["chr"],"align":["left"]},{"label":["date"],"name":[6],"type":["date"],"align":["right"]},{"label":["dir_request"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-07-17","7":"166.11"},{"1":"city","2":"Houston","3":"driving","4":"Texas","5":"United States","6":"2020-02-14","7":"146.20"},{"1":"city","2":"Los Angeles","3":"driving","4":"California","5":"United States","6":"2020-02-14","7":"152.08"},{"1":"city","2":"New York City","3":"driving","4":"New York","5":"United States","6":"2020-09-04","7":"152.09"},{"1":"city","2":"Phoenix","3":"driving","4":"Arizona","5":"United States","6":"2020-02-29","7":"142.68"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="exercise-11" class="section level3" number="8.1.3">
<h3 number="8.1.3"><span class="header-section-number">8.1.3</span> exercise</h3>
<p>Create graph labels:</p>
<ul>
<li><p>assign <code>"Peak Driving Direction Requests in Largest US Cities"</code> to <code>title</code></p></li>
<li><p>assign <code>"Max Driving Direction Requests &amp; Date"</code> to <code>subtitle</code></p></li>
</ul>
<pre class="r"><code>lab_line_max_drivers &lt;- labs(
                 x = &quot;Date&quot;,
                 y = &quot;Direction Requests&quot;,
                 title = &quot;_________________________________&quot;,
                 subtitle = &quot;_________________________________&quot;,
                 caption = &quot;source: https://covid19.apple.com/mobility&quot;, 
                 color = &quot;Transit Type&quot;)</code></pre>
</div>
<div id="solution-12" class="section level3" number="8.1.4">
<h3 number="8.1.4"><span class="header-section-number">8.1.4</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>lab_line_max_drivers &lt;- labs(
                 x = &quot;Date&quot;,
                 y = &quot;Direction Requests&quot;,
                 title = &quot;Peak Driving Direction Requests in Largest US Cities&quot;,
                 subtitle = &quot;Max Driving Direction Requests &amp; Date&quot;,
                 caption = &quot;source: https://covid19.apple.com/mobility&quot;, 
                 color = &quot;Transit Type&quot;)</code></pre>
</div>
<div id="exercise-12" class="section level3" number="8.1.5">
<h3 number="8.1.5"><span class="header-section-number">8.1.5</span> exercise</h3>
<p>Create <code>max_driving_labels</code> using <code>paste0()</code> with <code>region</code> and <code>date</code>.</p>
<pre class="r"><code>MaxUSCitiesDriving %&gt;% 
  mutate(
    max_driving_labels = paste0(______, &quot;, &quot;, ______)) -&gt; MaxUSCitiesDriving
MaxUSCitiesDriving</code></pre>
</div>
<div id="solution-13" class="section level3" number="8.1.6">
<h3 number="8.1.6"><span class="header-section-number">8.1.6</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>MaxUSCitiesDriving %&gt;% 
  mutate(max_driving_labels = paste0(region, &quot;, &quot;, date)) -&gt; MaxUSCitiesDriving
MaxUSCitiesDriving</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["geo_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["region"],"name":[2],"type":["chr"],"align":["left"]},{"label":["trans_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["sub_region"],"name":[4],"type":["chr"],"align":["left"]},{"label":["country"],"name":[5],"type":["chr"],"align":["left"]},{"label":["date"],"name":[6],"type":["date"],"align":["right"]},{"label":["dir_request"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["max_driving_labels"],"name":[8],"type":["chr"],"align":["left"]}],"data":[{"1":"city","2":"Chicago","3":"driving","4":"Illinois","5":"United States","6":"2020-07-17","7":"166.11","8":"Chicago, 2020-07-17"},{"1":"city","2":"Houston","3":"driving","4":"Texas","5":"United States","6":"2020-02-14","7":"146.20","8":"Houston, 2020-02-14"},{"1":"city","2":"Los Angeles","3":"driving","4":"California","5":"United States","6":"2020-02-14","7":"152.08","8":"Los Angeles, 2020-02-14"},{"1":"city","2":"New York City","3":"driving","4":"New York","5":"United States","6":"2020-09-04","7":"152.09","8":"New York City, 2020-09-04"},{"1":"city","2":"Phoenix","3":"driving","4":"Arizona","5":"United States","6":"2020-02-29","7":"142.68","8":"Phoenix, 2020-02-29"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="exercise-13" class="section level3" number="8.1.7">
<h3 number="8.1.7"><span class="header-section-number">8.1.7</span> exercise</h3>
<p>Create a line plot, assigning the following values in <code>geom_label_repel()</code>:</p>
<ul>
<li>set the <code>data</code> argument to <code>MaxUSCitiesDriving</code></li>
</ul>
<p>Inside the <code>aes()</code>:</p>
<ul>
<li>map <code>label</code> to <code>max_driving_labels</code></li>
</ul>
<p>Outside the <code>aes()</code></p>
<ul>
<li>map <code>color</code> to <code>"red"</code><br />
</li>
<li>map <code>size</code> to <code>3</code></li>
</ul>
<pre class="r"><code>TopUSCities %&gt;% 
    ggplot() + 
    geom_line(aes(x = date, y = dir_request, 
                  group = trans_type, 
                  color = trans_type), 
                  # make these slightly smaller again...
                  size = 0.15) + 
    geom_label_repel(data = _____________,
              aes(x = date, y = dir_request, 
                  label = _____________), 
                  # set color and size...
                  color = _____, 
                  size = _) + 
  lab_line_max_drivers</code></pre>
</div>
<div id="solution-14" class="section level3" number="8.1.8">
<h3 number="8.1.8"><span class="header-section-number">8.1.8</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TopUSCities %&gt;% 
    ggplot() + 
    geom_line(aes(x = date, y = dir_request, 
                  group = trans_type, 
                  color = trans_type), 
                  # make these slightly smaller again...
                  size = 0.15) + 
    geom_label_repel(data = MaxUSCitiesDriving,
              aes(x = date, y = dir_request, 
                  label = max_driving_labels), 
                  # set color and size...
                  color = &quot;red&quot;, 
                  size = 3) + 
  lab_line_max_drivers</code></pre>
<p><img src="img/label-plot-sol-01-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="min-walking-requests" class="section level2 tabset" number="8.2">
<h2 class="tabset" number="8.2"><span class="header-section-number">8.2</span> Min Walking Requests</h2>
<p>We are going to repeat the process above, but use the minimum value for walking direction requests.</p>
<div id="exercise-14" class="section level3" number="8.2.1">
<h3 number="8.2.1"><span class="header-section-number">8.2.1</span> exercise</h3>
<ul>
<li><code>filter()</code> the <code>trans_type</code> to <code>"walking"</code><br />
</li>
<li><code>group_by()</code> the <code>region</code><br />
</li>
<li>use <code>slice_min()</code> to get the minimum value for <code>dir_request</code></li>
<li>Assign to <code>MinUSCitiesWalking</code></li>
</ul>
<pre class="r"><code>TopUSCities %&gt;% 
  filter(________ == ________) %&gt;% 
  group_by(________) %&gt;% 
  slice_min(________) -&gt; ________
MinUSCitiesWalking</code></pre>
</div>
<div id="solution-15" class="section level3" number="8.2.2">
<h3 number="8.2.2"><span class="header-section-number">8.2.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TopUSCities %&gt;% 
  filter(trans_type == &quot;walking&quot;) %&gt;% 
  group_by(region) %&gt;% 
  slice_min(dir_request) -&gt; MinUSCitiesWalking
MinUSCitiesWalking</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["geo_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["region"],"name":[2],"type":["chr"],"align":["left"]},{"label":["trans_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["sub_region"],"name":[4],"type":["chr"],"align":["left"]},{"label":["country"],"name":[5],"type":["chr"],"align":["left"]},{"label":["date"],"name":[6],"type":["date"],"align":["right"]},{"label":["dir_request"],"name":[7],"type":["dbl"],"align":["right"]}],"data":[{"1":"city","2":"Chicago","3":"walking","4":"Illinois","5":"United States","6":"2020-03-22","7":"30.86"},{"1":"city","2":"Houston","3":"walking","4":"Texas","5":"United States","6":"2020-04-12","7":"45.96"},{"1":"city","2":"Los Angeles","3":"walking","4":"California","5":"United States","6":"2020-04-12","7":"31.73"},{"1":"city","2":"New York City","3":"walking","4":"New York","5":"United States","6":"2020-03-29","7":"18.23"},{"1":"city","2":"Phoenix","3":"walking","4":"Arizona","5":"United States","6":"2020-04-12","7":"38.57"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="exercise-15" class="section level3" number="8.2.3">
<h3 number="8.2.3"><span class="header-section-number">8.2.3</span> exercise</h3>
<ul>
<li>assign <code>"Lowest Walking Direction Requests in Largest US Cities"</code> to <code>title</code><br />
</li>
<li>assign <code>"Min Walking Direction Requests &amp; Date"</code> to <code>caption</code></li>
</ul>
<pre class="r"><code>lab_line_min_walking &lt;- labs(
               x = &quot;Date&quot;,
               y = &quot;Direction Requests&quot;,
               title = &quot;__________________________________________&quot;,
               subtitle = &quot;__________________________________________&quot;,
               caption = &quot;source: https://covid19.apple.com/mobility&quot;, 
               color = &quot;Transit Type&quot;)</code></pre>
</div>
<div id="solution-16" class="section level3" number="8.2.4">
<h3 number="8.2.4"><span class="header-section-number">8.2.4</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>lab_line_min_walking &lt;- labs(
               x = &quot;Date&quot;,
               y = &quot;Direction Requests&quot;,
               title = &quot;Lowest Walking Direction Requests in Largest US Cities&quot;,
               subtitle = &quot;Min Walking Direction Requests &amp; Date&quot;,
               caption = &quot;source: https://covid19.apple.com/mobility&quot;, 
               color = &quot;Transit Type&quot;)</code></pre>
</div>
<div id="exercise-16" class="section level3" number="8.2.5">
<h3 number="8.2.5"><span class="header-section-number">8.2.5</span> exercise</h3>
<p>Create <code>min_walking_labels</code> using <code>paste0()</code> with <code>region</code> and <code>date</code></p>
<pre class="r"><code>MinUSCitiesWalking %&gt;% 
  mutate(min_walking_labels = paste0(_____, &quot;, &quot;, _____)) -&gt; MinUSCitiesWalking
MinUSCitiesWalking</code></pre>
</div>
<div id="solution-17" class="section level3" number="8.2.6">
<h3 number="8.2.6"><span class="header-section-number">8.2.6</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>MinUSCitiesWalking %&gt;% 
  mutate(min_walking_labels = paste0(region, &quot;, &quot;, date)) -&gt; MinUSCitiesWalking
MinUSCitiesWalking</code></pre>
<div data-pagedtable="false">
<script data-pagedtable-source type="application/json">
{"columns":[{"label":["geo_type"],"name":[1],"type":["chr"],"align":["left"]},{"label":["region"],"name":[2],"type":["chr"],"align":["left"]},{"label":["trans_type"],"name":[3],"type":["chr"],"align":["left"]},{"label":["sub_region"],"name":[4],"type":["chr"],"align":["left"]},{"label":["country"],"name":[5],"type":["chr"],"align":["left"]},{"label":["date"],"name":[6],"type":["date"],"align":["right"]},{"label":["dir_request"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["min_walking_labels"],"name":[8],"type":["chr"],"align":["left"]}],"data":[{"1":"city","2":"Chicago","3":"walking","4":"Illinois","5":"United States","6":"2020-03-22","7":"30.86","8":"Chicago, 2020-03-22"},{"1":"city","2":"Houston","3":"walking","4":"Texas","5":"United States","6":"2020-04-12","7":"45.96","8":"Houston, 2020-04-12"},{"1":"city","2":"Los Angeles","3":"walking","4":"California","5":"United States","6":"2020-04-12","7":"31.73","8":"Los Angeles, 2020-04-12"},{"1":"city","2":"New York City","3":"walking","4":"New York","5":"United States","6":"2020-03-29","7":"18.23","8":"New York City, 2020-03-29"},{"1":"city","2":"Phoenix","3":"walking","4":"Arizona","5":"United States","6":"2020-04-12","7":"38.57","8":"Phoenix, 2020-04-12"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div id="exercise-17" class="section level3" number="8.2.7">
<h3 number="8.2.7"><span class="header-section-number">8.2.7</span> exercise</h3>
<p>Create a line plot, assigning the following values in <code>geom_label_repel()</code>:</p>
<ul>
<li>set <code>data</code> to <code>MinUSCitiesWalking</code></li>
</ul>
<p>Inside <code>aes()</code>:</p>
<ul>
<li>map <code>min_walking_labels</code> to <code>label</code></li>
</ul>
<p>Outside <code>aes()</code>:</p>
<ul>
<li>map <code>"blue"</code> to <code>color</code><br />
</li>
<li>map <code>3</code> to <code>size</code></li>
</ul>
<pre class="r"><code>TopUSCities %&gt;% 
    ggplot() + 
    geom_line(aes(x = date, y = dir_request, 
                  group = trans_type, 
                  color = trans_type), 
                  # make these slightly smaller again...
                  size = 0.15) + 
    geom_label_repel(data = ____________,
              aes(x = date, y = dir_request, 
                  label = ____________), 
                  # set color and size...
                  color = _______, 
                  size = _) + 
  lab_line_min_walking</code></pre>
</div>
<div id="solution-18" class="section level3" number="8.2.8">
<h3 number="8.2.8"><span class="header-section-number">8.2.8</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TopUSCities %&gt;% 
    ggplot() + 
    geom_line(aes(x = date, y = dir_request, 
                  group = trans_type, 
                  color = trans_type), 
                  # make these slightly smaller again...
                  size = 0.15) + 
    geom_label_repel(data = MinUSCitiesWalking,
              aes(x = date, y = dir_request, 
                  label = min_walking_labels), 
                  # set color and size...
                  color = &quot;blue&quot;, 
                  size = 3) + 
  lab_line_min_walking</code></pre>
<p><img src="img/label-plot-sol-02-1.png" width="100%" height="100%" /></p>
</div>
</div>
</div>
<div id="advanced-facets" class="section level1" number="9">
<h1 number="9"><span class="header-section-number">9</span> Advanced Facets</h1>
<p>In the previous lesson, we introduced the <code>facet_wrap()</code> function for viewing the relationship between two variables across the levels of a categorical variable. In the next section, we’re going to show how faceting can be used to explore ‘small multiples’ in a dataset with variation across multiple levels.</p>
<div id="top-cities" class="section level2 tabset" number="9.1">
<h2 class="tabset" number="9.1"><span class="header-section-number">9.1</span> Top Cities</h2>
<p>We’re going to focus on the top 8 cites according to their <a href="https://en.wikipedia.org/wiki/List_of_United_States_cities_by_population">population</a> (the date of this writing is <code>2020-11-26</code>).</p>
<div id="exercise-18" class="section level3" number="9.1.1">
<h3 number="9.1.1"><span class="header-section-number">9.1.1</span> exercise</h3>
<p><strong>Top Cities</strong></p>
<p>We’ll store these eight cities in the <code>focus_on</code> vector and use it to filter the <code>TidyApple</code> dataset.</p>
<pre class="r"><code>focus_on &lt;- c(&quot;New York City&quot;, &quot;Los Angeles&quot;, 
                       &quot;Chicago&quot;, &quot;Houston&quot;, 
                       &quot;Phoenix&quot;, &quot;Philadelphia&quot;, 
                       &quot;San Antonio&quot;, &quot;San Diego&quot;)

TopCities &lt;- TidyApple %&gt;% 
  filter(region %in% _____________)

TopCities %&gt;% glimpse(60)</code></pre>
</div>
<div id="solution-19" class="section level3" number="9.1.2">
<h3 number="9.1.2"><span class="header-section-number">9.1.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>focus_on &lt;- c(&quot;New York City&quot;, &quot;Los Angeles&quot;, 
                       &quot;Chicago&quot;, &quot;Houston&quot;, 
                       &quot;Phoenix&quot;, &quot;Philadelphia&quot;, 
                       &quot;San Antonio&quot;, &quot;San Diego&quot;)

TopCities &lt;- TidyApple %&gt;% 
  filter(region %in% focus_on)

TopCities %&gt;% glimpse(60)</code></pre>
<pre><code>## Rows: 7,608
## Columns: 7
## $ geo_type    &lt;chr&gt; &quot;city&quot;, &quot;city&quot;, &quot;city&quot;, &quot;city&quot;, &quot;city…
## $ region      &lt;chr&gt; &quot;Chicago&quot;, &quot;Chicago&quot;, &quot;Chicago&quot;, &quot;Chi…
## $ trans_type  &lt;chr&gt; &quot;driving&quot;, &quot;driving&quot;, &quot;driving&quot;, &quot;dri…
## $ sub_region  &lt;chr&gt; &quot;Illinois&quot;, &quot;Illinois&quot;, &quot;Illinois&quot;, &quot;…
## $ country     &lt;chr&gt; &quot;United States&quot;, &quot;United States&quot;, &quot;Un…
## $ date        &lt;date&gt; 2020-01-13, 2020-01-14, 2020-01-15, …
## $ dir_request &lt;dbl&gt; 100.00, 103.68, 104.45, 108.72, 132.8…</code></pre>
</div>
</div>
<div id="graph-labels" class="section level2 tabset" number="9.2">
<h2 class="tabset" number="9.2"><span class="header-section-number">9.2</span> Graph Labels</h2>
<p>We’re going to place <code>date</code> on the <code>x</code> axis, and <code>dir_request</code> on the <code>y</code>. The <code>tite</code> will reflect a general description of what we’re expecting to see, and we’ll list the cities in the <code>subtitle</code>. <code>color</code> will be used to give a better description than <code>trans_type</code>.</p>
<div id="exercise-19" class="section level3" number="9.2.1">
<h3 number="9.2.1"><span class="header-section-number">9.2.1</span> exercise</h3>
<p><strong>Graph Labels</strong></p>
<p>Fill in names for the <code>x</code>, <code>y</code>, and <code>color</code>.</p>
<pre class="r"><code>lab_top_cities &lt;- labs(x = _____, y  = __________, 
     title = &quot;Trends of Relative Activity in Selected US Cities&quot;,
     subtitle = &quot;NY, LA, CH, HOU, PHA, PHL, SATX, SD&quot;, 
     color = _________)</code></pre>
</div>
<div id="solution-20" class="section level3" number="9.2.2">
<h3 number="9.2.2"><span class="header-section-number">9.2.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>lab_top_cities &lt;- labs(x = &quot;Date&quot;, y  = &quot;Direction Requests&quot;, 
     title = &quot;Trends of Relative Activity in Selected US Cities&quot;,
     subtitle = &quot;NY, LA, CH, HOU, PHA, PHL, SATX, SD&quot;, 
     color = &quot;Type&quot;)</code></pre>
</div>
</div>
<div id="set-global-aes" class="section level2 tabset" number="9.3">
<h2 class="tabset" number="9.3"><span class="header-section-number">9.3</span> Set Global <code>aes()</code></h2>
<p>We’re going to set the global graph aesthetics inside <code>ggplot(aes())</code> using our labels as a guide.</p>
<div id="exercise-20" class="section level3" number="9.3.1">
<h3 number="9.3.1"><span class="header-section-number">9.3.1</span> exercise</h3>
<p><strong>Global <code>aes()</code></strong></p>
<ul>
<li><p>Map <code>trans_type</code> to <code>area</code> and <code>color</code>.</p></li>
<li><p>Also add a <code>geom_line()</code> layer with the <code>size</code> set to <code>0.1</code> (not inside the <code>aes()</code>!)</p></li>
</ul>
<pre class="r"><code>TopCities %&gt;% 
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  geom_line(size = 0.1) + 
  lab_top_cities</code></pre>
</div>
<div id="solution-21" class="section level3" number="9.3.2">
<h3 number="9.3.2"><span class="header-section-number">9.3.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TopCities %&gt;% 
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  geom_line(size = 0.1) + 
  lab_top_cities</code></pre>
<p><img src="img/TopCities-geom_line-sol-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="add-reference-line" class="section level2 tabset" number="9.4">
<h2 class="tabset" number="9.4"><span class="header-section-number">9.4</span> Add reference line</h2>
<p>The documentation for the data tells us each <code>dir_request</code> has a baseline value of <code>100</code>. We’re going to add this as a reference line on the graph using <code>ggplot2::geom_hline()</code>.</p>
<div id="exercise-21" class="section level3" number="9.4.1">
<h3 number="9.4.1"><span class="header-section-number">9.4.1</span> exercise</h3>
<p>The <code>geom_hline()</code> function takes <code>yintercept</code>, <code>size</code>, and <code>color</code> arguments.</p>
<ul>
<li>use our baseline value of <code>100</code> as the <code>yintercept</code><br />
</li>
<li>set the <code>size</code> to <code>0.2</code></li>
<li>make the <code>color</code> of this line <code>"gray20"</code></li>
</ul>
<pre class="r"><code>TopCities %&gt;% 
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  geom_line(size = 0.1) + 
  geom_hline(yintercept = __, size = ___, color = &quot;&quot;) +
  lab_top_cities</code></pre>
</div>
<div id="solution-22" class="section level3" number="9.4.2">
<h3 number="9.4.2"><span class="header-section-number">9.4.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TopCities %&gt;% 
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  geom_line(size = 0.1) + 
  geom_hline(yintercept = 100, size = 0.2, color = &quot;gray20&quot;) +
  lab_top_cities</code></pre>
<p><img src="img/geom_hline-sol-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="facet_wrap" class="section level2 tabset" number="9.5">
<h2 class="tabset" number="9.5"><span class="header-section-number">9.5</span> <code>facet_wrap()</code></h2>
<p>Now that we have a graph we can use to compare the <code>8</code> cities, we will use <code>facet_wrap</code> to create a subplot for each level of <code>region</code>.</p>
<div id="exercise-22" class="section level3" number="9.5.1">
<h3 number="9.5.1"><span class="header-section-number">9.5.1</span> exercise</h3>
<p>Fill in the <code>facet_wrap()</code> (note the use of the <code>~</code>) function with <code>region</code> and set the <code>ncol</code> to <code>2</code>.</p>
<pre class="r"><code>TopCities %&gt;% 
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  geom_line(size = 0.1) + 
  geom_hline(yintercept = 100, size = 0.2, color = &quot;gray20&quot;) +
  facet_wrap(~ _______,  ncol = _) + 
  lab_top_cities</code></pre>
</div>
<div id="solution-23" class="section level3" number="9.5.2">
<h3 number="9.5.2"><span class="header-section-number">9.5.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TopCities %&gt;% 
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  geom_line(size = 0.1) + 
  geom_hline(yintercept = 100, size = 0.2, color = &quot;gray20&quot;) +
  facet_wrap(~ region,  ncol = 2) + 
  lab_top_cities</code></pre>
<p><img src="img/facet_wrap-sol-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="complete-themes" class="section level2 tabset" number="9.6">
<h2 class="tabset" number="9.6"><span class="header-section-number">9.6</span> Complete Themes</h2>
<p><code>ggplot2</code> comes with a few default theme settings. Read more about them <a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">here</a>. These themes come with arguments to adjust the <code>font_size</code> and <code>font_family</code> on our plot.</p>
<pre class="r"><code>theme_minimal(
  base_size = 11,
  base_family = &quot;&quot;,
  base_line_size = base_size/22,
  base_rect_size = base_size/22
)</code></pre>
<div id="exercise-23" class="section level3" number="9.6.1">
<h3 number="9.6.1"><span class="header-section-number">9.6.1</span> exercise</h3>
<p>We’ll use the <code>theme_minimal()</code> function to reduce the number of <code>elements</code> on our graph (don’t add any arguments).</p>
<pre class="r"><code>TopCities %&gt;% 
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  geom_line(size = 0.1) + 
  geom_hline(yintercept = 100, size = 0.2, color = &quot;gray20&quot;) +
  facet_wrap(~ region,  ncol = 2) + 
  ______________() +
  lab_top_cities </code></pre>
</div>
<div id="solution-24" class="section level3" number="9.6.2">
<h3 number="9.6.2"><span class="header-section-number">9.6.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TopCities %&gt;% 
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  geom_line(size = 0.1) + 
  geom_hline(yintercept = 100, size = 0.2, color = &quot;gray20&quot;) +
  facet_wrap(~ region,  ncol = 2) + 
  theme_minimal() +
  lab_top_cities </code></pre>
<p><img src="img/theme_minimal-sol-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="theme-elements" class="section level2 tabset" number="9.7">
<h2 class="tabset" number="9.7"><span class="header-section-number">9.7</span> Theme elements</h2>
<p>Themes (accessible with the <code>theme</code> function) give up the ability to customize various <code>element_()</code> settings, which affect the ‘look’ of our graph.</p>
<div id="exercise-24" class="section level3" number="9.7.1">
<h3 number="9.7.1"><span class="header-section-number">9.7.1</span> exercise</h3>
<p>We will start by moving the <code>legend.position</code> to <code>"top"</code> so it’s not crowding the <code>x</code> axis on our graph. Notice we pass the <code>theme()</code> layer after the <code>theme_minimal()</code> layer (if we ordered these the other way around, <code>theme_minimal()</code> would overwrite any custom settings we made in <code>theme()</code>).</p>
<pre class="r"><code>TopCities %&gt;% 
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  geom_line(size = 0.1) + 
  geom_hline(yintercept = 100, size = 0.2, color = &quot;gray20&quot;) +
  facet_wrap(~ region,  ncol = 2) + 
  theme_minimal() + 
  theme(___________ = _____) +
  lab_top_cities </code></pre>
</div>
<div id="solution-25" class="section level3" number="9.7.2">
<h3 number="9.7.2"><span class="header-section-number">9.7.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>TopCities %&gt;% 
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  geom_line(size = 0.1) + 
  geom_hline(yintercept = 100, size = 0.2, color = &quot;gray20&quot;) +
  facet_wrap(~ region,  ncol = 2) + 
  theme_minimal() + 
  theme(legend.position = &quot;top&quot;) +
  lab_top_cities </code></pre>
<p><img src="img/theme-sol-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="small-multiples" class="section level2 tabset" number="9.8">
<h2 class="tabset" number="9.8"><span class="header-section-number">9.8</span> Small Multiples</h2>
<p>What if we wanted to facet more than 8 cities? Fortunately, we have a the <a href="https://ggforce.data-imaginist.com"><code>ggforce</code></a> and <a href="https://hafen.github.io/geofacet/index.html"><code>geofacet</code></a> packages for doing just that!</p>
<pre class="r"><code>library(sf)
library(geofacet)
library(ggforce)
library(jcolors)</code></pre>
<div id="graph-data" class="section level3" number="9.8.1">
<h3 number="9.8.1"><span class="header-section-number">9.8.1</span> Graph Data</h3>
<ol style="list-style-type: decimal">
<li><p>We will start by filtering the <code>TidyApple</code> to only the 50 US states (we’ve removed three US territories) and storing these data in <code>TidyAppleUS</code>.</p></li>
<li><p>Next we limit the date range to the beginning of the shelter in place (from February 1, 2020 to May 1, 2020). These data get stored in <code>TidyAppleUST1</code>.</p></li>
<li><p>We then create a dataset with only <code>"transit"</code> direction requests, and we count these by state (<code>sub_region</code>), arrange the data descending with <code>sort = TRUE</code>, and take the top 25 rows (<code>Top25TransitStates</code>).</p></li>
</ol>
<p>Finally, we filter <code>TidyAppleUST1</code> using the 25 states in <code>Top25TransitStates</code> to create our graphing dataset, <code>Top25TransitUSAllT1</code>.</p>
<pre class="r"><code># create only US states (TidyAppleUS)
TidyApple %&gt;% 
  filter(country == &quot;United States&quot; &amp; 
         !sub_region %in% c(&quot;Guam&quot;, &quot;Puerto Rico&quot;, 
                            &quot;Virgin Islands&quot;)) -&gt; TidyAppleUS
# create shelter in place time 1 (TidyAppleUST1)
TidyAppleUS %&gt;% 
  filter(date &gt;= as_date(&quot;2020-02-01&quot;) &amp;
           date &lt;= as_date(&quot;2020-05-01&quot;)) -&gt; TidyAppleUST1

# create top 25 states (Top25TransitStates)
Top25TransitStates &lt;- TidyAppleUST1 %&gt;% 
  filter(trans_type == &quot;transit&quot;) %&gt;% 
  count(sub_region, trans_type, sort = TRUE) %&gt;% 
  head(25)

# filter T1 to states with the most transit requests (Top25TransitUSAllT1)
TidyAppleUST1 %&gt;% 
  filter(sub_region %in% 
           unique(Top25TransitStates$sub_region)) -&gt; Top25TransitUSAllT1

Top25TransitUSAllT1 %&gt;% skimr::skim()</code></pre>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">188643</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">7</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">5</td>
</tr>
<tr class="odd">
<td align="left">Date</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">geo_type</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">region</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">39</td>
<td align="right">0</td>
<td align="right">1058</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">trans_type</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">sub_region</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">14</td>
<td align="right">0</td>
<td align="right">25</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">country</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">13</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: Date</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">date</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2020-02-01</td>
<td align="left">2020-05-01</td>
<td align="left">2020-03-17</td>
<td align="right">91</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dir_request</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">92.68</td>
<td align="right">36.02</td>
<td align="right">0.44</td>
<td align="right">68.64</td>
<td align="right">93.6</td>
<td align="right">113.14</td>
<td align="right">1379.02</td>
<td align="left">▇▁▁▁▁</td>
</tr>
</tbody>
</table>
</div>
<div id="exercise-25" class="section level3" number="9.8.2">
<h3 number="9.8.2"><span class="header-section-number">9.8.2</span> exercise</h3>
<ul>
<li><p>set <code>title</code> to <code>"States With Highest Transit Direction Requests"</code></p></li>
<li><p>set <code>subtitle</code> to <code>"Top 25 states based on number of total transit requests"</code></p></li>
</ul>
<pre class="r"><code>lab_facet_wrap_paginate &lt;- labs(
       x = &quot;Date&quot;, y = &quot;Direction Requests&quot;, 
       title = _____________________________________,
       subtitle = _____________________________________)</code></pre>
</div>
<div id="solution-26" class="section level3" number="9.8.3">
<h3 number="9.8.3"><span class="header-section-number">9.8.3</span> solution</h3>
<pre class="r"><code>lab_facet_wrap_paginate &lt;- labs(
       x = &quot;Date&quot;, y = &quot;Direction Requests&quot;, 
       title = &quot;States With Highest Transit Direction Requests&quot;,
       subtitle = &quot;Top 25 states based on number of total transit requests&quot;)</code></pre>
</div>
<div id="exercise-26" class="section level3" number="9.8.4">
<h3 number="9.8.4"><span class="header-section-number">9.8.4</span> exercise</h3>
<p>Inside <code>ggforce::facet_wrap_paginate()</code>:</p>
<ul>
<li><p>map <code>sub_region</code> as the variable to facet using the <code>~</code></p></li>
<li><p>map <code>5</code> to <code>ncol</code></p></li>
<li><p>map <code>"free_y"</code> to <code>scales</code></p></li>
</ul>
<p>Inside <code>theme()</code></p>
<ul>
<li><p>map <code>element_blank()</code> to <code>panel.border</code> and <code>panel.background</code></p></li>
<li><p>map <code>element_text(size = 6)</code> to <code>axis.text.x</code> and <code>axis.text.y</code></p></li>
<li><p>map <code>element_text(colour = 'black')</code> to <code>strip.text</code></p></li>
<li><p>map <code>element_rect(fill = "gray93")</code> to <code>strip.background</code></p></li>
<li><p>map <code>"top"</code> to <code>legend.position</code></p></li>
</ul>
<pre class="r"><code>Top25TransitUSAllT1 %&gt;% 
  # global settings
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  # lines
  geom_hline(yintercept = 100, size = 0.3, color = &quot;black&quot;) + 
  geom_line(size = 0.2) +
  # faceting
  ggforce::facet_wrap_paginate(~ __________, 
                               ncol = _, 
                               scales = _______) + 
  # theme settings
  theme(__________ = __________(), 
        __________ = __________(),
        
        __________ = __________(size = _), 
        __________ = __________(size = _),
        
        __________ = __________(colour = __________),
        
        __________ = __________(fill = __________), 
        
        __________ = __________) + 
  # labels
  lab_facet_wrap_paginate</code></pre>
</div>
<div id="solution-27" class="section level3" number="9.8.5">
<h3 number="9.8.5"><span class="header-section-number">9.8.5</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>Top25TransitUSAllT1 %&gt;% 
  # global settings
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  # lines
  geom_hline(yintercept = 100, size = 0.3, color = &quot;black&quot;) + 
  geom_line(size = 0.2) +
  # faceting
  ggforce::facet_wrap_paginate(~ sub_region, 
                               ncol = 5, 
                               scales = &quot;free_y&quot;) + 
  # theme settings
  theme(panel.border = element_blank(), 
        panel.background = element_blank(),
        axis.text.x = element_text(size = 6), 
        axis.text.y = element_text(size = 6),
        strip.text = element_text(colour = &#39;black&#39;),
        strip.background = element_rect(fill = &quot;gray93&quot;), 
        legend.position = &quot;top&quot;) + 
  # labels
  lab_facet_wrap_paginate</code></pre>
<p><img src="img/facet_wrap_paginate-sol-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="adjusting-colors" class="section level2 tabset" number="9.9">
<h2 class="tabset" number="9.9"><span class="header-section-number">9.9</span> Adjusting Colors</h2>
<p>Changing the colors on graphs gives us the ability to further customize their look. We can set these manually, or use one of the many complete color palettes from a user-written package. Below we’ll use the <a href="https://jaredhuling.org/jcolors/index.html"><code>jcolors</code> package</a> to highlight the <code>transit</code> direction requests from the previous graph.</p>
<div id="exercise-27" class="section level3" number="9.9.1">
<h3 number="9.9.1"><span class="header-section-number">9.9.1</span> exercise</h3>
<ul>
<li>add <code>scale_color_jcolors()</code> and play with the <code>palette</code> argument to make the graph look like the <code>solution</code>.</li>
</ul>
<pre class="r"><code>Top25TransitUSAllT1 %&gt;% 
  # global settings
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  # lines
  geom_hline(yintercept = 100, size = 0.3, color = &quot;black&quot;) + 
  geom_line(size = 0.2) +
  # faceting
  ggforce::facet_wrap_paginate(~ sub_region, 
                               ncol = 5, 
                               scales = &quot;free_y&quot;) + 
  # theme settings
  theme(panel.border = element_blank(), 
        panel.background = element_blank(),
        axis.text.x = element_text(size = 6), 
        axis.text.y = element_text(size = 6),
        strip.text = element_text(colour = &#39;black&#39;),
        strip.background = element_rect(fill = &quot;gray93&quot;), 
        legend.position = &quot;top&quot;) + 
  # adjust colors
  __________________________(palette = ____) + 
  
  lab_facet_wrap_paginate</code></pre>
</div>
<div id="solution-28" class="section level3" number="9.9.2">
<h3 number="9.9.2"><span class="header-section-number">9.9.2</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>Top25TransitUSAllT1 %&gt;% 
  # global settings
  ggplot(aes(x = date, y = dir_request, 
             group = trans_type, 
             color = trans_type)) + 
  # lines
  geom_hline(yintercept = 100, size = 0.3, color = &quot;black&quot;) + 
  geom_line(size = 0.2) +
  # faceting
  ggforce::facet_wrap_paginate(~ sub_region, 
                               ncol = 5, 
                               scales = &quot;free_y&quot;) + 
  # theme settings
  theme(panel.border = element_blank(), 
        panel.background = element_blank(),
        axis.text.x = element_text(size = 6), 
        axis.text.y = element_text(size = 6),
        strip.text = element_text(colour = &#39;black&#39;),
        strip.background = element_rect(fill = &quot;gray93&quot;), 
        legend.position = &quot;top&quot;) + 
  
  scale_color_jcolors(palette = &quot;pal3&quot;) + 
  
  lab_facet_wrap_paginate</code></pre>
<p><img src="img/scale_color_jcolors-sol-1.png" width="100%" height="100%" /></p>
</div>
</div>
<div id="extra-geofacet" class="section level2 tabset" number="9.10">
<h2 class="tabset" number="9.10"><span class="header-section-number">9.10</span> Extra: <code>geofacet</code></h2>
<p>We’re now going to look at all 50 states using the <code>facet_geo()</code> function from the <code>geofacet</code> package. To make this graph easier to interpret, we’re going to focus only on walking mobility data, and adjust the <code>dir_request</code> value to absolute change from baseline (set to <code>100</code> on <code>2020-01-13</code>).</p>
<div id="adjusted-walking-data" class="section level3" number="9.10.1">
<h3 number="9.10.1"><span class="header-section-number">9.10.1</span> Adjusted Walking Data</h3>
<p>Create the <code>USWalkingAdj</code> data by filtering the <code>trans_type</code> to <code>"walking"</code> and creating two new variables: <code>above_below</code> (a logical indicator for values being above or below the baseline value of <code>100</code>), and <code>dir_request_adj</code> (the adjusted direction request value).</p>
</div>
<div id="exercise-28" class="section level3" number="9.10.2">
<h3 number="9.10.2"><span class="header-section-number">9.10.2</span> exercise</h3>
<p>Fill in the correct variables in the wrangling steps below:</p>
<pre class="r"><code>USWalkingAdj &lt;- TidyAppleUS %&gt;% 
  filter(trans_type == _________) %&gt;%
  mutate(above_below = _________ &lt; 100, 
         dir_request_adj = _________ - 100)

USWalkingAdj %&gt;% 
  skimr::skim()</code></pre>
</div>
<div id="solution-29" class="section level3" number="9.10.3">
<h3 number="9.10.3"><span class="header-section-number">9.10.3</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>USWalkingAdj &lt;- TidyAppleUS %&gt;% 
  filter(trans_type == &quot;walking&quot;) %&gt;%
  mutate(above_below = dir_request &lt; 100, 
         dir_request_adj = dir_request - 100)

USWalkingAdj %&gt;% 
  skimr::skim()</code></pre>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">Piped data</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">160085</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">9</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">5</td>
</tr>
<tr class="odd">
<td align="left">Date</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">logical</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">geo_type</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">region</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">39</td>
<td align="right">0</td>
<td align="right">452</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">trans_type</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">7</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">sub_region</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">14</td>
<td align="right">0</td>
<td align="right">48</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">country</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">13</td>
<td align="right">13</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: Date</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">date</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2020-01-13</td>
<td align="left">2020-11-24</td>
<td align="left">2020-06-19</td>
<td align="right">317</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: logical</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="left">count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">above_below</td>
<td align="right">220</td>
<td align="right">1</td>
<td align="right">0.32</td>
<td align="left">FAL: 108071, TRU: 51794</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dir_request</td>
<td align="right">220</td>
<td align="right">1</td>
<td align="right">129.36</td>
<td align="right">63.68</td>
<td align="right">0.44</td>
<td align="right">89.44</td>
<td align="right">122.7</td>
<td align="right">163.82</td>
<td align="right">1379.02</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">dir_request_adj</td>
<td align="right">220</td>
<td align="right">1</td>
<td align="right">29.36</td>
<td align="right">63.68</td>
<td align="right">-99.56</td>
<td align="right">-10.56</td>
<td align="right">22.7</td>
<td align="right">63.82</td>
<td align="right">1279.02</td>
<td align="left">▇▁▁▁▁</td>
</tr>
</tbody>
</table>
</div>
<div id="exercise-29" class="section level3" number="9.10.4">
<h3 number="9.10.4"><span class="header-section-number">9.10.4</span> exercise</h3>
<p>Assign the following to the labels:</p>
<ul>
<li><p>set <code>"US Trends in Mobility Data for Walking (Adjusted)"</code> to <code>title</code></p></li>
<li><p>set <code>"Original data uses 100 as baseline for usage at 2020-01-13"</code> to <code>subtitle</code></p></li>
<li><p>set <code>"https://covid19.apple.com/mobility"</code> to <code>caption</code></p></li>
</ul>
<pre class="r"><code>lab_facet_geo &lt;- labs(x = &quot;Date&quot;, 
                      y = &quot;Direction Requests (Walking)&quot;, 
       title = ____________________________________________, 
       subtitle = ____________________________________________, 
       caption = ____________________________________________, 
       fill = &quot;Below Baseline&quot;)</code></pre>
</div>
<div id="solution-30" class="section level3" number="9.10.5">
<h3 number="9.10.5"><span class="header-section-number">9.10.5</span> solution</h3>
<p>See below:</p>
<pre class="r"><code>lab_facet_geo &lt;- labs(x = &quot;Date&quot;, 
                      y = &quot;Direction Requests (Walking)&quot;, 
       title = &quot;US Trends in Mobility Data for Walking (Adjusted)&quot;, 
       subtitle = &quot;Original data uses 100 as baseline for usage at 2020-01-13&quot;, 
       caption = &quot;https://covid19.apple.com/mobility&quot;,
       fill = &quot;Below Baseline&quot;)</code></pre>
</div>
<div id="exercise-30" class="section level3" number="9.10.6">
<h3 number="9.10.6"><span class="header-section-number">9.10.6</span> exercise</h3>
<ul>
<li><p>set the colors in <code>color_bl_or</code> as <code>c("#8470FF", "#7FFFD4")</code></p></li>
<li><p>set <code>yintercept</code> to <code>0</code> in <code>geom_hline()</code></p></li>
<li><p>set the <code>values</code> in <code>scale_fill_manual()</code> to <code>color_bl_or</code></p></li>
<li><p>map <code>sub_region</code> to <code>facet_geo</code> using <code>~</code></p></li>
</ul>
<p>Inside <code>theme()</code></p>
<ul>
<li>set the <code>panel.border</code> and <code>panel.background</code> to <code>element_blank()</code><br />
</li>
<li>set the <code>axis.text.x</code> and <code>axis.text.y</code> to <code>element_text(size = 6)</code></li>
<li>set the <code>strip.text.x</code> to <code>element_text(size = 7)</code><br />
</li>
<li>set <code>strip.text</code> to <code>element_text(colour = 'white')</code><br />
</li>
<li>set <code>strip.background</code> to <code>element_rect(fill = "black")</code><br />
</li>
<li>set <code>legend.position</code> to <code>"bottom"</code></li>
</ul>
<pre class="r"><code># set colors
color_bl_or &lt;- c(____________, ____________)

USWalkingAdj %&gt;% 
  ggplot(aes(x = date, y = dir_request_adj, 
             group = sub_region, fill = above_below)) + 
  
  geom_col() + 
  
  geom_hline(yintercept = _, color = &quot;gray7&quot;) + 
  
  scale_fill_manual(values = ____________) +
  
  facet_geo(~ sub_region) +
  
  theme_bw() + 
  
  theme(______________ = ______________(), 
        ______________ = ______________(),
        
        ______________ = ______________(size = _), 
        ______________ = ______________(size = _),
        ______________ = ______________(size = _),
        
        ______________ = ______________(colour = ______________),
        ______________ = ______________(fill = ______________), 
        
        ______________ = ______________) + 
  
  lab_facet_geo</code></pre>
</div>
<div id="solution-31" class="section level3" number="9.10.7">
<h3 number="9.10.7"><span class="header-section-number">9.10.7</span> solution</h3>
<p>See below:</p>
<pre class="r"><code># set colors
color_bl_or &lt;- c(&quot;#8470FF&quot;, &quot;#7FFFD4&quot;)

USWalkingAdj %&gt;% 
  ggplot(aes(x = date, y = dir_request_adj, 
             group = sub_region, fill = above_below)) + 
  
  geom_col() + 
  
  geom_hline(yintercept = 0, 
             color = &quot;gray7&quot;) + 
  
  scale_fill_manual(values = color_bl_or) +
  
  facet_geo(~ sub_region) +
  
  theme_bw() + 
  
  theme(panel.border = element_blank(), 
        panel.background = element_blank(),
        axis.text.x = element_text(size = 6), 
        axis.text.y = element_text(size = 6),
        strip.text.x = element_text(size = 7),
        strip.text = element_text(colour = &#39;white&#39;),
        strip.background = element_rect(fill = &quot;black&quot;), 
        legend.position = &quot;bottom&quot;) + 
  
  lab_facet_geo</code></pre>
<p><img src="img/facet_geo-sol-1.png" width="100%" height="100%" /></p>
</div>
</div>
</div>

<i class="fab fa-creative-commons fa-2x"></i><i class="fab fa-creative-commons-by fa-2x"></i><i class="fab fa-creative-commons-sa fa-2x"></i>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3,h4,h5",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
